- en: Error::source
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Error::source
- en: 原文：[https://rust-exercises.com/100-exercises/05_ticket_v2/14_source.html](https://rust-exercises.com/100-exercises/05_ticket_v2/14_source.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://rust-exercises.com/100-exercises/05_ticket_v2/14_source.html](https://rust-exercises.com/100-exercises/05_ticket_v2/14_source.html)
- en: 'There''s one more thing we need to talk about to complete our coverage of the
    `Error` trait: the `source` method.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 为了完成对 `Error` 特质的覆盖，我们还需要讨论一件事：`source` 方法。
- en: '[PRE0]'
  id: totrans-3
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The `source` method is a way to access the **error cause**, if any.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '`source` 方法是一种访问**错误原因**的方式，如果有的话。'
- en: 'Errors are often chained, meaning that one error is the cause of another: you
    have a high-level error (e.g. cannot connect to the database) that is caused by
    a lower-level error (e.g. can''t resolve the database hostname). The `source`
    method allows you to "walk" the full chain of errors, often used when capturing
    error context in logs.'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 错误通常链式传递，意味着一个错误是另一个错误的原因：您有一个高级错误（例如，无法连接到数据库），它是由一个低级错误（例如，无法解析数据库主机名）引起的。`source`
    方法允许您“遍历”完整的错误链，通常用于在日志中捕获错误上下文。
- en: '[Implementing `source`](#implementing-source)'
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[实现 `source`](#implementing-source)'
- en: The `Error` trait provides a default implementation that always returns `None`
    (i.e. no underlying cause). That's why you didn't have to care about `source`
    in the previous exercises.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '`Error` 特质提供了一个默认实现，该实现始终返回 `None`（即没有底层原因）。这就是为什么在前面的练习中您不必关心 `source`。'
- en: You can override this default implementation to provide a cause for your error
    type.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以覆盖此默认实现，为您的错误类型提供一个原因。
- en: '[PRE1]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In this example, `DatabaseError` wraps an `std::io::Error` as its source. We
    then override the `source` method to return this source when called.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，`DatabaseError` 将 `std::io::Error` 作为其来源包装起来。然后我们覆盖 `source` 方法，在调用时返回此来源。
- en: '[`&(dyn Error + ''static)`](#dyn-error--static)'
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[`(dyn Error + ''static)`](#dyn-error--static)'
- en: What's this `&(dyn Error + 'static)` type?
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 这 `&(dyn Error + 'static)` 类型是什么？
- en: 'Let''s unpack it:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们分解它：
- en: '`dyn Error` is a **trait object**. It''s a way to refer to any type that implements
    the `Error` trait.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dyn Error` 是一个**特质对象**。它是一种引用实现 `Error` 特质的任何类型的方式。'
- en: '`''static` is a special **lifetime specifier**. `''static` implies that the
    reference is valid for "as long as we need it", i.e. the entire program execution.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`''static` 是一个特殊的**生命周期指定符**。`''static` 意味着引用在“我们需要它的时候”有效，即整个程序执行期间。'
- en: 'Combined: `&(dyn Error + ''static)` is a reference to a trait object that implements
    the `Error` trait and is valid for the entire program execution.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 结合：`&(dyn Error + 'static)` 是一个指向实现 `Error` 特质且在整个程序执行期间有效的特质对象的引用。
- en: Don't worry too much about either of these concepts for now. We'll cover them
    in more detail in future chapters.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 目前不必过分担心这些概念。我们将在未来的章节中更详细地介绍它们。
- en: '[Implementing `source` using `thiserror`](#implementing-source-using-thiserror)'
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[使用 `thiserror` 实现 `source`](#implementing-source-using-thiserror)'
- en: '`thiserror` provides three ways to automatically implement `source` for your
    error types:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '`thiserror` 为您的错误类型提供了三种自动实现 `source` 的方式：'
- en: A field named `source` will automatically be used as the source of the error.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 命名为 `source` 的字段将自动用作错误的来源。
- en: '[PRE2]'
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: A field annotated with the `#[source]` attribute will automatically be used
    as the source of the error.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带有 `#[source]` 属性的字段将自动用作错误的来源。
- en: '[PRE3]'
  id: totrans-23
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: A field annotated with the `#[from]` attribute will automatically be used as
    the source of the error **and** `thiserror` will automatically generate a `From`
    implementation to convert the annotated type into your error type.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带有 `#[from]` 属性的字段将自动用作错误的来源，并且 `thiserror` 将自动生成一个 `From` 实现来将注解类型转换为您的错误类型。
- en: '[PRE4]'
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '[The `?` operator](#the--operator)'
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[`?` 操作符](#the--operator)'
- en: The `?` operator is a shorthand for propagating errors.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '`?` 操作符是传播错误的简写。'
- en: When used in a function that returns a `Result`, it will return early with an
    error if the `Result` is `Err`.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 当用于返回 `Result` 的函数时，如果 `Result` 是 `Err`，它将提前返回错误。
- en: 'For example:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE5]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'is equivalent to:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 等价于：
- en: '[PRE6]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: You can use the `?` operator to shorten your error handling code significantly.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用 `?` 操作符显著缩短错误处理代码。
- en: In particular, the `?` operator will automatically convert the error type of
    the fallible operation into the error type of the function, if a conversion is
    possible (i.e. if there is a suitable `From` implementation)
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 特别是，`?` 操作符将自动将可疑操作的错误类型转换为函数的错误类型，如果可能进行转换（即如果存在合适的 `From` 实现）。
- en: '[Exercise](#exercise)'
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[练习](#exercise)'
- en: The exercise for this section is located in [`05_ticket_v2/14_source`](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/05_ticket_v2/14_source)
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 本节练习位于[`05_ticket_v2/14_source`](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/05_ticket_v2/14_source)
