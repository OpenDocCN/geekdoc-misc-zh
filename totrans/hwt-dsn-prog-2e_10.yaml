- en: IVÂ Intertwined DatağŸ”—
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: åŸæ–‡ï¼š[https://htdp.org/2024-11-6/Book/part_four.html](https://htdp.org/2024-11-6/Book/part_four.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Â Â Â Â [19Â The Poetry of S-expressions](#%28part._ch~3apoetry-sexp%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [19.1Â Trees](#%28part._sec~3abtrees%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [19.2Â Forests](#%28part._sec~3aforests%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [19.3Â S-expressions](#%28part._sec~3asexp%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [19.4Â Designing with Intertwined Data](#%28part._sec~3adesign-.N%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [19.5Â Project: BSTs](#%28part._sec~3aproj-bst%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [19.6Â Simplifying Functions](#%28part._sec~3asimplification%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â [20Â Iterative Refinement](#%28part._ch~3afiles%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [20.1Â Data Analysis](#%28part._sec~3afiles-what%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [20.2Â Refining Data Definitions](#%28part._sec~3afiles-models%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [20.3Â Refining Functions](#%28part._sec~3arefine-funcs%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â [21Â Refining Interpreters](#%28part._ch~3aevaluator%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [21.1Â Interpreting Expressions](#%28part._sec~3ainterpreter%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [21.2Â Interpreting Variables](#%28part._sec~3ainterpreter-variables%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [21.3Â Interpreting Functions](#%28part._sec~3ainterpreter-functions%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [21.4Â Interpreting Everything](#%28part._sec~3ainterpreter-all%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â [22Â Project: The Commerce of XML](#%28part._ch~3amoney-sexp%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [22.1Â XML as S-expressions](#%28part._sec~3axml%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [22.2Â Rendering XML Enumerations](#%28part._sec~3aenum%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [22.3Â Domain-Specific Languages](#%28part._sec~3aconfig%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [22.4Â Reading XML](#%28part._sub~3areading-xml%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â [23Â Simultaneous Processing](#%28part._ch~3asimu%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [23.1Â Processing Two Lists Simultaneously: Case 1](#%28part._sec~3atwo-inputs~3acase1%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [23.2Â Processing Two Lists Simultaneously: Case 2](#%28part._sec~3atwo-inputs~3acase2%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [23.3Â Processing Two Lists Simultaneously: Case 3](#%28part._sec~3atwo-inputs~3acase3%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [23.4Â Function Simplification](#%28part._sec~3atwo-inputs~3asimplify%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [23.5Â Designing Functions that Consume Two Complex Inputs](#%28part._sec~3atwo-inputs~3adesign%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [23.6Â Finger Exercises: Two Inputs](#%28part._sec~3atwo-inputs~3aex%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [23.7Â Project: Database](#%28part._db._sec~3aproj-db%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â [24Â Summary](#%28part._ch~3asummary4%29) |'
  prefs: []
  type: TYPE_TB
- en: You might think that the data definitions for lists and natural numbers are
    quite unusual. These data definitions refer to themselves, and in all likelihood
    they are the first such definitions you have ever encountered. As it turns out,
    many classes of data require even more complex data definitions than these two.
    Common generalizations involve many self-references in one data definition or
    a bunch of data definitions that refer to each other. These forms of data have
    become ubiquitous, and it is therefore critical for a programmer to learn to cope
    with any collection of data definitions. And thatâ€™s what the design recipe is
    all about.
  prefs: []
  type: TYPE_NORMAL
- en: 'This part starts with a generalization of the design recipe so that it works
    for all forms of structural data definitions. Next, it introduces the concept
    of iterative refinement from [Projects: Lists](part_two.html#%28part._ch~3aproj-lists%29)
    on a rigorous basis because complex data definitions are not developed in one
    fell swoop but in several stages. Indeed, the use of iterative refinement is one
    of the reasons why all programmers are little scientists and why our discipline
    uses the word â€œscienceâ€ in its American name. Two last chapters illustrate these
    ideas: one explains how to design an interpreter for BSL and another is about
    processing XML, a data exchange language for the web. The last chapter expands
    the design recipe one more time, reworking it for functions that process two complex
    arguments at the same time.'
  prefs: []
  type: TYPE_NORMAL
- en: 19The Poetry of S-expressions[ğŸ”—](#(part._ch~3apoetry-sexp) "Link to here")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Programming resembles poetry. Like poets, programmers practice their skill on
    seemingly pointless ideas. They revise and edit all the time, as the preceding
    chapter explains. This chapter introduces increasingly complex forms of dataâ€”<wbr>seemingly
    without a real-world purpose. Even when we provide a motivational background,
    the chosen kinds of data are pure to an extreme, and it is unlikely that you will
    ever encounter them again.
  prefs: []
  type: TYPE_NORMAL
- en: 'Nevertheless, this chapter shows the full power of the design recipe and introduces
    you to the kinds of data that real-world programs cope with. To connect this material
    with what you will encounter in your life as a programmer, we label each section
    with appropriate names: trees, forests, XML. The last one is a bit misleading
    because it is really about S-expressions; the connection between S-expressions
    and XML is clarified in [Project: The Commerce of XML](#%28part._ch~3amoney-sexp%29),
    which, in contrast to this chapter, comes much closer to real-world uses of complex
    forms of data.'
  prefs: []
  type: TYPE_NORMAL
- en: 19.1Trees[ğŸ”—](#(part._sec~3abtrees) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: All of us have a family tree. One way to draw a family tree is to add an element
    every time a child is born and to connect the elements of the father and mother.
    For those people whose parents are unknown, there is no connection to draw. The
    result is an ancestor family tree because, given any person, the tree points to
    all of the personâ€™s known ancestors.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/ee2a68d522cfb0c9128cc6dda4bee436.png)'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 111: A family tree'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 111](#%28counter._%28figure._fig~3afamily-tree%29%29) displays a three-tier
    family tree. Gustav is the child of Eva and Fred, while Eva is the child of Carl
    and Bettina. In addition to peopleâ€™s names and family relationships, the tree
    also records years of birth and eye colors. Based on this sketch, you can easily
    imagine a family tree reaching back many generations and one that records other
    kinds of information.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Once a family tree is large, it makes sense to represent it as data and to
    design programs that process this kind of data. Given that a point in a family
    tree combines five pieces of informationâ€”<wbr>the father, the mother, the name,
    the birth date, and the eye colorâ€”<wbr>we should define a structure type:'
  prefs: []
  type: TYPE_NORMAL
- en: ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â childÂ [fatherÂ motherÂ nameÂ dateÂ eyes])
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The structure type definition calls a data definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â A Child is a structure: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â (make-child  [Child](#%28tech._child%29)  [Child](#%28tech._child%29)  [String](part_one.html#%28tech._string%29)  [N](part_two.html#%28tech._n%29)  [String](part_one.html#%28tech._string%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: While this data definition looks straightforward, it is also useless. It refers
    to itself, but, because it doesnâ€™t have any clauses, there is no way to create
    a proper instance [Child](#%28tech._child%29). Roughly, we would have to write
  prefs: []
  type: TYPE_NORMAL
- en: (make-childÂ (make-childÂ (make-childÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'without end. To avoid such pointless data definitions, we demand that a self-referential
    data definition have several clauses and that at least one of them does not refer
    back to the data definition.Letâ€™s postpone the data definition for a moment, and
    experiment instead. Suppose we are about to add a child to an existing family
    tree and that we already have representations for the parents. In that case, we
    can simply construct a new child structure. For example, to represent Adam in
    a program that already represents Carl and Bettina, it suffices to add the following
    child structure:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â Adam
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (make-childÂ CarlÂ BettinaÂ "Adam"Â 1950Â "hazel")) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'assuming Carl and Bettina stand for representations of Adamâ€™s parents.Then
    again, a personâ€™s parents may be unknown, like Bettinaâ€™s in the family tree of
    [figureÂ 111](#%28counter._%28figure._fig~3afamily-tree%29%29). Yet, even then,
    we must fill the corresponding parent field(s) in the child representation. Whatever
    data we choose, it must signal an absence of information. On the one hand, we
    could use #false, "none", or ''() from the pool of existing values. On the other
    hand, we should really say that the information is missing from a family tree.
    We can achieve this objective best with the introduction of a structure type with
    an appropriate name:'
  prefs: []
  type: TYPE_NORMAL
- en: ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â no-parentÂ [])
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Now, to construct a child structure for Bettina, we say
  prefs: []
  type: TYPE_NORMAL
- en: '| (make-childÂ (make-no-parent) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â (make-no-parent) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â "Bettina"Â 1926Â "green") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Of course, if only one piece of information is missing, we fill just that field
    with this special value.Our experimentation suggests two insights. First, we are
    not looking for a data definition that describes how to generate instances of
    child structures but for a data definition that describes how to represent family
    trees. Second, the data definition consists of two clauses, one for the variant
    describing unknown family trees and another one for known family trees:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â no-parentÂ [])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â childÂ [fatherÂ motherÂ nameÂ dateÂ eyes])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An FT (short for family tree) is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-no-parent) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-child  [FT](#%28tech._ft%29)  [FT](#%28tech._ft%29)  [String](part_one.html#%28tech._string%29)  [N](part_two.html#%28tech._n%29)  [String](part_one.html#%28tech._string%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Since the â€œno parentâ€ tree is going to show up a lot in our programs, we define
    NP as a short-hand and revise the data definition a bit:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â NPÂ (make-no-parent))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An FT is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  NP |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-child  [FT](#%28tech._ft%29)  [FT](#%28tech._ft%29)  [String](part_one.html#%28tech._string%29)  [N](part_two.html#%28tech._n%29)  [String](part_one.html#%28tech._string%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Following the design recipe from [Designing with Self-Referential Data Definitions](part_two.html#%28part._ch~3adesign-lists%29),
    we use the data definition to create examples of family trees. Specifically, we
    translate the family tree in [figureÂ 111](#%28counter._%28figure._fig~3afamily-tree%29%29)
    into our data representation. The information for Carl is easy to translate into
    data:'
  prefs: []
  type: TYPE_NORMAL
- en: (make-childÂ NPÂ NPÂ "Carl"Â 1926Â "green")
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Bettina and Fred are represented with similar instances of child. The case
    for Adam calls for nested children, one for Carl and one for Bettina:'
  prefs: []
  type: TYPE_NORMAL
- en: '| (make-childÂ (make-childÂ NPÂ NPÂ "Carl"Â 1926Â "green") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â (make-childÂ NPÂ NPÂ "Bettina"Â 1926Â "green") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â "Adam" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â 1950 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â "hazel") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Since the records for Carl and Bettina are also needed to construct the records
    for Dave and Eva, it is better to introduce definitions that name specific instances
    of child and to use the variable names elsewhere. [FigureÂ 112](#%28counter._%28figure._fig~3afamily.S%29%29)
    illustrates this approach for the complete data representation of the family tree
    from [figureÂ 111](#%28counter._%28figure._fig~3afamily-tree%29%29). Take a close
    look; the tree serves as our running example for the following design exercise.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â Oldest Generation: |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â CarlÂ (make-childÂ NPÂ NPÂ "Carl"Â 1926Â "green"))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â BettinaÂ (make-childÂ NPÂ NPÂ "Bettina"Â 1926Â "green"))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Middle Generation: |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â AdamÂ (make-childÂ CarlÂ BettinaÂ "Adam"Â 1950Â "hazel"))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â DaveÂ (make-childÂ CarlÂ BettinaÂ "Dave"Â 1955Â "black"))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â EvaÂ (make-childÂ CarlÂ BettinaÂ "Eva"Â 1965Â "blue"))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â FredÂ (make-childÂ NPÂ NPÂ "Fred"Â 1966Â "pink"))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Youngest Generation: |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â GustavÂ (make-childÂ FredÂ EvaÂ "Gustav"Â 1988Â "brown"))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 112: A data representation of the sample family tree'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Instead of designing a concrete function on family trees, letâ€™s first look
    at the generic organization of such a function. That is, letâ€™s work through the
    design recipe as much as possible without having a concrete task in mind. We start
    with the header material, that is, step 2 of the recipe:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [FT](#%28tech._ft%29) -> ??? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â ... |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (fun-FTÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Even though we arenâ€™t stating the purpose of the function, we do know that
    it consumes a family tree and that this form of data is the main input. The â€œ???â€
    in the signature says that we donâ€™t know what kind of data the function produces;
    the â€œ...â€ remind us that we donâ€™t know its purpose.The lack of purpose means we
    cannot make up functional examples. Nevertheless, we can exploit the organization
    of the data definition for FT to design a template. Since it consists of two clauses,
    the template must consist of a [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    expression with two clauses:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (fun-FTÂ an-ftree)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(no-parent?Â an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'In case the argument to fun-FT satisfies no-parent?, the structure contains
    no additional data, so the first clause is complete. For the second clause, the
    input contains five pieces of data, which we indicate with five selectors in the
    template:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [FT](#%28tech._ft%29) -> ??? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (fun-FTÂ an-ftree)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(no-parent?Â an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-fatherÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-motherÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-nameÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-dateÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-eyesÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The last addition to templates concerns self-references. If a data definition
    refers to itself, the function is likely to recur and templates indicate so with
    suggestive natural recursions. The definition for [FT](#%28tech._ft%29) has two
    self-references, and the template therefore needs two such recursions:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [FT](#%28tech._ft%29) -> ??? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (fun-FTÂ an-ftree)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(no-parent?Â an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (fun-FTÂ (child-fatherÂ an-ftree))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (fun-FTÂ (child-motherÂ an-ftree))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-nameÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-dateÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-eyesÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Specifically, fun-FT is applied to the data representation for fathers and
    mothers in the second [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause because the second clause of the data definition contains corresponding
    self-references.Letâ€™s now turn to a concrete example, the blue-eyed-child? function.
    Its purpose is to determine whether any child structure in a given family tree
    has blue eyes. You may copy, paste, and rename fun-FT to get its template; we
    replace â€œ???â€ with [Boolean](part_one.html#%28tech._boolean%29) and add a purpose
    statement:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [FT](#%28tech._ft%29) -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â does an-ftree contain a child |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â structure with "blue" in the eyes field |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (blue-eyed-child?Â an-ftree)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(no-parent?Â an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (blue-eyed-child?
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (child-fatherÂ an-ftree))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (blue-eyed-child?
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (child-motherÂ an-ftree))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-nameÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-dateÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (child-eyesÂ an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'When you work in this fashion, you must replace the templateâ€™s generic name
    with a specific one.Checking with our recipe, we realize that we need to backtrack
    and develop some examples before we move on to the definition step. If we start
    with Carl, the first person in the family tree, we see that Carlâ€™s family tree
    does not contain a child with a "blue" eye color. Specifically, the child representing
    Carl says the eye color is "green"; given that Carlâ€™s ancestor trees are empty,
    they cannot possibly contain a child with "blue" eye color:'
  prefs: []
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-child?Â Carl)Â #false)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'In contrast, Gustav contains a child for Eva who does have blue eyes:'
  prefs: []
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-child?Â Gustav)Â #true)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Now we are ready to define the actual function. The function distinguishes
    between two cases: a no-parent and a child. For the first case, the answer should
    be obvious even though we havenâ€™t made up any examples. Since the given family
    tree does not contain any child whatsoever, it cannot contain one with "blue"
    as the eye color. Hence the result in the first [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause is #false.'
  prefs: []
  type: TYPE_NORMAL
- en: 'For the second [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause, the design requires a lot more work. Again following the design recipe,
    we first remind ourselves what the expressions in the template accomplish:'
  prefs: []
  type: TYPE_NORMAL
- en: according to the purpose statement for the function,
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: (blue-eyed-child?Â (child-fatherÂ an-ftree))
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: determines whether some child in the fatherâ€™s [FT](#%28tech._ft%29) has "blue"
    eyes;
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: likewise, (blue-eyed-child?  (child-mother  an-ftree)) determines whether someone
    in the motherâ€™s [FT](#%28tech._ft%29) has blue eyes; and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: the selector expressions (child-name  an-ftree), (child-date  an-ftree), and
    (child-eyes  an-ftree) extract the name, birth date, and eye color from the given
    child structure, respectively.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now we just need to figure out how to combine these expressions.
  prefs: []
  type: TYPE_NORMAL
- en: 'Clearly, if the child structure contains "blue" in the eyes field, the functionâ€™s
    answer is #true. Next, the expressions concerning names and birth dates are useless,
    which leaves us with the recursive calls. As stated, (blue-eyed-child?  (child-father  an-ftree))
    traverses the tree on the fatherâ€™s side, while the motherâ€™s side of the family
    tree is processed with (blue-eyed-child?  (child-mother  an-ftree)). If either
    of these expressions returns #true, an-ftree contains a child with "blue" eyes.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Our analysis suggests that the result should be #true if one of the following
    three expressions is #true:'
  prefs: []
  type: TYPE_NORMAL
- en: ([string=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29)  (child-eyes  an-ftree)  "blue")
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: (blue-eyed-child?  (child-father  an-ftree))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: (blue-eyed-child?  (child-mother  an-ftree))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'which, in turn, means we need to combine these expressions with [or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â ([string=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29)Â (child-eyesÂ an-ftree)Â "blue")
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (blue-eyed-child?Â (child-fatherÂ an-ftree)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (blue-eyed-child?Â (child-motherÂ an-ftree))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '[FigureÂ 113](#%28counter._%28figure._fig~3ablue-eyes%29%29) pulls everything
    together in a single definition.'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [FT](#%28tech._ft%29) -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â does an-ftree contain a child |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â structure with "blue" in the eyes field |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-child?Â Carl)Â #false)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-child?Â Gustav)Â #true)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (blue-eyed-child?Â an-ftree)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(no-parent?Â an-ftree)Â #false] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â ([string=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29)Â (child-eyesÂ an-ftree)Â "blue")
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â (blue-eyed-child?Â (child-fatherÂ an-ftree)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â (blue-eyed-child?Â (child-motherÂ an-ftree)))])) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 113: Finding a blue-eyed child in an ancestor tree'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Since this function is the very first one to use two recursions, we simulate
    the stepperâ€™s action for (blue-eyed-child?  Carl) to give you an impression of
    how it all works:'
  prefs: []
  type: TYPE_NORMAL
- en: '| (blue-eyed-child?Â Carl) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| == |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (blue-eyed-child? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (make-childÂ NPÂ NPÂ "Carl"Â 1926Â "green")) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Letâ€™s act as if NP were a value and letâ€™s use carl as an abbreviation for the
    instance of child:'
  prefs: []
  type: TYPE_NORMAL
- en: '| == |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â [(no-parent? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â (make-childÂ NPÂ NPÂ "Carl"Â 1926Â "green")) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â #false] |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â ([string=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29)Â (child-eyesÂ carl)Â "blue")
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â (blue-eyed-child?Â (child-fatherÂ carl)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â (blue-eyed-child?Â (child-motherÂ carl)))]) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'After dropping the first [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    line, itâ€™s time to replace carl with its value and to perform the three auxiliary
    calculations in [figureÂ 114](#%28counter._%28figure._fig~3acalc-trees%29%29).
    Using these to replace equals with equals, the rest of the computation is explained
    easily:'
  prefs: []
  type: TYPE_NORMAL
- en: '| == |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â ([string=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29)Â "green"Â "blue")
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (blue-eyed-child?Â (child-fatherÂ carl)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (blue-eyed-child?Â (child-motherÂ carl))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â #falseÂ #falseÂ #false)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â #false |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: While we trust that you have seen such auxiliary calculations in your mathematics
    courses, you also need to understand that the stepper would not perform such calculations;
    instead it works out only those calculations that are absolutely needed.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â (1) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| (child-eyesÂ (make-childÂ NPÂ NPÂ "Carl"Â 1926Â "green")) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| == |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| "green" |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â (2) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| (blue-eyed-child? |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (child-father |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (make-childÂ NPÂ NPÂ "Carl"Â 1926Â "green"))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| == |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| (blue-eyed-child?Â NP) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| == |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| #false |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â (3) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| (blue-eyed-child? |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (child-mother |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (make-childÂ NPÂ NPÂ "Carl"Â 1926Â "green"))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| == |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| (blue-eyed-child?Â NP) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| == |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| #false |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 114: Calculating with trees'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ExerciseÂ 310\. Develop count-persons. The function consumes a family tree and
    counts the child structures in the tree.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 311\. Develop the function average-age. It consumes a family tree and
    the current year. It produces the average age of all child structures in the family
    tree.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 312\. Develop the function eye-colors, which consumes a family tree
    and produces a list of all eye colors in the tree. An eye color may occur more
    than once in the resulting list. Hint Use [append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29)
    to concatenate the lists resulting from the recursive calls.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 313\. Suppose we need the function blue-eyed-ancestor?, which is like
    blue-eyed-child? but responds with #true only when a proper ancestor, not the
    given child itself, has blue eyes.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Although the goals clearly differ, the signatures are the same:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [FT](#%28tech._ft%29) -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (blue-eyed-ancestor?Â an-ftree)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Stop! Formulate a purpose statement for the function.To appreciate the difference,
    we take a look at Eva:'
  prefs: []
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-child?Â Eva)Â #true)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Eva is blue-eyed, but has no blue-eyed ancestor. Hence,
  prefs: []
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-ancestor?Â Eva)Â #false)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'In contrast, Gustav is Evaâ€™s son and does have a blue-eyed ancestor:'
  prefs: []
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-ancestor?Â Gustav)Â #true)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Now suppose a friend comes up with this solution:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (blue-eyed-ancestor?Â an-ftree)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(no-parent?Â an-ftree)Â #false] |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â (blue-eyed-ancestor? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â (child-fatherÂ an-ftree)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â (blue-eyed-ancestor? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â (child-motherÂ an-ftree)))])) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Explain why this function fails one of its tests. What is the result of (blue-eyed-ancestor?  A)
    no matter which A you choose? Can you fix your friendâ€™s solution?
  prefs: []
  type: TYPE_NORMAL
- en: Note on variable and structure names The initial discussion of family relationships
    suggests the name child for the structure type definition. The five pieces of
    information represent the child of particular parents. The rest of the development
    is about ancestor trees, however. If you were to skim the chapter just to focus
    on function definitions, like the one in [figureÂ 113](#%28counter._%28figure._fig~3ablue-eyes%29%29),
    the names child-father, child-mother, and child-eyes might mislead you a bit,
    mostly because they might seem to conflict with the recursive nature of the function.
    An experienced developer would probably use DrRacketâ€™s renaming functionalityCheck
    syntax. Right-click on the name of the structure. Select rename. to replace child
    with person. In general, variable naming are critical for helping readers of code
    to understand the thinking behind it.
  prefs: []
  type: TYPE_NORMAL
- en: 19.2Forests[ğŸ”—](#(part._sec~3aforests) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'It is a short step from a family tree to a family forest:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An FF (short for family forest) is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [FT](#%28tech._ft%29)  [FF](#%28tech._ff%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â interpretation a family forest represents several |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â families (say, a town) and their ancestor trees |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Here are some tree excerpts from [figureÂ 111](#%28counter._%28figure._fig~3afamily-tree%29%29)
    arranged as forests:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ff1Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â CarlÂ Bettina))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ff2Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â FredÂ Eva))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ff3Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â FredÂ EvaÂ Carl))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The first two forests contain two unrelated families, and the third one illustrates
    that unlike in real forests, trees in family forests can overlap.Now consider
    this representative problem concerning family trees:'
  prefs: []
  type: TYPE_NORMAL
- en: Sample Problem Design the function blue-eyed-child-in-forest?, which determines
    whether a family forest contains a child with "blue" in the eyes field.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| ;Â [FF](#%28tech._ff%29) -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â does the forest contain any child with "blue"  eyes |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-child-in-forest?Â ff1)Â #false)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-child-in-forest?Â ff2)Â #true)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (blue-eyed-child-in-forest?Â ff3)Â #true)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (blue-eyed-child-in-forest?Â a-forest)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â a-forest)Â #false]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â (blue-eyed-child?Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â a-forest))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â (blue-eyed-child-in-forest?Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â a-forest)))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 115: Finding a blue-eyed child in a family forest'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The straightforward solution is displayed in [figureÂ 115](#%28counter._%28figure._fig~3ablue-eyed-child%29%29).
    Study the signature, the purpose statement, and the examples on your own. We focus
    on the program organization. Concerning the template, the design may employ the
    list template because the function consumes a list. If each item on the list were
    a structure with an eyes field and nothing else, the function would iterate over
    those structures using the selector function for the eyes field and a string comparison.
    In this case, each item is a family tree, but, luckily, we already know how to
    process family trees.
  prefs: []
  type: TYPE_NORMAL
- en: Letâ€™s step back and inspect how we explained [figureÂ 115](#%28counter._%28figure._fig~3ablue-eyed-child%29%29).
    The starting point is a pair of data definitions where the second refers to the
    first and both refer to themselves. The result is a pair of functions where the
    second refers to the first and both refer to themselves. In other words, the function
    definitions refer to each other the same way the data definitions refer to each
    other. Early chapters gloss over this kind of relationship, but now the situation
    is sufficiently complicated and deserves attention.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 314\. Reformulate the data definition for [FF](#%28tech._ff%29) with
    the [List-of](part_three.html#%28tech._sim-dd._list._of%29) abstraction. Now do
    the same for the blue-eyed-child-in-forest? function. Finally, define blue-eyed-child-in-forest?
    using one of the list abstractions from the preceding chapter.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 315\. Design the function average-age. It consumes a family forest
    and a year ([N](part_two.html#%28tech._n%29)). From this data, it produces the
    average age of all child instances in the forest. Note If the trees in this forest
    overlap, the result isnâ€™t a true average because some people contribute more than
    others. For this exercise, act as if the trees donâ€™t overlap.
  prefs: []
  type: TYPE_NORMAL
- en: 19.3S-expressions[ğŸ”—](#(part._sec~3asexp) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'While [Intermezzo 2: Quote, Unquote](i2-3.html) introduced S-expressions on
    an informal basis, it is possible to describe them with a combination of three
    data definitions:'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â An S-expr is one of: &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  [Atom](#%28tech._atom%29) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  [SL](#%28tech._sl%29) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â  &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â An SL is one of: &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  ''() &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [S-expr](#%28tech._s._expr%29)  [SL](#%28tech._sl%29))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â An Atom is one of: &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  [Number](part_one.html#%28tech._number%29) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  [String](part_one.html#%28tech._string%29) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  [Symbol](i2-3.html#%28tech._symbol%29) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Recall that [Symbol](i2-3.html#%28tech._symbol%29)s look like strings with a
    single quote at the beginning and with no quote at the end.
  prefs: []
  type: TYPE_NORMAL
- en: 'The idea of S-expressions is due to John McCarthy and his Lispers, who created
    S-expressions in 1958 so that they could process Lisp programs with other Lisp
    programs. This seemingly circular reasoning may sound esoteric, but, as mentioned
    in [Intermezzo 2: Quote, Unquote](i2-3.html), S-expressions are a versatile form
    of data that is often rediscovered, most recently with applications to the world
    wide web. Working with S-expressions thus prepares a discussion of how to design
    functions for highly intertwined data definitions.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 316\. Define the atom? function.
  prefs: []
  type: TYPE_NORMAL
- en: 'Up to this point in this book, no data has required a data definition as complex
    as the one for S-expressions. And yet, with one extra hint, you can design functions
    that process S-expressions if you follow the design recipe. To demonstrate this
    point, letâ€™s work through a specific example:'
  prefs: []
  type: TYPE_NORMAL
- en: Sample Problem Design the function count, which determines how many times some
    symbol occurs in some S-expression.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'While the first step calls for data definitions and appears to have been completed,
    remember that it also calls for the creation of data examples, especially when
    the definition is complex.A data definition is supposed to be a prescription of
    how to create data, and its â€œtestâ€ is whether it is usable. One point that the
    data definition for [S-expr](#%28tech._s._expr%29) makes is that every [Atom](#%28tech._atom%29)
    is an element of [S-expr](#%28tech._s._expr%29), and you know that [Atom](#%28tech._atom%29)s
    are easy to fabricate:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ''hello |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| 20.12 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "world" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'In the same vein, every [SL](#%28tech._sl%29) is a list as well as an [S-expr](#%28tech._s._expr%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ''helloÂ ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 20.12Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â "world"Â ''())))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ''helloÂ ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 20.12Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â "world"Â ''())))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â ''()) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The first two are obvious; the third one deserves a second look. It repeats
    the second [S-expr](#%28tech._s._expr%29) but nested inside ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  ''()).
    What this means is that it is a list that contains a single item, namely, the
    second example. You can simplify the example with [list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ''helloÂ ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 20.12Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â "world"Â ''()))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â or |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â ''helloÂ 20.12Â "world"))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Indeed, with the quotation mechanism of [Intermezzo 2: Quote, Unquote](i2-3.html)
    it is even easier to write down S-expressions. Here are the last three:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ''(helloÂ 20.12Â "world") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (list ''hello #i20.12 "world") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ''((helloÂ 20.12Â "world")) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (list (list ''hello #i20.12 "world")) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'To help you out, we evaluate these examples in the interactions area of DrRacket
    so that you can see the result, which is closer to the above constructions than
    the [quote](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29)
    notation.With [quote](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29),
    it is quite easy to make up complex examples:'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; > ''(defineÂ (fÂ x) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â (+Â xÂ 55)) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| (list ''define (list ''f ''x) (list ''+ ''x 55)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'This example may strike you as odd because it looks like a definition in BSL,
    but, as the interaction with DrRacket shows, it is just a piece of data. Here
    is another one:'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; > ''((6Â f) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (5Â e) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (4Â d)) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| (list (list 6 ''f) (list 5 ''e) (list 4 ''d)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'This piece of data looks like a table, associating letters with numbers. The
    last example is a piece of art:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > ''(wingÂ (wingÂ bodyÂ wing)Â wing) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (list ''wing (list ''wing ''body ''wing) ''wing) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'It is now time to write down the rather obvious header for count:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [S-expr](#%28tech._s._expr%29)  [Symbol](i2-3.html#%28tech._symbol%29)
    -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â counts all occurrences of sy in sexp |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (countÂ sexpÂ sy)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â 0) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Since the header is obvious, we move on to functional examples. If the given
    [S-expr](#%28tech._s._expr%29) is ''world and the to-be-counted symbol is ''world,
    the answer is obviously 1. Here are some more examples, immediately formulated
    as tests:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (countÂ ''worldÂ ''hello)Â 0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (countÂ ''(worldÂ hello)Â ''hello)Â 1)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (countÂ ''(((world)Â hello)Â hello)Â ''hello)Â 2)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'You can see how convenient quotation notation is for test cases. When it comes
    to templates, however, thinking in terms of [quote](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29)
    is disastrous.Before we move on to the template step, we need to prepare you for
    the next generalization of the design recipe:'
  prefs: []
  type: TYPE_NORMAL
- en: Hint For intertwined data definitions, create one template per data definition.
    Create them in parallel. Make sure they refer to each other in the same way the
    data definitions do. End
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'This hint sounds more complicated than it is. For our problem, it means we
    need three templates:'
  prefs: []
  type: TYPE_NORMAL
- en: one for count, which counts occurrences of symbols in [S-expr](#%28tech._s._expr%29)s;
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: one for a function that counts occurrences of symbols in [SL](#%28tech._sl%29)s;
    and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: one for a function that counts occurrences of symbols in [Atom](#%28tech._atom%29)s.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'And here are three partial templates, with conditionals as suggested by the
    three data definitions:'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (countÂ sexpÂ sy)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â [(atom?Â sexp)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â  &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (count-slÂ slÂ sy)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â sl)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (count-atomÂ atÂ sy)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([number?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29)Â at)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29)Â at)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)Â at)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The template for count contains a two-pronged conditional because the data
    definition for [S-expr](#%28tech._s._expr%29) has two clauses. It uses the atom?
    function to distinguish the case for [Atom](#%28tech._atom%29)s from the case
    for [SL](#%28tech._sl%29)s. The template named count-sl consumes an element of
    [SL](#%28tech._sl%29) and a symbol, and because [SL](#%28tech._sl%29) is basically
    a list, count-sl also contains a two-pronged [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29).
    Finally, count-atom is supposed to work for both [Atom](#%28tech._atom%29)s and
    [Symbol](i2-3.html#%28tech._symbol%29)s. And this means that its template checks
    for the three distinct forms of data mentioned in the data definition of [Atom](#%28tech._atom%29).The
    next step is to take apart compound data in the relevant clauses:'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (countÂ sexpÂ sy)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â [(atom?Â sexp)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â  &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (count-slÂ slÂ sy)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â sl)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â sl)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â sl))]))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (count-atomÂ atÂ sy)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([number?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29)Â at)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29)Â at)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)Â at)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Why do we add just two selector expressions to count-sl?The last step in the
    template creation process calls for an inspection of self-references in the data
    definitions. In our context, this means self-references and references from one
    data definition to another and (possibly) back. Letâ€™s inspect the [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    lines in the three templates:'
  prefs: []
  type: TYPE_NORMAL
- en: The atom? line in count corresponds to the first line in the definition of [S-expr](#%28tech._s._expr%29).
    To indicate the cross-reference from here to [Atom](#%28tech._atom%29), we add
    (count-atom  sexp  sy), meaning we interpret sexp as an [Atom](#%28tech._atom%29)
    and let the appropriate function deal with it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Following the same line of thought, the second [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    line in count calls for the addition of (count-sl  sexp  sy).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The [empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)
    line in count-sl corresponds to a line in the data definition that makes no reference
    to another data definition.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In contrast, the [else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    line contains two selector expressions, and each extracts a different kind of
    value. Specifically, ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  sl)
    is an element of [S-expr](#%28tech._s._expr%29), which means that we wrap it in
    (count  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)).
    After all, count is responsible for counting inside of arbitrary [S-expr](#%28tech._s._expr%29)s.
    Next, ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  sl)
    corresponds to a self-reference, and we know that we need to deal with those via
    recursive function calls.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, all three cases in [Atom](#%28tech._atom%29) refer to atomic forms
    of data. Therefore the count-atom function does not need to change.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (countÂ sexpÂ sy)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â [(atom?Â sexp) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (count-atomÂ sexpÂ sy)] &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (count-slÂ sexpÂ sy)])) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â  &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (count-slÂ slÂ sy)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â sl)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â (countÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â sl)Â sy)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â (count-slÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â sl)Â sy)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (count-atomÂ atÂ sy)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([number?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29)Â at)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29)Â at)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â [([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)Â at)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 116: A template for S-expressions'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| ;Â [S-expr](#%28tech._s._expr%29)  [Symbol](i2-3.html#%28tech._symbol%29)
    -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â counts all occurrences of sy in sexp |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (countÂ sexpÂ sy)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â [(atom?Â sexp)Â (count-atomÂ sexpÂ sy)] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (count-slÂ sexpÂ sy)]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [SL](#%28tech._sl%29)  [Symbol](i2-3.html#%28tech._symbol%29) -> [N](part_two.html#%28tech._n%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â counts all occurrences of sy in sl |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (count-slÂ slÂ sy)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â sl)Â 0]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â (countÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â sl)Â sy)Â (count-slÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â sl)Â sy))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Atom](#%28tech._atom%29)  [Symbol](i2-3.html#%28tech._symbol%29) -> [N](part_two.html#%28tech._n%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â counts all occurrences of sy in at |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (count-atomÂ atÂ sy)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([number?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29)Â at)Â 0]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29)Â at)Â 0]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)Â at)Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([symbol=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29)Â atÂ sy)Â 1Â 0)]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 117: A program for S-expressions'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 116](#%28counter._%28figure._fig~3asexp-template%29%29) presents the
    three complete templates. Filling in the blanks in these templates is straightforward,
    as [figureÂ 117](#%28counter._%28figure._fig~3asexp-function%29%29) shows. You
    ought to be able to explain any random line in the three definitions. For example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[(atom?Â sexp)Â (count-atomÂ sexpÂ sy)]'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: determines whether sexp is an [Atom](#%28tech._atom%29) and, if so, interprets
    the [S-expr](#%28tech._s._expr%29) as an [Atom](#%28tech._atom%29) via count-atom.
  prefs: []
  type: TYPE_NORMAL
- en: '| [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â (countÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â sl)Â sy)Â (count-slÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â sl)Â sy))]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'means the given list consists of two parts: an [S-expr](#%28tech._s._expr%29)
    and an [SL](#%28tech._sl%29). By using count and count-sl, the corresponding functions
    are used to count how often sy appears in each part, and the two numbers are added
    upâ€”<wbr>yielding the total number of sys in all of sexp.'
  prefs: []
  type: TYPE_NORMAL
- en: '[([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)Â at)Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([symbol=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29)Â atÂ sy)Â 1Â 0)]'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: tells us that if an [Atom](#%28tech._atom%29) is a [Symbol](i2-3.html#%28tech._symbol%29),
    sy occurs once if it is equal to sexp and otherwise it does not occur at all.
    Since the two pieces of data are atomic, there is no other possibility.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 317\. A program that consists of three connected functions ought to
    express this relationship with a [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    expression.
  prefs: []
  type: TYPE_NORMAL
- en: Copy and reorganize the program from [figureÂ 117](#%28counter._%28figure._fig~3asexp-function%29%29)
    into a single function using [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29).
    Validate the revised code with the test suite for count.
  prefs: []
  type: TYPE_NORMAL
- en: The second argument to the local functions, sy, never changes. It is always
    the same as the original symbol. Hence you can eliminate it from the local function
    definitions to tell the reader that sy is a constant across the traversal process.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 318\. Design depth. The function consumes an S-expression and determines
    its depth. An [Atom](#%28tech._atom%29) has a depth of 1. The depth of a list
    of S-expressions is the maximum depth of its items plus 1.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 319\. Design substitute. It consumes an S-expression s and two symbols,
    old and new. The result is like s with all occurrences of old replaced by new.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 320\. Practice the step from data definition to function design with
    two changes to the definition of [S-expr](#%28tech._s._expr%29).
  prefs: []
  type: TYPE_NORMAL
- en: For the first step, reformulate the data definition for [S-expr](#%28tech._s._expr%29)
    so that the first clause of the first data definition is expanded into the three
    clauses of [Atom](#%28tech._atom%29) and the second data definition uses the [List-of](part_three.html#%28tech._sim-dd._list._of%29)
    abstraction. Redesign the count function for this data definition.
  prefs: []
  type: TYPE_NORMAL
- en: For the second step, Integrate the data definition of [SL](#%28tech._sl%29)
    into the one for [S-expr](#%28tech._s._expr%29). Simplify count again. Hint Use
    [lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 321\. Abstract the data definitions for [S-expr](#%28tech._s._expr%29)
    and [SL](#%28tech._sl%29) so that they abstract over the kinds of [Atom](#%28tech._atom%29)s
    that may appear.
  prefs: []
  type: TYPE_NORMAL
- en: 19.4Designing with Intertwined Data[ğŸ”—](#(part._sec~3adesign-.N) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'The jump from self-referential data definitions to collections of data definitions
    with mutual references is far smaller than the one from data definitions for finite
    data to self-referential data definitions. Indeed, the design recipe for self-referential
    data definitionsâ€”<wbr>see [Designing with Self-Referential Data Definitions](part_two.html#%28part._ch~3adesign-lists%29)â€”<wbr>needs
    only minor adjustments to apply to this seemingly complex situation:'
  prefs: []
  type: TYPE_NORMAL
- en: The need for â€œnestsâ€ of mutually related data definitions is similar to the
    one to the need for self-referential data definitions. The problem statement deals
    with many distinct kinds of information, and one form of information refers to
    other kinds.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Before you proceed in such situations, draw arrows to connect references to
    definitions. Consider the left side of [figureÂ 118](#%28counter._%28figure._fig~3adef-data-mutual-arrows%29%29).
    It displays the definition for [S-expr](#%28tech._s._expr%29), which contains
    references to [SL](#%28tech._sl%29) and [Atom](#%28tech._atom%29) that are connected
    to their respective definitions via arrows. Similarly, the definition of [SL](#%28tech._sl%29)
    contains one self-reference and one reference back to [S-expr](#%28tech._s._expr%29);
    again, both are connected by appropriate arrows.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Like self-referential data definitions, these nests of definitions also call
    for validation. At a minimum, you must be able to construct some examples for
    every individual definition. Start from clauses that do not refer to any of the
    other data definitions in the nest. Keep in mind that the definition may be invalid
    if it is impossible to generate examples from them.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The key change is that you must design as many functions in parallel as there
    are data definitions. Each function specializes for one of the data definitions;
    all remaining arguments remain the same. Based on that, you start with a signature,
    a purpose statement, and a dummy definition for each function.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Be sure to work through functional examples that use all mutual references in
    the nest of data definitions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For each function, design the template according to its primary data definition.
    Use [figureÂ 52](part_two.html#%28counter._%28figure._fig~3atemplate-q%29%29) to
    guide the template creation up to the last step. The revised last step calls for
    a check for all self-references and cross-references. Use the data definitions
    annotated with arrows to guide this step. For each arrow in the data definitions,
    include an arrow in the templates. See the right side of [figureÂ 118](#%28counter._%28figure._fig~3adef-data-mutual-arrows%29%29)
    for the arrow-annotated version of the templates.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '| ![image](../Images/cd031d07b7f1b4ecf6374520e88fbf20.png) |  | ![image](../Images/dac9d151af1b0eb7c0ee3406eab0db2a.png)
    |'
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 118: Arrows for nests of data definitions and templates'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: Now replace the arrows with actual function calls. As you gain experience, you
    will naturally skip the arrow-drawing step and use function calls directly.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Note Observe how both nestsâ€”<wbr>the one for data definitions and the one for
    function templatesâ€”<wbr>contain four arrows, and note how pairs of arrows correspond
    to each other. Researchers call this correspondence a symmetry. It is evidence
    that the design recipe provides a natural way for going from problems to solutions.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: For the design of the body, we start with those [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    lines that do not contain natural recursions or calls to other functions. They
    are called base cases. The corresponding answers are typically easy to formulate
    or are already given by the examples. After that, you deal with the self-referential
    cases and the cases of cross-function calls. Let the questions and answers of
    [figureÂ 53](part_two.html#%28counter._%28figure._fig~3adefinition-q%29%29) guide
    you.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run the tests when all definitions are completed. If an auxiliary function is
    broken, you may get two error reports, one for the main function and another one
    for the flawed auxiliary definition. A single fix should eliminate both. Do make
    sure that running the tests covers all the pieces of the function.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, if you are stuck in step 5, remember the table-based approach to guessing
    the combination function. In the case of intertwined data, you may need not only
    a table per case but also a table per case and per function to work out the combination.
  prefs: []
  type: TYPE_NORMAL
- en: '19.5Project: BSTs[ğŸ”—](#(part._sec~3aproj-bst) "Link to here")'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Programmers often work with tree representations of data to improve the performance
    of their functions. A particularly well-known form of tree is the binary search
    tree because it is a good way to store and retrieve information quickly.
  prefs: []
  type: TYPE_NORMAL
- en: 'To be concrete, letâ€™s discuss binary trees that manage information about people.
    Instead of the child structures in family trees, a binary tree contains nodes:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â no-infoÂ [])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â NONEÂ (make-no-info))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â nodeÂ [ssnÂ nameÂ [left](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29)Â [right](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29)])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A BT (short for BinaryTree) is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  NONE |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-node  [Number](part_one.html#%28tech._number%29)  [Symbol](i2-3.html#%28tech._symbol%29)  [BT](#%28tech._bt%29)  [BT](#%28tech._bt%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The corresponding data definition is like the one for family trees with NONE
    indicating a lack of information and each node recording a social security number,
    a name, and two other binary trees. The latter are like the parents of family
    trees, though the relationship between a node and its [left](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29)
    and [right](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29)
    trees is not based on family relationships.Here are two binary trees:'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (make-node &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â 15 &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ''d &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â NONE &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â (make-node &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â 24Â ''iÂ NONEÂ NONE)) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (make-node &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â 15 &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ''d &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â (make-node &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â 87Â ''hÂ NONEÂ NONE) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â NONE) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 119](#%28counter._%28figure._fig~3abst%29%29) shows how we should think
    about such trees as drawings. The trees are drawn upside down, with the root at
    the top and the crown of the tree at the bottom. Each circle corresponds to a
    node, labeled with the ssn field of a corresponding node structure. The drawings
    omit NONE.'
  prefs: []
  type: TYPE_NORMAL
- en: '| tree A |  | tree B |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '|  |  |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ![image](../Images/4a6656d66e6ecde910040436499df1cd.png) |  | ![image](../Images/5bf6b2a3ec9a774b865e4865edc764ae.png)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 119: A binary search tree and a binary tree'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ExerciseÂ 322\. Draw the above two trees in the manner of [figureÂ 119](#%28counter._%28figure._fig~3abst%29%29).
    Then design contains-bt?, which determines whether a given number occurs in some
    given BT.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 323\. Design search-bt. The function consumes a number n and a BT.
    If the tree contains a node structure whose ssn field is n, the function produces
    the value of the [name](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._name%29%29)
    field in that node. Otherwise, the function produces #false.'
  prefs: []
  type: TYPE_NORMAL
- en: Hint Consider using contains-bt? to check the entire tree first or [boolean?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29)
    to check the result of the natural recursion at each stage.
  prefs: []
  type: TYPE_NORMAL
- en: 'If we read the numbers in the two trees in [figureÂ 119](#%28counter._%28figure._fig~3abst%29%29)
    from left to right, we obtain two different sequences:'
  prefs: []
  type: TYPE_NORMAL
- en: '| tree A |  | 10 |  | 15 |  | 24 |  | 29 |  | 63 |  | 77 |  | 89 |  | 95 |  |
    99 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| tree B |  | 87 |  | 15 |  | 24 |  | 29 |  | 63 |  | 33 |  | 89 |  | 95 |  |
    99 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The sequence for tree A is sorted in ascending order the one for B is not.
    A binary tree of the first kind is a binary search tree. Every binary search tree
    is a binary tree, but not every binary tree is a binary search tree. More concretely,
    we formulate a conditionâ€”<wbr>or data invariantâ€”<wbr>that distinguishes a binary
    search tree from a binary tree:'
  prefs: []
  type: TYPE_NORMAL
- en: The BST Invariant
  prefs: []
  type: TYPE_NORMAL
- en: 'A BST (short for binary search tree) is a [BT](#%28tech._bt%29) according to
    the following conditions:'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: NONE is always a [BST](#%28tech._bst%29).
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: (make-node  ssn0  name0  L  R) is a [BST](#%28tech._bst%29) if
  prefs:
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: L is a [BST](#%28tech._bst%29),
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: R is a [BST](#%28tech._bst%29),
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: all ssn fields in L are smaller than ssn0,
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: all ssn fields in R are larger than ssn0.
  prefs:
  - PREF_BQ
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: In other words, to check whether a [BT](#%28tech._bt%29) also belongs to [BST](#%28tech._bst%29),
    we must inspect all numbers in all subtrees and ensure that they are smaller or
    larger than some given number. This places an additional burden on the construction
    of data, but, as the following exercises show, it is well worth it.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 324\. Design the function inorder. It consumes a binary tree and produces
    the sequence of all the ssn numbers in the tree as they show up from left to right
    when looking at a tree drawing.
  prefs: []
  type: TYPE_NORMAL
- en: 'Hint Use [append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29),
    which concatenates lists like thus:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29)Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 1Â 2Â 3)Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 4)Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 5Â 6Â 7))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| == |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 1Â 2Â 3Â 4Â 5Â 6Â 7)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: What does inorder produce for a binary search tree?
  prefs: []
  type: TYPE_NORMAL
- en: Looking for a node with a given ssn in a BST may exploit the [BST](#%28tech._bst%29)
    invariant. To find out whether a BT contains a node with a specific ssn, a function
    may have to look at every node of the tree. In contrast, to find out whether a
    binary search tree contains the same ssn, a function may eliminate one of two
    subtrees for every node it inspects.
  prefs: []
  type: TYPE_NORMAL
- en: 'Letâ€™s illustrate the idea with this sample BST:'
  prefs: []
  type: TYPE_NORMAL
- en: (make-nodeÂ 66Â 'aÂ LÂ R)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: If we are looking for 66, we have found the node we are looking for. Now, if
    we are looking for a smaller number, say 63, we can focus the search on L because
    all nodes with ssn fields smaller than 66 are in L. Similarly, if we were to look
    for 99, we would ignore L and focus on R because all nodes with ssns larger than
    66 are in R.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 325\. Design search-bst. The function consumes a number n and a BST.
    If the tree contains a node whose ssn field is n, the function produces the value
    of the [name](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._name%29%29)
    field in that node. Otherwise, the function produces NONE. The function organization
    must exploit the BST invariant so that the function performs as few comparisons
    as necessary.
  prefs: []
  type: TYPE_NORMAL
- en: See [exerciseÂ 189](part_two.html#%28counter._%28exercise._ex~3asort2%29%29)
    for searching in sorted lists. Compare!
  prefs: []
  type: TYPE_NORMAL
- en: Building a binary tree is easy; building a binary search tree is complicated.
    Given any two [BT](#%28tech._bt%29)s, a number, and a name, we simply apply make-node
    to these values in the correct order, and voilÃ , we get a new [BT](#%28tech._bt%29).
    This same procedure fails for [BST](#%28tech._bst%29)s because the result would
    typically not be a BST. For example, if one [BST](#%28tech._bst%29) contains nodes
    with ssn fields 3 and 5 in the correct order, and the other one contains ssn fields
    2 and 6, simply combining the two trees with another social security number and
    a name does not produce a [BST](#%28tech._bst%29).
  prefs: []
  type: TYPE_NORMAL
- en: The remaining two exercises explain how to build a [BST](#%28tech._bst%29) from
    a list of numbers and names. Specifically, the first exercise calls for a function
    that inserts a given ssn0 and name0 into a [BST](#%28tech._bst%29); that is, it
    produces a [BST](#%28tech._bst%29) like the one it is given with one more node
    inserted containing ssn0, name0, and NONE subtrees. The second exercise then requests
    a function that can deal with a complete list of numbers and names.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 326\. Design the function create-bst. It consumes a BST B, a number
    N, and a symbol S. It produces a BST that is just like B and that in place of
    one NONE subtree contains the node structure
  prefs: []
  type: TYPE_NORMAL
- en: (make-nodeÂ NÂ SÂ NONEÂ NONE)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Once the design is completed, use the function on tree A from [figureÂ 119](#%28counter._%28figure._fig~3abst%29%29).ExerciseÂ 327\.
    Design the function create-bst-from-list. It consumes a list of numbers and names
    and produces a [BST](#%28tech._bst%29) by repeatedly applying create-bst. Here
    is the signature:'
  prefs: []
  type: TYPE_NORMAL
- en: ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29) [[List](part_three.html#%28tech._sim-dd._list%29)
    Number Symbol]] -> [BST](#%28tech._bst%29)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Use the complete function to create a [BST](#%28tech._bst%29) from this sample
    input:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ''((99Â o) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (77Â l) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (24Â i) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (10Â h) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (95Â g) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (15Â d) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (89Â c) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (29Â b) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (63Â a)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The result is tree A in [figureÂ 119](#%28counter._%28figure._fig~3abst%29%29),
    if you follow the structural design recipe. If you use an existing abstraction,
    you may still get this tree but you may also get an â€œinvertedâ€ one. Why?
  prefs: []
  type: TYPE_NORMAL
- en: 19.6Simplifying Functions[ğŸ”—](#(part._sec~3asimplification) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: '[ExerciseÂ 317](#%28counter._%28exercise._ex~3acount-local%29%29) shows how
    to use [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    to organize a function that deals with an intertwined form of data. This organization
    also helps simplify functions once we know that the data definition is final.
    To demonstrate this point, we explain how to simplify the solution of [exerciseÂ 319](#%28counter._%28exercise._ex~3asubstitute%29%29).'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [S-expr](#%28tech._s._expr%29)  [Symbol](i2-3.html#%28tech._symbol%29)  [Atom](#%28tech._atom%29)
    -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â replaces all occurrences of old in sexp with new |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (substituteÂ ''(((world)Â bye)Â bye)Â ''byeÂ ''42)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ''(((world)Â 42)Â 42)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (substituteÂ sexpÂ oldÂ new)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [S-expr](#%28tech._s._expr%29)
    -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-sexpÂ sexp)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [(atom?Â sexp)Â (for-atomÂ sexp)] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (for-slÂ sexp)]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [SL](#%28tech._sl%29) -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-slÂ sl)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â sl)Â ''()]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â (for-sexpÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â sl))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (for-slÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â sl)))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Atom](#%28tech._atom%29) -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-atomÂ at)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([number?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29)Â at)Â at]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29)Â at)Â at]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)Â at)Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([equal?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29)Â atÂ old)Â newÂ at)])))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (for-sexpÂ sexp))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 120: A program to be simplified'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 120](#%28counter._%28figure._fig~3asimplifying1%29%29) displays a complete
    definition of the substitute function. The definition uses [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    and three auxiliary functions as suggested by the data definition. The figure
    includes a test case so that you can retest the function after each edit suggested
    below. Stop! Develop additional test cases; one is almost never enough.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 328\. Copy and paste [figureÂ 120](#%28counter._%28figure._fig~3asimplifying1%29%29)
    into DrRacket; include your test suite. Validate the test suite. As you read along
    the remainder of this section, perform the edits and rerun the test suites to
    confirm the validity of our arguments.
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (substituteÂ sexpÂ oldÂ new)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [S-expr](#%28tech._s._expr%29)
    -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-sexpÂ sexp)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [(atom?Â sexp)Â (for-atomÂ sexp)] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (for-slÂ sexp)]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [SL](#%28tech._sl%29) -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-slÂ sl)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â for-sexpÂ sl))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Atom](#%28tech._atom%29) -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-atomÂ at)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([number?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29)Â at)Â at]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29)Â at)Â at]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)Â at)Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([equal?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29)Â atÂ old)Â newÂ at)])))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (for-sexpÂ sexp))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 121: Program simplification, step 1'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Since we know that [SL](#%28tech._sl%29) describes lists of [S-expr](#%28tech._s._expr%29),
    we can use [map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)
    to simplify for-sl. See [figureÂ 121](#%28counter._%28figure._fig~3asimplifying2%29%29)
    for the result. While the original program says that for-sexp is applied to every
    item on sl, its revised definition expresses the same idea more succinctly with
    [map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: For the second simplification step, we need to remind you that [equal?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29)
    compares two arbitrary values. With this in mind, the third [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    function becomes a one-liner. [FigureÂ 122](#%28counter._%28figure._fig~3asimplifying3%29%29)
    displays this second simplification.
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (substituteÂ sexpÂ oldÂ new)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [S-expr](#%28tech._s._expr%29)
    -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-sexpÂ sexp)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [(atom?Â sexp)Â (for-atomÂ sexp)] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (for-slÂ sexp)]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [SL](#%28tech._sl%29) -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-slÂ sl)Â ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â for-sexpÂ sl))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Atom](#%28tech._atom%29) -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-atomÂ at)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([equal?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29)Â atÂ old)Â newÂ at)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (for-sexpÂ sexp))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (substitute.v3Â sexpÂ oldÂ new)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [S-expr](#%28tech._s._expr%29)
    -> [S-expr](#%28tech._s._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (for-sexpÂ sexp)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [(atom?Â sexp) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([equal?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29)Â sexpÂ old)Â newÂ sexp)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â for-sexpÂ sexp)])))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (for-sexpÂ sexp))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 122: Program simplification, steps 2 and 3'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: At this point the last two [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    definitions consist of a single line. Furthermore, neither definition is recursive.
    Hence we can in-line the functions in for-sexp. In-lining means replacing (for-atom  sexp)
    with ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)  ([equal?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29)  sexp  old)  new  sexp),
    that is, we replace theWhile sexp is also a parameter, this substitution is really
    acceptable because it, too, stands in for an actual value. parameter at with the
    actual argument sexp. Similarly, for (for-sl  sexp) we put in ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)  for-sexp  sexp);
    see the bottom half of [figureÂ 121](#%28counter._%28figure._fig~3asimplifying2%29%29).
    All we are left with now is a function whose definition introduces one [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    function, which is called on the same major argument. If we systematically supplied
    the other two arguments, we would immediately see that the locally defined function
    can be used in lieu of the outer one.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the result of translating this last thought into code:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (substituteÂ sexpÂ oldÂ new)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(atom?Â sexp)Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([equal?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._equal~3f%29%29)Â sexpÂ old)Â newÂ sexp)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)Â (s)Â (substituteÂ sÂ oldÂ new))Â sexp)]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Stop! Explain why we had to use [lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)
    for this last simplification.
  prefs: []
  type: TYPE_NORMAL
- en: 20Iterative Refinement[ğŸ”—](#(part._ch~3afiles) "Link to here")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When you develop real-world programs, you may confront complex forms of information
    and the problem of representing them with data. The best strategy to approach
    this task is to use iterative refinement, a well-known scientific process. A scientistâ€™s
    problem is to represent a part of the real world, using some form of mathematics.
    The result of the effort is called a model. The scientist then tests the model
    in many ways, in particular by predicting the outcome of experiments. If the discrepancies
    between the predictions and the measurements are too large, the model is refined
    with the goal of improving the predictions. This iterative process continues until
    the predictions are sufficiently accurate.
  prefs: []
  type: TYPE_NORMAL
- en: Consider a physicist who wishes to predict a rocketâ€™s flight path. While a â€œrocket
    as a pointâ€ representation is simple, it is also quite inaccurate, failing to
    account for air friction, for example. In response, the physicist may add the
    rocketâ€™s rough contour and introduce the necessary mathematics to represent friction.
    This second model is a refinement of the first model. In general, a scientist
    repeatsâ€”<wbr>or as programmers say, iteratesâ€”<wbr>this process until the model
    predicts the rocketâ€™s flight path with sufficient accuracy.
  prefs: []
  type: TYPE_NORMAL
- en: A programmer trained in a computer science department should proceed like this
    physicist. The key is to find an accurate data representation of the real-world
    information and functions that process them appropriately. Complicated situations
    call for a refinement process to get to a sufficient data representation combined
    with the proper functions. The process starts with the essential pieces of information
    and adds others as needed. Sometimes a programmer must refine a model after the
    program has been deployed because users request additional functionality.
  prefs: []
  type: TYPE_NORMAL
- en: So far we have used iterative refinement for you when it came to complex forms
    of data. This chapter illustrates iterative refinement as a principle of program
    development with an extended example, representing and processing (portions of)
    a computerâ€™s file system. We start with a brief discussion of the file system
    and then iteratively develop three data representations. Along the way, we propose
    some programming exercises so that you see how the design recipe also helps modify
    existing programs.
  prefs: []
  type: TYPE_NORMAL
- en: 20.1Data Analysis[ğŸ”—](#(part._sec~3afiles-what) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Before you turn off DrRacket, you want to make sure that all your work is safely
    stashed away somewhere. Otherwise you have to reenter everythingA file is really
    a sequence of bytes, one after another. Try to define the class of files. when
    you fire up DrRacket next. So you ask your computer to save programs and data
    in files. A file is roughly a string.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/03add47aad5b4abed5766964bbdf1c3c.png)'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 123: A sample directory tree'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: On most computer systems, files are organized in directories or folders. Roughly
    speaking, a directory contains some files and some more directories. The latter
    are called sub-directories and may contain yet more sub-directories and files.
    Because of the hierarchy, we speak of directory trees.
  prefs: []
  type: TYPE_NORMAL
- en: '[FigureÂ 123](#%28counter._%28figure._fig~3aaccountant%29%29) contains a graphical
    sketch of a small directory tree, and the picture explains why computer scientists
    call them trees. Contrary to convention in computer science, the figure shows
    the tree growing upward, with a root directory named TS. The root directory contains
    one file, called read!, and two sub-directories, called Text and Libs, respectively.
    The first sub-directory, Text, contains only three files; the latter, Libs, contains
    only two sub-directories, each of which contains at least one file. Finally, each
    box has one of two annotations: a directory is annotated with DIR, and a file
    is annotated with a number, its size.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 329\. How many times does a file name read! occur in the directory
    tree TS? Can you describe the path from the root directory to the occurrences?
    What is the total size of all the files in the tree? What is the total size of
    the tree if each directory node has size 1? How many levels of directories does
    it contain?
  prefs: []
  type: TYPE_NORMAL
- en: 20.2Refining Data Definitions[ğŸ”—](#(part._sec~3afiles-models) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: '[ExerciseÂ 329](#%28counter._%28exercise._ex~3adir0%29%29) lists some of the
    questions that users routinely ask about directories. To answer such questions,
    the computerâ€™s operating system provides programs that can answer them. If you
    want to design such programs, you need to develop a data representation for directory
    trees.'
  prefs: []
  type: TYPE_NORMAL
- en: In this section, we use iterative refinement to develop three such data representations.
    For each stage, we need to decide which attributes to include and which to ignore.
    Consider the directory tree in [figureÂ 123](#%28counter._%28figure._fig~3aaccountant%29%29)
    and imagine how it is created. When a user first creates a directory, it is empty.
    As time goes by, the user adds files and directories. In general, a user refers
    to files by names but mostly thinks of directories as containers.
  prefs: []
  type: TYPE_NORMAL
- en: 'Model 1 Our thought experiment suggests that our first model should focus on
    files as atomic entities with a name and directories as containers. Here is a
    data definition that deals with directories as lists and files as strings, that
    is, their names:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â A Dir.v1 (short for directory) is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [File.v1](#%28tech._file..v1%29)  [Dir.v1](#%28tech._dir..v1%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Dir.v1](#%28tech._dir..v1%29)  [Dir.v1](#%28tech._dir..v1%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A File.v1 is a [String](part_one.html#%28tech._string%29). |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The names have a .v1 suffix to distinguish them from future refinements.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 330\. Translate the directory tree in [figureÂ 123](#%28counter._%28figure._fig~3aaccountant%29%29)
    into a data representation according to model 1\.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 331\. Design the function how-many, which determines how many files
    a given [Dir.v1](#%28tech._dir..v1%29) contains. Remember to follow the design
    recipe; [exerciseÂ 330](#%28counter._%28exercise._ex~3afile-example1%29%29) provides
    you with data examples.
  prefs: []
  type: TYPE_NORMAL
- en: 'Model 2 If you solved [exerciseÂ 331](#%28counter._%28exercise._ex~3adir-how-many1%29%29),
    you know that this first data definition is still reasonably simple. But, it also
    obscures the nature of directories. With this first representation, we would not
    be able to list all the names of the sub-directories of some given directory.
    To model directories in a more faithful manner than containers, we must introduce
    a structure type that combines a name with a container:'
  prefs: []
  type: TYPE_NORMAL
- en: ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â dirÂ [nameÂ content])
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'This new structure type, in turn, suggests the following revision of the data
    definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â A Dir.v2 is a structure: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â (make-dir  [String](part_one.html#%28tech._string%29)  [LOFD](#%28tech._lofd%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An LOFD (short for list of files and directories) is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [File.v2](#%28tech._file..v2%29)  LOFD)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Dir.v2](#%28tech._dir..v2%29)  [LOFD](#%28tech._lofd%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A File.v2 is a [String](part_one.html#%28tech._string%29). |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Note how the data definition for [Dir.v2](#%28tech._dir..v2%29) refers to the
    definition for [LOFD](#%28tech._lofd%29)s, and the one for [LOFD](#%28tech._lofd%29)s
    refers back to that of [Dir.v2](#%28tech._dir..v2%29). The two definitions are
    mutually recursive.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 332\. Translate the directory tree in [figureÂ 123](#%28counter._%28figure._fig~3aaccountant%29%29)
    into a data representation according to model 2\.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 333\. Design the function how-many, which determines how many files
    a given [Dir.v2](#%28tech._dir..v2%29) contains. [ExerciseÂ 332](#%28counter._%28exercise._ex~3afile-example2%29%29)
    provides you with data examples. Compare your result with that of [exerciseÂ 331](#%28counter._%28exercise._ex~3adir-how-many1%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 334\. Show how to equip a directory with two more attributes: size
    and readability. The former measures how much space the directory itself (as opposed
    to its content) consumes; the latter specifies whether anyone else besides the
    user may browse the content of the directory.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Model 3 Like directories, files have attributes. To introduce these, we proceed
    just as above. First, we define a structure for files:'
  prefs: []
  type: TYPE_NORMAL
- en: ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â fileÂ [nameÂ sizeÂ content])
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Second, we provide a data definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â A File.v3 is a structure: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â (make-file  [String](part_one.html#%28tech._string%29)  [N](part_two.html#%28tech._n%29)  [String](part_one.html#%28tech._string%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'As indicated by the field names, the string represents the name of the file,
    the natural number its size, and the string its content.Finally, letâ€™s split the
    content field of directories into two pieces: a list of files and a list of sub-directories.
    This change requires a revision of the structure type definition:'
  prefs: []
  type: TYPE_NORMAL
- en: ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â dir.v3Â [nameÂ dirsÂ files])
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Here is the refined data definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â A Dir.v3 is a structure: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â (make-dir.v3  [String](part_one.html#%28tech._string%29)  [Dir*](#%28tech._dir%2A%29)  [File*](#%28tech._file%2A%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Dir* is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Dir.v3](#%28tech._dir..v3%29)  [Dir*](#%28tech._dir%2A%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A File* is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [File.v3](#%28tech._file..v3%29)  [File*](#%28tech._file%2A%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Following a convention in computer science, the use of [*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)
    as the ending of a name suggests â€œmanyâ€ and is a marker distinguishing the name
    from similar ones: [File.v3](#%28tech._file..v3%29) and [Dir.v3](#%28tech._dir..v3%29).'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 335\. Translate the directory tree in [figureÂ 123](#%28counter._%28figure._fig~3aaccountant%29%29)
    into a data representation according to model 3\. Use "" for the content of files.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 336\. Design the function how-many, which determines how many files
    a given [Dir.v3](#%28tech._dir..v3%29) contains. [ExerciseÂ 335](#%28counter._%28exercise._ex~3afile-example3%29%29)
    provides you with data examples. Compare your result with that of [exerciseÂ 333](#%28counter._%28exercise._ex~3adir-how-many2%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: Given the complexity of the data definition, contemplate how anyone can design
    correct functions. Why are you confident that how-many produces correct results?
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 337\. Use [List-of](part_three.html#%28tech._sim-dd._list._of%29) to
    simplify the data definition [Dir.v3](#%28tech._dir..v3%29). Then use ISL+â€™s list-processing
    functions from [figuresÂ 95](part_three.html#%28counter._%28figure._fig~3aisl-ho-list%29%29)
    and [96](part_three.html#%28counter._%28figure._fig~3aisl-ho-list2%29%29) to simplify
    the function definition(s) for the solution of [exerciseÂ 336](#%28counter._%28exercise._ex~3adir-how-many3%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: Starting with a simple representation of the first model and refining it step-by-step,
    we have developed a reasonably accurate data representation for directory trees.
    Indeed, this third data representation captures the nature of a directory tree
    much more faithfully than the first two. Based on this model, we can create a
    number of other functions that users expect from a computerâ€™s operating system.
  prefs: []
  type: TYPE_NORMAL
- en: 20.3Refining Functions[ğŸ”—](#(part._sec~3arefine-funcs) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'To make the following exercises somewhat realistic, DrRacket comes withAdd
    ([require](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._require%29%29)  htdp/dir)
    to the definitions area. the dir.rkt teachpack from the first edition of this
    book. This teachpack introduces the two structure type definitions from model
    3, though without the .v3 suffix. Furthermore, the teachpack provides a function
    that creates representations of directory trees on your computer:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [String](part_one.html#%28tech._string%29) -> [Dir.v3](#%28tech._dir..v3%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â creates a representation of the a-path directory |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (create-dirÂ a-path)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'For example, if you open DrRacket and enter the following three lines into
    the definitions area:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â OÂ (create-dirÂ "/Users/..."))Â ;Â on
    OS X |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â LÂ (create-dirÂ "/var/log/"))Â ;Â on
    Linux |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â WÂ (create-dirÂ "C:\\Users\\..."))Â ;Â on
    Windows |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: you get data representations of directories on your computer after you save
    and then run the program. Indeed, you could use create-dir to map the entire file
    system on your computer to an instance of [Dir.v3](#%28tech._dir..v3%29).
  prefs: []
  type: TYPE_NORMAL
- en: Warnings (1) For large directory trees, DrRacket may need a lot of time to build
    a representation. Use create-dir on small directory trees first. (2) Do not define
    your own dir structure type. The teachpack already defines them, and you must
    not define a structure type twice.
  prefs: []
  type: TYPE_NORMAL
- en: Although create-dir delivers only a representation of a directory tree, it is
    sufficiently realistic to give you a sense of what it is like to design programs
    at that level. The following exercises illustrate this point. They use Dir to
    refer to the generic idea of a data representation for directory trees. Use the
    simplest data definition of Dir that allows you to complete the respective exercise.
    Feel free to use the data definition from [exerciseÂ 337](#%28counter._%28exercise._ex~3adir-how-many-map%29%29)
    and the functions from [figuresÂ 95](part_three.html#%28counter._%28figure._fig~3aisl-ho-list%29%29)
    and [96](part_three.html#%28counter._%28figure._fig~3aisl-ho-list2%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 338\. Use create-dir to turn some of your directories into ISL+ data
    representations. Then use how-many from [exerciseÂ 336](#%28counter._%28exercise._ex~3adir-how-many3%29%29)
    to count how many files they contain. Why are you confident that how-many produces
    correct results for these directories?
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 339\. Design find?. The function consumes a Dir and a file name and
    determines whether or not a file with this name occurs in the directory tree.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 340\. Design the function ls, which lists the names of all files and
    directories in a given Dir.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 341\. Design du, a function that consumes a Dir and computes the total
    size of all the files in the entire directory tree. Assume that storing a directory
    in a Dir structure costs 1 file storage unit. In the real world, a directory is
    basically a special file, and its size depends on how large its associated directory
    is.
  prefs: []
  type: TYPE_NORMAL
- en: 'The remaining exercises rely on the notion of a path, which for our purposes
    is a list of names:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â A Path is [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [String](part_one.html#%28tech._string%29)].
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â interpretation directions into a directory tree |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Take a second look at [figureÂ 123](#%28counter._%28figure._fig~3aaccountant%29%29).
    In that diagram, the path from TS to part1 is ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  "TS"  "Text"  "part1").
    Similarly, the path from TS to Code is ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  "TS"  "Libs"  "Code").
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 342\. Design find. The function consumes a directory d and a file
    name f. If (find?  d  f) is #true, find produces a path to a file with name f;
    otherwise it produces #false.'
  prefs: []
  type: TYPE_NORMAL
- en: Hint While it is tempting to first check whether the file name occurs in the
    directory tree, you have to do so for every single sub-directory. Hence it is
    better to combine the functionality of find? and find.
  prefs: []
  type: TYPE_NORMAL
- en: 'Challenge The find function discovers only one of the two files named read!
    in [figureÂ 123](#%28counter._%28figure._fig~3aaccountant%29%29). Design find-all,
    which generalizes find and produces the list of all paths that lead to f in d.
    What should find-all produce when (find?  d  f) is #false? Is this part of the
    problem really a challenge compared to the basic problem?'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 343\. Design the function ls-R, which lists the paths to all files
    contained in a given Dir.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 344\. Redesign find-all from [exerciseÂ 342](#%28counter._%28exercise._ex~3afile-find-path%29%29)
    using ls-R from [exerciseÂ 343](#%28counter._%28exercise._ex~3afile-ls-.R%29%29).
    This is design by composition, and if you solved the challenge part of [exerciseÂ 342](#%28counter._%28exercise._ex~3afile-find-path%29%29)
    your new function can find directories, too.
  prefs: []
  type: TYPE_NORMAL
- en: 21Refining Interpreters[ğŸ”—](#(part._ch~3aevaluator) "Link to here")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'DrRacket is a program. It is a complex one, dealing with many different kinds
    of data. Like most complex programs, DrRacket also consists of many functions:
    one that allows programmers to edit text, another one that acts like the interactions
    area, a third one that checks whether definitions and expressions are â€œgrammatical,â€
    and so on.'
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we show you how to design the function that implements the
    heart of the interactions area. Naturally, we use iterative refinement for this
    design project. As a matter of fact, the very idea of focusing on this aspect
    of DrRacket is another instance of refinement, namely, the obvious one of implementing
    only one piece of functionality.
  prefs: []
  type: TYPE_NORMAL
- en: Simply put, the interactions area performs the task of determining the values
    of expressions that you enter. After you click RUN, the interactions area knows
    about all the definitions. It is then ready to accept an expression that may refer
    to these definitions, to determine the value of this expression, and to repeat
    this cycle as often as you wish. For this reason, many people also refer to the
    interactions area as the read-eval-print loop, where eval is short for evaluator,
    a function that is also called interpreter.
  prefs: []
  type: TYPE_NORMAL
- en: Like this book, our refinement process starts with numeric BSL expressions.
    They are simple; they do not assume an understanding of definitions; and even
    your sister in fifth grade can determine their value. Once you understand this
    first step, you know the difference between a BSL expression and its representation.
    Next we move on to expressions with variables. The last step is to add definitions.
  prefs: []
  type: TYPE_NORMAL
- en: 21.1Interpreting Expressions[ğŸ”—](#(part._sec~3ainterpreter) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Our first task is to agree on a data representation for BSL programs. That is,
    we must figure out how to represent a BSL expression as a piece of BSL data. At
    first, this sounds strange and unusual, but it is not difficult. Suppose we just
    want to represent numbers, additions, and multiplications for a start. Clearly,
    numbers can stand for numbers. An addition expression, however, calls for compound
    data because it contains two expressions and because it is distinct from a multiplication
    expression, which also needs a data representation.
  prefs: []
  type: TYPE_NORMAL
- en: 'Following [Adding Structure](part_one.html#%28part._ch~3astructure%29), a straightforward
    way to represent additions and multiplications is to define two structure types,
    each with two fields:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â addÂ [[left](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29)Â [right](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29)])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â mulÂ [[left](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29)Â [right](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29)])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The intention is that the [left](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29)
    field contains one operandâ€”<wbr>the one to the â€œleftâ€ of the operatorâ€”<wbr>and
    the [right](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29)
    field contains the other operand. The following table shows three examples:'
  prefs: []
  type: TYPE_NORMAL
- en: '| BSL expression |  | representation of BSL expression |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| 3 |  | 3 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 1Â 1)
    |  | (make-addÂ 1Â 1) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 300001Â 100000)
    |  | (make-mulÂ 300001Â 100000) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The next question concerns an expression with sub-expressions:'
  prefs: []
  type: TYPE_NORMAL
- en: ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 3Â 3)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 4Â 4))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The surprisingly simple answer is that fields may contain any value. In this
    particular case, [left](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29)
    and [right](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29)
    may contain representations of expressions, and you may nest this as deeply as
    you wish. See [figureÂ 124](#%28counter._%28figure._fig~3arepresenting-bsl%29%29)
    for additional examples.
  prefs: []
  type: TYPE_NORMAL
- en: '| BSL expression |  | representation of BSL expression |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 1Â 1)Â 10)
    |  | (make-addÂ (make-mulÂ 1Â 1)Â 10) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 3Â 3)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 4Â 4))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (make-addÂ (make-mulÂ 3Â 3) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â Â (make-mulÂ 4Â 4)) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 1Â 2)Â 3)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 1Â 1)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â 2) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â 4)) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (make-addÂ (make-mulÂ (make-addÂ 1Â 2)Â 3) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â Â (make-mulÂ (make-mul &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (make-addÂ 1Â 1) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 2) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 4)) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 124: Representing BSL expressions in BSL'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ExerciseÂ 345\. Formulate a data definition for the representation of BSL expressions
    based on the structure type definitions of add and mul. Letâ€™s use BSL-expr in
    analogy for [S-expr](#%28tech._s._expr%29) for the new class of data.
  prefs: []
  type: TYPE_NORMAL
- en: 'Translate the following expressions into data:'
  prefs: []
  type: TYPE_NORMAL
- en: ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  10  -10)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  20  3)  33)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  3.14  ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  2  3))  ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  3.14  ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  -1  -9)))
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Interpret the following data as expressions:'
  prefs: []
  type: TYPE_NORMAL
- en: (make-add  -1  2)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: (make-add  (make-mul  -2  -3)  33) Here â€œinterpretâ€ means â€œtranslate from data
    into information.â€ In contrast, â€œinterpreterâ€ in the title of this chapter refers
    to a program that consumes the representation of a program and produces its value.
    While the two ideas are related, they are not the same.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: (make-mul  (make-add  1  (make-mul  2  3))  3.14)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now that you have a data representation for BSL programs, it is time to design
    an evaluator. This function consumes a representation of a BSL expression and
    produces its value. Again, this function is unlike any you have ever designed
    so it pays off to experiment with some examples. To this end, either you can use
    the rules of arithmetic to figure out what the value of an expression is or you
    can â€œplayâ€ in the interactions area of DrRacket. Take a look at the following
    table for our examples:'
  prefs: []
  type: TYPE_NORMAL
- en: '| BSL expression |  | its representation |  | its value |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| 3 |  | 3 |  | 3 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 1Â 1)
    |  | (make-addÂ 1Â 1) |  | 2 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 3Â 10)
    |  | (make-mulÂ 3Â 10) |  | 30 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 1Â 1)Â 10)
    |  | (make-addÂ (make-mulÂ 1Â 1)Â 10) |  | 11 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ExerciseÂ 346\. Formulate a data definition for the class of values to which
    a representation of a BSL expression can evaluate.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 347\. Design eval-expression. The function consumes a representation
    of a BSL expression and computes its value.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 348\. Develop a data representation for [Boolean](part_one.html#%28tech._boolean%29)
    BSL expressions constructed from #true, #false, [and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29),
    [or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29),
    and [not](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._not%29%29).
    Then design eval-bool-expression, which consumes (representations of) [Boolean](part_one.html#%28tech._boolean%29)
    BSL expressions and computes their values. What kind of values do these [Boolean](part_one.html#%28tech._boolean%29)
    expressions yield?'
  prefs: []
  type: TYPE_NORMAL
- en: 'Convenience and parsing S-expressions offer a convenient way to represent BSL
    expressions in our programming language:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 1Â 1)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| 2 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ''(+Â 1Â 1) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (list ''+ 1 1) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 3Â 3)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 4Â 4))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| 25 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ''(+Â (*Â 3Â 3)Â (*Â 4Â 4)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (list ''+ (list ''* 3 3) (list ''* 4 4)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: By simply putting a quote in front of an expression, we get ISL+ data.
  prefs: []
  type: TYPE_NORMAL
- en: 'Interpreting an S-expression representation is clumsy, mostly because not all
    S-expressions represent [BSL-expr](#%28tech._bsl._expr%29)s. For example, #true,
    "hello", and ''(+  x  1) are not representatives of BSL expressions. As a result,
    S-expressions are quite inconvenient for the designers of interpreters.'
  prefs: []
  type: TYPE_NORMAL
- en: Programmers invented parsers to bridge the gap between convenience of use and
    implementation. A parser simultaneously checks whether some piece of data conforms
    to a data definition and, if it does, builds a matching element from the chosen
    class of data. The latter is called a parse tree. If the given data does not conform,
    a parser signals an error, much like the checked functions from [Input Errors](part_one.html#%28part._sec~3ainput-errors%29).
  prefs: []
  type: TYPE_NORMAL
- en: '[FigureÂ 125](#%28counter._%28figure._fig~3aparse-bsl-expr%29%29) presents a
    BSL parser for S-expressions. Specifically, parse consumes an [S-expr](#%28tech._s._expr%29)
    and produces a BSL-exprâ€”<wbr>if and only if the given S-expression is the result
    of quoting a BSL expression that has a BSL-expr representative.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 349\. Create tests for parse until DrRacket tells you that every element
    in the definitions area is covered during the test run.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 350\. What is unusual about the definition of this program with respect
    to the design recipe?
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 351\. Design interpreter-expr. The function accepts S-expressions.
    If parse recognizes them as [BSL-expr](#%28tech._bsl._expr%29), it produces their
    value. Otherwise, it signals the same error as parse.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [S-expr](#%28tech._s._expr%29) -> [BSL-expr](#%28tech._bsl._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (parseÂ s)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(atom?Â s)Â (parse-atomÂ s)] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (parse-slÂ s)]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [SL](#%28tech._sl%29) -> [BSL-expr](#%28tech._bsl._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (parse-slÂ s)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â (consists-of-3Â s)Â ([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â s)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â [([symbol=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â s)Â ''+)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â (make-addÂ (parseÂ ([second](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29)Â s))Â (parseÂ ([third](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._third%29%29)Â s)))]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â [([symbol=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â s)Â ''*)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â (make-mulÂ (parseÂ ([second](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29)Â s))Â (parseÂ ([third](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._third%29%29)Â s)))]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â WRONG)])]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â WRONG)]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Atom](#%28tech._atom%29) -> [BSL-expr](#%28tech._bsl._expr%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (parse-atomÂ s)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([number?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._number~3f%29%29)Â s)Â s]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29)Â s)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â WRONG)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)Â s)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â WRONG)]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [SL](#%28tech._sl%29) -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (consists-of-3Â s)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â s)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â s))Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â s)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â s))))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 125: From S-expr to BSL-expr'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 21.2Interpreting Variables[ğŸ”—](#(part._sec~3ainterpreter-variables) "Link to
    here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Since the first section ignores constant definitions, an expression does not
    have a value if it contains a variable. Indeed, unless we know what x stands for,
    it makes no sense to evaluate ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  3  x).
    Hence, one first refinement of the evaluator is to add variables to the expressions
    that we wish to evaluate. The assumption is that the definitions area contains
    a definition such as
  prefs: []
  type: TYPE_NORMAL
- en: ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â xÂ 5)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'and that programmers evaluate expressions containing x in the interactions
    area:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > x |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| 5 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â xÂ 3)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| 8 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 1/2Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â xÂ 3))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| 7.5 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Indeed, you could imagine a second definition, say ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)  y  3),
    and interactions that involve two variables:'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; > ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â xÂ x)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â yÂ y))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| 34 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The preceding section implicitly proposes symbols as representations for variables.
    After all, if you were to choose quoted S-expressions to represent expressions
    with variables, symbols would appear naturally:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > ''x |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ''x |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ''(*Â 1/2Â (*Â xÂ 3)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (list ''* 0.5 (list ''* ''x 3)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'One obvious alternative is a string, so that "x" would represent x, but this
    book is not about designing interpreters, so we stick with symbols. From this
    decision, it follows how to modify the data definition from [exerciseÂ 345](#%28counter._%28exercise._ex~3absl-dd%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â A BSL-var-expr is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  [Number](part_one.html#%28tech._number%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  [Symbol](i2-3.html#%28tech._symbol%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-add  [BSL-var-expr](#%28tech._bsl._var._expr%29)  [BSL-var-expr](#%28tech._bsl._var._expr%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-mul  [BSL-var-expr](#%28tech._bsl._var._expr%29)  [BSL-var-expr](#%28tech._bsl._var._expr%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'We simply add one clause to the data definition.As for data examples, the following
    table shows some BSL expressions with variables and their [BSL-var-expr](#%28tech._bsl._var._expr%29)
    representation:'
  prefs: []
  type: TYPE_NORMAL
- en: '| BSL expression |  | representation of BSL expression |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| x |  | ''x |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â xÂ 3)
    |  | (make-addÂ ''xÂ 3) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 1/2Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â xÂ 3))
    |  | (make-mulÂ 1/2Â (make-mulÂ ''xÂ 3)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â xÂ x)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â yÂ y))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (make-addÂ (make-mulÂ ''xÂ ''x) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â Â (make-mulÂ ''yÂ ''y)) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: They are all taken from the interactions above, meaning you know the results
    when x is 5 and y 3.
  prefs: []
  type: TYPE_NORMAL
- en: One way to determine the value of variable expressions is to replace all variables
    with the values that they represent. This is the way you know from mathematics
    classes in school, and it is a perfectly fine way.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 352\. Design subst. The function consumes a [BSL-var-expr](#%28tech._bsl._var._expr%29)
    ex, a [Symbol](i2-3.html#%28tech._symbol%29) x, and a [Number](part_one.html#%28tech._number%29)
    v. It produces a [BSL-var-expr](#%28tech._bsl._var._expr%29) like ex with all
    occurrences of x replaced by v.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 353\. Design the numeric? function. It determines whether a [BSL-var-expr](#%28tech._bsl._var._expr%29)
    is also a [BSL-expr](#%28tech._bsl._expr%29). Here we assume that your solution
    to [exerciseÂ 345](#%28counter._%28exercise._ex~3absl-dd%29%29) is the definition
    for [BSL-var-expr](#%28tech._bsl._var._expr%29) without [Symbol](i2-3.html#%28tech._symbol%29)s.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 354\. Design eval-variable. The checked function consumes a BSL-var-expr
    and determines its value if numeric? yields true for the input. Otherwise it signals
    an error.
  prefs: []
  type: TYPE_NORMAL
- en: 'In general, a program defines many constants in the definitions area, and expressions
    contain more than one variable. To evaluate such expressions, we need a representation
    of the definitions area when it contains a series of constant definitions. For
    this exercise we use association lists:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An AL (short for association list) is [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Association](#%28tech._association%29)].
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An Association is a list of two items: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Symbol](i2-3.html#%28tech._symbol%29)  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Number](part_one.html#%28tech._number%29)  ''())).
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Make up elements of [AL](#%28tech._al%29).
  prefs: []
  type: TYPE_NORMAL
- en: Design eval-variable*. The function consumes a [BSL-var-expr](#%28tech._bsl._var._expr%29)
    ex and an association list da. Starting from ex, it iteratively applies subst
    to all associations in da. If numeric? holds for the result, it determines its
    value; otherwise it signals the same error as eval-variable. Hint Think of the
    given [BSL-var-expr](#%28tech._bsl._var._expr%29) as an atomic value and traverse
    the given association list instead. We provide this hint because the creation
    of this function requires a little design knowledge from [Simultaneous Processing](#%28part._ch~3asimu%29).
  prefs: []
  type: TYPE_NORMAL
- en: An environment model [ExerciseÂ 354](#%28counter._%28exercise._ex~3absl-var-eval%29%29)
    relies on the mathematical understanding of constant definitions. If a name is
    defined to stand for some value, all occurrences of the name can be replaced with
    the value. Substitution performs this replacement once and for all before the
    evaluation process even starts.
  prefs: []
  type: TYPE_NORMAL
- en: An alternative approach, dubbed the environment model, is to look up the value
    of a variable when needed. The evaluator starts processing the expression immediately
    but also carries along the representation of the definitions area. Every time
    the evaluator encounters a variable, it looks in the definitions area for its
    value and uses it.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 355\. Design eval-var-lookup. This function has the same signature
    as eval-variable*:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [BSL-var-expr](#%28tech._bsl._var._expr%29)  [AL](#%28tech._al%29) -> [Number](part_one.html#%28tech._number%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (eval-var-lookupÂ [e](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._e%29%29)Â da)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Instead of using substitution, the function traverses the expression in the
    manner that the design recipe for [BSL-var-expr](#%28tech._bsl._var._expr%29)
    suggests. As it descends the expression, it â€œcarries alongâ€ da. When it encounters
    a symbol x, it uses [assq](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assq%29%29)
    to look up the value of x in the association list. If there is no value, eval-var-lookup
    signals an error.
  prefs: []
  type: TYPE_NORMAL
- en: 21.3Interpreting Functions[ğŸ”—](#(part._sec~3ainterpreter-functions) "Link to
    here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: At this point, you understand how to evaluate BSL programs that consist of constant
    definitions and variable expressions. Naturally you want to add function definitions
    so that you knowâ€”<wbr>at least in principleâ€”<wbr>how to deal with all of BSL.
  prefs: []
  type: TYPE_NORMAL
- en: The goal of this section is to refine the evaluator of [Interpreting Variables](#%28part._sec~3ainterpreter-variables%29)
    so that it can cope with functions. Since function definitions show up in the
    definitions area, another way to describe the refined evaluator is to say that
    it simulates DrRacket when the definitions area contains a number of function
    definitions and a programmer enters an expression in the interactions area that
    contains uses of these functions.
  prefs: []
  type: TYPE_NORMAL
- en: For simplicity, letâ€™s assume that all functions in the definitions area consume
    one argument and that there is only one such definition. The necessary domain
    knowledge dates back to school where you learned that f(x) = e represents the
    definition of function f, that f(a) represents the application of f to a, and
    that to evaluate the latter, you substitute a for x in e. As it turns out, the
    evaluation of function applications in a language such as BSL works mostly like
    that, too.
  prefs: []
  type: TYPE_NORMAL
- en: Before tackling the following exercises, you may wish to refresh your knowledge
    of the terminology concerning functions as presented in intermezzo 1\. Most of
    the time, algebra courses gloss over this aspect of mathematics, but a precise
    use and understanding of terminology is needed when you wish to solve these problems.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 356\. Extend the data representation of [Interpreting Variables](#%28part._sec~3ainterpreter-variables%29)
    to include the application of a programmer-defined function. Recall that a function
    application consists of two pieces: a name and an expression. The former is the
    name of the function that is applied; the latter is the argument.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Represent these expressions: (k  ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  1  1)),
    ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  5  (k  ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  1  1))),
    ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  (i  5)  (k  ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  1  1))).
    We refer to this newly defined class of data as BSL-fun-expr.'
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 357\. Design eval-definition1. The function consumes four arguments:'
  prefs: []
  type: TYPE_NORMAL
- en: a [BSL-fun-expr](#%28tech._bsl._fun._expr%29) ex;
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: a symbol f, which represents a function name;
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: a symbol x, which represents the functionsâ€™ parameter; and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: a [BSL-fun-expr](#%28tech._bsl._fun._expr%29) b, which represents the functionâ€™s
    body.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: It determines the value of ex. When eval-definition1 encounters an application
    of f to some argument, it
  prefs: []
  type: TYPE_NORMAL
- en: evaluates the argument,
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: substitutes the value of the argument for x in b; and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: finally evaluates the resulting expression with eval-definition1.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Here is how to express the steps as code, assuming arg is the argument of the
    function application:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â valueÂ (eval-definition1Â argÂ fÂ xÂ b))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â plugdÂ (substÂ bÂ xÂ value)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (eval-definition1Â plugdÂ fÂ xÂ b)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Notice that this line uses a form of recursion that has not been covered. The
    proper design of such functions is discussed in [Generative Recursion](part_five.html).
  prefs: []
  type: TYPE_NORMAL
- en: If eval-definition1 encounters a variable, it signals the same error as eval-variable
    from [exerciseÂ 354](#%28counter._%28exercise._ex~3absl-var-eval%29%29). It also
    signals an error for function applications that refer to a function name other
    than f.
  prefs: []
  type: TYPE_NORMAL
- en: 'Warning The use of this uncovered form of recursion introduces a new element
    into your computations: non-termination. That is, a program may run forever instead
    of delivering a result or signaling an error. If you followed the design recipes
    of the first four parts, you cannot write down such programs. For fun, construct
    an input for eval-definition1 that causes it to run forever. Use STOP to terminate
    the program.'
  prefs: []
  type: TYPE_NORMAL
- en: For an evaluator that mimics the interactions area, we need a representation
    of the definitions area. We assume that it is a list of definitions.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 358\. Provide a structure type and a data definition for function
    definitions. Recall that such a definition has three essential attributes:'
  prefs: []
  type: TYPE_NORMAL
- en: the functionâ€™s name, which is represented with a symbol;
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: the functionâ€™s parameter, which is also a name; and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: the functionâ€™s body, which is a variable expression.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'We use BSL-fun-def to refer to this class of data.Use your data definition
    to represent these BSL function definitions:'
  prefs: []
  type: TYPE_NORMAL
- en: ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)  (f  x)  ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  3  x))
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)  (g  y)  (f  ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  2  y)))
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)  (h  v)  ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  (f  v)  (g  v)))
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, define the class BSL-fun-def* to represent a definitions area that consists
    of a number of one-argument function definitions. Translate the definitions area
    that defines f, g, and h into your data representation and name it da-fgh.
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, work on the following wish:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [BSL-fun-def*](#%28tech._bsl._fun._def%2A%29)  [Symbol](i2-3.html#%28tech._symbol%29)
    -> [BSL-fun-def](#%28tech._bsl._fun._def%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â retrieves the definition of f in da |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â signals an error if there is none |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (lookup-defÂ da-fghÂ ''g)Â g)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (lookup-defÂ daÂ f)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Looking up a definition is needed for the evaluation of applications.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 359\. Design eval-function*. The function consumes ex, a [BSL-fun-expr](#%28tech._bsl._fun._expr%29),
    and da, a [BSL-fun-def*](#%28tech._bsl._fun._def%2A%29) representation of a definitions
    area. It produces the result that DrRacket shows if you evaluate ex in the interactions
    area, assuming the definitions area contains da.
  prefs: []
  type: TYPE_NORMAL
- en: The function works like eval-definition1 from [exerciseÂ 357](#%28counter._%28exercise._ex~3absl-eval-def1%29%29).
    For an application of some function f, it
  prefs: []
  type: TYPE_NORMAL
- en: evaluates the argument;
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: looks up the definition of f in the [BSL-fun-def](#%28tech._bsl._fun._def%29)
    representation of da, which comes with a parameter and a body;
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: substitutes the value of the argument for the function parameter in the functionâ€™s
    body; and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: evaluates the new expression via recursion.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Like DrRacket, eval-function* signals an error when it encounters a variable
    or function name without definition in the definitions area.
  prefs: []
  type: TYPE_NORMAL
- en: 21.4Interpreting Everything[ğŸ”—](#(part._sec~3ainterpreter-all) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Take a look at the following BSL program:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â close-to-piÂ 3.14)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (area-of-circleÂ r)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â close-to-piÂ ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â rÂ r)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (volume-of-10-cylinderÂ r)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 10Â (area-of-circleÂ r)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Think of these definitions as the definitions area in DrRacket. After you click
    RUN, you can evaluate expressions involving close-to-pi, area-of-circle, and volume-of-10-cylinder
    in the interactions area:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > (area-of-circleÂ 1) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| #i3.14 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > (volume-of-10-cylinderÂ 1) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| #i31.400000000000002 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 3Â close-to-pi)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| #i9.42 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The goal of this section is to refine your evaluator again so that it can mimic
    this much of DrRacket.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 360\. Formulate a data definition for the representation of DrRacketâ€™s
    definitions area. Concretely, the data representation should work for a sequence
    that freely mixes constant definitions and one-argument function definitions.
    Make sure you can represent the definitions area consisting of three definitions
    at the beginning of this section. We name this class of data BSL-da-all.
  prefs: []
  type: TYPE_NORMAL
- en: Design the function lookup-con-def. It consumes a [BSL-da-all](#%28tech._bsl._da._all%29)
    da and a symbol x. It produces the representation of a constant definition whose
    name is x, if such a piece of data exists in da; otherwise the function signals
    an error saying that no such constant definition can be found.
  prefs: []
  type: TYPE_NORMAL
- en: Design the function lookup-fun-def. It consumes a [BSL-da-all](#%28tech._bsl._da._all%29)
    da and a symbol f. It produces the representation of a function definition whose
    name is f, if such a piece of data exists in da; otherwise the function signals
    an error saying that no such function definition can be found.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 361\. Design eval-all. Like eval-function* from [exerciseÂ 359](#%28counter._%28exercise._ex~3absl-eval-def%29%29),
    this function consumes the representation of an expression and a definitions area.
    It produces the same value that DrRacket shows if the expression is entered at
    the prompt in the interactions area and the definitions area contains the appropriate
    definitions. Hint Your eval-all function should process variables in the given
    expression like eval-var-lookup in [exerciseÂ 355](#%28counter._%28exercise._ex~3absl-var-eval2%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 362\. It is cumbersome to enter the structure-based data representation
    of BSL expressions and a definitions area. As the end of [Interpreting Expressions](#%28part._sec~3ainterpreter%29)
    demonstrates, it is much easier to quote expressions and (lists of) definitions.
  prefs: []
  type: TYPE_NORMAL
- en: Design a function interpreter. It consumes an S-expr and an Sl. The former is
    supposed to represent an expression and the latter a list of definitions. The
    function parses both with the appropriate parsing functions and then uses eval-all
    from [exerciseÂ 361](#%28counter._%28exercise._ex~3absl-eval-all%29%29) to evaluate
    the expression. Hint You must adapt the ideas of [exerciseÂ 350](#%28counter._%28exercise._ex~3absl-parse2%29%29)
    to create a parser for definitions and lists of definitions.
  prefs: []
  type: TYPE_NORMAL
- en: 'At this point, you know a lot about interpreting BSL. Here are some of the
    missing pieces: [Boolean](part_one.html#%28tech._boolean%29)s with [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    or [if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29);
    [String](part_one.html#%28tech._string%29)s and such operations as [string-length](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string-length%29%29)
    or [string-append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string-append%29%29);
    and lists with ''(), [empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29),
    [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29),
    [cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29),
    [first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29),
    [rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29);
    and so on. Once your evaluator can cope with all these, it is basically complete
    because your evaluators already know how to interpret recursive functions. Now
    when we say â€œtrust us, you know how to design these refinements,â€ we mean it.'
  prefs: []
  type: TYPE_NORMAL
- en: '22Project: The Commerce of XML[ğŸ”—](#(part._ch~3amoney-sexp) "Link to here")'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: XML is a widely used data language. One use concerns message exchanges between
    programs running on different computers. For example, when you point your web
    browser at a web site, you are connecting a program on your computer to a program
    on another computer, and the latter sends XML data to the former. Once the browser
    receives the XML data, it renders it as an image on your computerâ€™s monitor.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following comparison illustrates this idea with a concrete example:'
  prefs: []
  type: TYPE_NORMAL
- en: '| XML data |  | rendered in a browser |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; <ul> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â <li> hello </li> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â <li> <ul> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â <li> one </li> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â <li> two </li> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â </ul> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â </li> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â <li> world </li> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â <li> good bye </li> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; </ul> &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  | ![](../Images/a8b82bdb5f9d0eb29ca092c00c8bfdcf.png) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: On the left, you see a piece of XML data that a web site may send to your web
    browser. On the right, you see how one popular browser renders this snippet graphically.
  prefs: []
  type: TYPE_NORMAL
- en: This chapter explains the basics of processing XML as another design exercise
    concerning intertwined data definitions and iterative refinement. The next section
    starts with an informal comparison of S-expressions and XML data and uses it to
    formulate a full-fledged dataIf you think XML is too old-fashioned for 2024, feel
    free to redo the exercise for JSON or some other modern data exchange format.
    The design principles remain the same. definition. The remaining sections explain
    with examples how to process an S-expression of XML data.
  prefs: []
  type: TYPE_NORMAL
- en: 22.1XML as S-expressions[ğŸ”—](#(part._sec~3axml) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'The most basic piece of XML data looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '| <machine> </machine> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'It is called an element and â€œmachineâ€ is the name of the element. The two parts
    of the element are like parentheses that delimit the content of an element. When
    there is no content between the two partsâ€”<wbr>other than white spaceâ€”<wbr>XML
    allows a short-hand:'
  prefs: []
  type: TYPE_NORMAL
- en: '| <machine /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'But, as far as we are concerned here, this short-hand is equivalent to the
    explicitly bracketed version.From an S-expression perspective, an XML element
    is a named pair of parentheses that surround some content.Racketâ€™s xml library
    represents XML with structures as well as S-expressions. And indeed, representing
    the above with an S-expression is quite natural:'
  prefs: []
  type: TYPE_NORMAL
- en: '''(machine)'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'This piece of data has the opening and closing parentheses, and it comes with
    space to embed content.Here is a piece of XML data with content:'
  prefs: []
  type: TYPE_NORMAL
- en: '| <machine><action /></machine> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Remember that the <action /> part is a short-hand, meaning we are really looking
    at this piece of data:'
  prefs: []
  type: TYPE_NORMAL
- en: '| <machine><action></action></machine> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'In general, the content of an XML element is a series of XML elements:'
  prefs: []
  type: TYPE_NORMAL
- en: '| <machine><action /><action /><action /></machine> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Stop! Expand the short-hand for <action /> before you continue.The S-expression
    representation continues to look simple. Here is the first one:'
  prefs: []
  type: TYPE_NORMAL
- en: '''(machineÂ (action))'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'And this is the representation for the second one:'
  prefs: []
  type: TYPE_NORMAL
- en: '''(machineÂ (action)Â (action)Â (action))'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: When you look at the piece of XML data with a sequence of three <action /> elements
    as its content, you realize that you may wish to distinguish such elements from
    each other. To this end, XML elements come with attributes. For example,
  prefs: []
  type: TYPE_NORMAL
- en: '| <machine initial="red"></machine> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'is the â€œmachineâ€ element equipped with one attribute whose name is â€œinitialâ€
    and whose value is â€œredâ€ between string quotes. Here is a complex XML element
    with nested elements that have attributes, too:'
  prefs: []
  type: TYPE_NORMAL
- en: '| <machine initial="red"> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <action state="red"Â Â Â Â next="green" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <action state="green"Â Â next="yellow" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <action state="yellow" next="red" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| </machine> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: We use blanks, indentation, and line breaks to make the element readable, but
    this white space has no meaning for our XML data here.Naturally, S-expressions
    for these â€œmachineâ€ elements look much like their XML cousins:XML is 40 years
    younger than S-expressions.
  prefs: []
  type: TYPE_NORMAL
- en: '''(machineÂ ((initialÂ "red")))'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'To add attributes to an element, we use a list of lists where each of the latter
    contains two items: a symbol and a string. The symbol represents the name of the
    attribute and the string its value. This idea naturally applies to complex forms
    of XML data, too:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ''(machineÂ ((initialÂ "red")) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (actionÂ ((stateÂ "red")Â (nextÂ "green"))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (actionÂ ((stateÂ "green")Â (nextÂ "yellow"))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (actionÂ ((stateÂ "yellow")Â (nextÂ "red")))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: For now note how the attributes are marked by two opening parentheses and the
    remaining list of (representations of) XML elements has one opening parenthesis.
  prefs: []
  type: TYPE_NORMAL
- en: 'You may recall the idea from [Intermezzo 2: Quote, Unquote](i2-3.html), which
    uses S-expressions to represent XHTML, a special dialect of XML. In particular,
    the intermezzo shows how easily a programmer can write down nontrivial XML data
    and even templates of XML representations using backquote and [unquote](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._unquote%29%29).
    Of course, [Interpreting Expressions](#%28part._sec~3ainterpreter%29) points out
    that you need a parser to determine whether any given S-expression is a representation
    of XML data, and a parser is a complex and unusual kind of function.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Nevertheless, we choose to go with a representation of XML based on S-expressions
    to demonstrate the usefulness of this old, poetic idea in practical terms. We
    proceed gradually to work out a data definition, putting iterative refinement
    to work. Here is a first attempt:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An Xexpr.v0 (short for X-expression) is a one-item list: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Symbol](i2-3.html#%28tech._symbol%29)  ''())
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'This is the â€œnamed parenthesesâ€ idea from the beginning of this section. Equipping
    this element representation with content is easy:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An Xexpr.v1 is a list: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Symbol](i2-3.html#%28tech._symbol%29)  [List-of  [Xexpr.v1](#%28tech._xexpr..v1%29)])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The symbolic name becomes the first item on a list that otherwise consists
    of XML element representatives.The last refinement step is to add attributes.
    Since the attributes in an XML element are optional, the revised data definition
    has two clauses:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An Xexpr.v2 is a list: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Symbol](i2-3.html#%28tech._symbol%29)  Body)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Symbol](i2-3.html#%28tech._symbol%29)  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Attribute](#%28tech._attribute%29)]  Body))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â where Body is short for [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Xexpr.v2](#%28tech._xexpr..v2%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An Attribute is a list of two items: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Symbol](i2-3.html#%28tech._symbol%29)  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [String](part_one.html#%28tech._string%29)  ''()))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ExerciseÂ 363\. All elements of [Xexpr.v2](#%28tech._xexpr..v2%29) start with
    a [Symbol](i2-3.html#%28tech._symbol%29), but some are followed by a list of attributes
    and some by just a list of [Xexpr.v2](#%28tech._xexpr..v2%29)s. Reformulate the
    definition of [Xexpr.v2](#%28tech._xexpr..v2%29) to isolate the common beginning
    and highlight the different kinds of endings.
  prefs: []
  type: TYPE_NORMAL
- en: Eliminate the use of [List-of](part_three.html#%28tech._sim-dd._list._of%29)
    from [Xexpr.v2](#%28tech._xexpr..v2%29).
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 364\. Represent this XML data as elements of [Xexpr.v2](#%28tech._xexpr..v2%29):'
  prefs: []
  type: TYPE_NORMAL
- en: <transition from="seen-e" to="seen-f" />
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: <ul><li><word /><word /></li><li><word /></li></ul>
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Which one could be represented in [Xexpr.v0](#%28tech._xexpr..v0%29) or [Xexpr.v1](#%28tech._xexpr..v1%29)?ExerciseÂ 365\.
    Interpret the following elements of [Xexpr.v2](#%28tech._xexpr..v2%29) as XML
    data:'
  prefs: []
  type: TYPE_NORMAL
- en: '''(server  ((name  "example.org")))'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '''(carcas  (board  (grass))  (player  ((name  "sam"))))'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '''(start)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Which ones are elements of [Xexpr.v0](#%28tech._xexpr..v0%29) or [Xexpr.v1](#%28tech._xexpr..v1%29)?Roughly
    speaking, X-expressions simulate structures via lists. The simulation is convenient
    for programmers; it asks for the least amount of keyboard typing. For example,
    if an X-expression does not come with an attribute list, it is simply omitted.
    This choice of data representation represents a trade-off between authoring such
    expressions manually and processing them automatically. The best way to deal with
    the latter problem is to provide functions that make X-expressions look like structures,
    especially functions that access the quasi-fields:'
  prefs: []
  type: TYPE_NORMAL
- en: xexpr-name, which extracts the tag of the element representation;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: xexpr-attr, which extracts the list of attributes; and
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: xexpr-content, which extracts the list of content elements.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Once we have these functions, we can use lists to represent XML yet that act
    as if they were instances of a structure type.These functions parse S-expressions,
    and parsers are tricky to design. So letâ€™s design them carefully, starting with
    some data examples:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â a0Â ''((initialÂ "X")))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â e0Â ''(machine))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â e1Â `(machineÂ ,a0))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â e2Â ''(machineÂ (action)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â e3Â ''(machineÂ ()Â (action)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â e4Â `(machineÂ ,a0Â (action)Â (action)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The first definition introduces a list of attributes, which is reused twice
    in the construction of X-expressions. The definition of e0 reminds us that an
    X-expression may not come with either attributes or content. You should be able
    to explain why e2 and e3 are basically equivalent.Next we formulate a signature,
    a purpose statement, and a header:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Xexpr.v2](#%28tech._xexpr..v2%29) -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Attribute](#%28tech._attribute%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â retrieves the list of attributes of xe |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xexpr-attrÂ xe)Â ''())
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Here we focus on xexpr-attr; we leave the other two as exercises.Making up
    functional examples requires a decision concerning the extraction of attributes
    from X-expressions without any. While our chosen representation completely omits
    missing attributes, we must supply ''() for the structure-based representation
    of XML. The function therefore produces ''() for such X-expressions:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (xexpr-attrÂ e0)Â ''())
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (xexpr-attrÂ e1)Â ''((initialÂ "X")))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (xexpr-attrÂ e2)Â ''())
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (xexpr-attrÂ e3)Â ''())
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (xexpr-attrÂ e4)Â ''((initialÂ "X")))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'It is time to develop the template. Since the data definition for [Xexpr.v2](#%28tech._xexpr..v2%29)
    is complex, we proceed slowly, step-by-step. First, while the data definition
    distinguishes two kinds of X-expressions, both clauses describe data constructed
    by [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)ing
    a symbol onto a list. Second, what differentiates the two clauses is the rest
    of the list and especially the optional presence of a list of attributes. Letâ€™s
    translate these two insights into a template:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xexpr-attrÂ xe)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â optional-loa+contentÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â xe)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â optional-loa+content)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The local definition chops off the name of the X-expression and leaves the
    remainder of the list, which may or may not start with a list of attributes. The
    key is that it is just a list, and the two [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clauses indicate so. Third, this list is not defined via a self-reference but
    as the optional [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)
    of some attributes onto a possibly empty list of X-expressions. In other words,
    we still need to distinguish the two usual cases and extract the usual pieces:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xexpr-attrÂ xe)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â optional-loa+contentÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â xe)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â optional-loa+content)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â optional-loa+content)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â optional-loa+content)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'At this point, we can already see that recursion is not needed for the task
    at hand. So, we switch to the fifth step of the design recipe. Clearly, there
    are no attributes if the given X-expression comes with nothing but a name. In
    the second clause, the question is whether the first item on the list is a list
    of attributes or just an [Xexpr.v2](#%28tech._xexpr..v2%29). Because this sounds
    complicated, we make a wish:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Attribute](#%28tech._attribute%29)]
    or [Xexpr.v2](#%28tech._xexpr..v2%29) -> ??? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â determines whether x is an element of [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Attribute](#%28tech._attribute%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â #false otherwise |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-of-attributes?Â x)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â #false) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: With this function, it is straightforward to finish xexpr-attr; see [figureÂ 126](#%28counter._%28figure._fig~3axexpr-attr%29%29).
    If the first item is a list of attributes, the function produces it; otherwise
    there are no attributes.
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xexpr-attrÂ xe)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â optional-loa+contentÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â xe)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â optional-loa+content)Â ''()]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â loa-or-x
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â optional-loa+content)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â (list-of-attributes?Â loa-or-x)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â loa-or-x |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â ''()))]))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 126: The complete definition of xexpr-attr'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'For the design of list-of-attributes?, we proceed in the same manner and get
    this definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Attribute](#%28tech._attribute%29)]
    or [Xexpr.v2](#%28tech._xexpr..v2%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â is x a list of attributes |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-of-attributes?Â x)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â x)Â #true]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â possible-attributeÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â x)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â possible-attribute))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: We skip the details of the design process because they are unremarkable. What
    is remarkable is the signature of this function. Instead of specifying a single
    data definition as possible inputs, the signature combines two data definitions
    separated by the English word â€œor.â€ In ISL+ such an informal signature with a
    definite meaning is acceptable on occasion.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 366\. Design xexpr-name and xexpr-content.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 367\. The design recipe calls for a self-reference in the template
    for xexpr-attr. Add this self-reference to the template and then explain why the
    finished parsing function does not contain it.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 368\. Formulate a data definition that replaces the informal â€œorâ€ signature
    for the definition of the list-of-attributes? function.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 369\. Design find-attr. The function consumes a list of attributes
    and a symbol. If the attributes list associates the symbol with a string, the
    function retrieves this string; otherwise it returns #false. Look up [assq](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assq%29%29)
    and use it to define the function.'
  prefs: []
  type: TYPE_NORMAL
- en: For the remainder of this chapter, Xexpr refers to [Xexpr.v2](#%28tech._xexpr..v2%29).
    Also, we assume xexpr-name, xexpr-attr, and xexpr-content are defined. Finally,
    we use find-attr from [exerciseÂ 369](#%28counter._%28exercise._ex~3alookup-attribute%29%29)
    to retrieve attribute values.
  prefs: []
  type: TYPE_NORMAL
- en: 22.2Rendering XML Enumerations[ğŸ”—](#(part._sec~3aenum) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: XML is actually a family of languages. People define dialects for specific channels
    of communication. For example, XHTML is the language for sending web content in
    XML format. In this section, we illustrate how to design a rendering function
    for a small snippet of XHTML, specifically the enumerations from the beginning
    of this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: The ul tag surrounds a so-called unordered HTML list. Each item of this list
    is tagged with li, which tends to contain words but also other elements, even
    enumerations. What â€œunordered HTMLâ€ means is that each item is to be rendered
    with a leading bullet instead of a number.
  prefs: []
  type: TYPE_NORMAL
- en: 'Since [Xexpr](#%28tech._xexpr%29) does not come with plain strings, it is not
    immediately obvious how to represent XHTML enumerations in a subset. One option
    is to refine the data representation one more time, so that an [Xexpr](#%28tech._xexpr%29)
    could be a [String](part_one.html#%28tech._string%29). Another option is to introduce
    a representation for text:'
  prefs: []
  type: TYPE_NORMAL
- en: ;Â An XWord is '(word  ((text  [String](part_one.html#%28tech._string%29)))).
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Here, we use this second option; Racket, the language from which the teaching
    languages are derived, offers teachpacks that include [String](part_one.html#%28tech._string%29)
    in [Xexpr](#%28tech._xexpr%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 370\. Make up three examples for [XWord](#%28tech._xword%29)s. Design
    word?, which checks whether some ISL+ value is in [XWord](#%28tech._xword%29),
    and word-text, which extracts the value of the only attribute of an instance of
    [XWord](#%28tech._xword%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 371\. Refine the definition of [Xexpr](#%28tech._xexpr%29) so that
    you can represent XML elements, including items in enumerations, that are plain
    strings.
  prefs: []
  type: TYPE_NORMAL
- en: 'Given the representation of words, representing an XHTML-style enumeration
    of words is straightforward:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An XEnum.v1 is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''ul  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [XItem.v1](#%28tech._xitem..v1%29)])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''ul  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  Attributes  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [XItem.v1](#%28tech._xitem..v1%29)]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An XItem.v1 is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''li  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [XWord](#%28tech._xword%29)  ''()))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''li  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  Attributes  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [XWord](#%28tech._xword%29)  ''())))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: For completeness, the data definition includes attribute lists, even though
    they do not affect rendering.
  prefs: []
  type: TYPE_NORMAL
- en: Stop! Argue that every element of [XEnum.v1](#%28tech._xenum..v1%29) is also
    in [XExpr](#%28tech._xexpr%29).
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is a sample element of [XEnum.v1](#%28tech._xenum..v1%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â e0
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ''(ul |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (liÂ (wordÂ ((textÂ "one")))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (liÂ (wordÂ ((textÂ "two")))))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'It corresponds to the inner enumeration of the example from the beginning of
    the chapter. Rendering it with help from the 2htdp/image teachpack should yield
    an image like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/3cb365e73fec6305d41977c2a280f916.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: The radius of the bullet and the distance between the bullet and the text are
    matters of aesthetics; here the idea matters.To create this kind of image, you
    might use this ISL+ program:We developed these expressions in the interactions
    area. What would you do?
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â e0-rendered
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([above/align](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._above%2Falign%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â ''left |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â ([beside/align](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29)Â ''centerÂ BTÂ ([text](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29)Â "one"Â 12Â ''black))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â ([beside/align](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29)Â ''centerÂ BTÂ ([text](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29)Â "two"Â 12Â ''black))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: assuming BT is a rendering of a bullet.
  prefs: []
  type: TYPE_NORMAL
- en: Now letâ€™s design the function carefully. Since the data representation requires
    two data definitions, the design recipe tells you that you must design two functions
    in parallel. A second look reveals, however, that in this particular case the
    second data definition is disconnected from the first one, meaning we can deal
    with it separately.
  prefs: []
  type: TYPE_NORMAL
- en: 'Furthermore, the definition for [XItem.v1](#%28tech._xitem..v1%29) consists
    of two clauses, meaning the function itself should consist of a [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    with two clauses. The point of viewing [XItem.v1](#%28tech._xitem..v1%29) as a
    sub-language of [Xexpr](#%28tech._xexpr%29), however, is to think of these two
    clauses in terms of [Xexpr](#%28tech._xexpr%29) selector functions, in particular,
    xexpr-content. With this function we can extract the textual part of an item,
    regardless of whether it comes with attributes or not:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [XItem.v1](#%28tech._xitem..v1%29) -> [Image](part_one.html#%28tech._image%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â renders an item as a "word" prefixed by a bullet |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-item1Â i)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (xexpr-contentÂ i)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'In general, xexpr-content extracts a list of [Xexpr](#%28tech._xexpr%29); in
    this specific case, the list contains exactly one [XWord](#%28tech._xword%29),
    and this word contains one text:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-item1Â i)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (xexpr-contentÂ i))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â elementÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â content))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â a-wordÂ (word-textÂ element)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â a-wordÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'From here, it is straightforward:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-item1Â i)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (xexpr-contentÂ i))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â elementÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â content))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â a-wordÂ (word-textÂ element))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â itemÂ ([text](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29)Â a-wordÂ 12Â ''black)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([beside/align](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29)Â ''centerÂ BTÂ item)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: After extracting the text to be rendered in the item, it is simply a question
    of rendering it as text and equipping it with a leading bullet; see the examples
    above for how you might discover this last step.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 372\. Before you read on, equip the definition of render-item1 with
    tests. Make sure to formulate these tests in such a way that they donâ€™t depend
    on the BT constant. Then explain how the function works; keep in mind that the
    purpose statement explains what it does.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we can focus on the design of a function that renders an enumeration. Using
    the example from above, the first two design steps are easy:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [XEnum.v1](#%28tech._xenum..v1%29) -> [Image](part_one.html#%28tech._image%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â renders a simple enumeration as an image |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (render-enum1Â e0)Â e0-rendered)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-enum1Â xe)Â [empty-image](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The key step is the development of a template. According to the data definition,
    an element of [XEnum.v1](#%28tech._xenum..v1%29) contains one interesting piece
    of data, namely, the (representation of the) XML elements. The first item is always
    ''ul, so there is no need to extract it, and the second, optional item is a list
    of attributes, which we ignore. With this in mind, the first template draft looks
    just like the one for render-item1:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-enum1Â xe)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (xexpr-contentÂ xe)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))Â ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [XItem.v1](#%28tech._xitem..v1%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'While the data-oriented design recipe tells you that you should design a separate
    function whenever you encounter a complex form of data, the abstraction-based
    design recipe from [Abstraction](part_three.html) tells you to reuse an existing
    abstraction, say, a list-processing function from [figuresÂ 95](part_three.html#%28counter._%28figure._fig~3aisl-ho-list%29%29)
    and [96](part_three.html#%28counter._%28figure._fig~3aisl-ho-list2%29%29), when
    possible. Given that render-enum1 is supposed to process a list and create a single
    image from it, the only two list-processing abstractions whose signatures fit
    the bill are [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)
    and [foldl](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldl%29%29).
    If you also study their purpose statements, you see a pattern that is like the
    e0-rendered example above, especially for [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29).
    Letâ€™s try to use it, following the reuse design recipe:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-enum1Â xe)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (xexpr-contentÂ xe))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â ;Â [XItem.v1](#%28tech._xitem..v1%29)  [Image](part_one.html#%28tech._image%29)
    -> [Image](part_one.html#%28tech._image%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (deal-with-oneÂ itemÂ so-far)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â deal-with-oneÂ [empty-image](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29)Â content)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'From the type matching, you also know that:'
  prefs: []
  type: TYPE_NORMAL
- en: the first argument to [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)
    must be a two-argument function;
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: the second argument must be an image; and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: the last argument is the list representing XML content.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Naturally [empty-image](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29)
    is the correct starting point.This design-by-reuse focuses our attention on the
    function to be â€œfoldedâ€ over the list. It turns one item and the image that [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)
    has created so far into another image. The signature for deal-with-one articulates
    this insight. Since the first argument is an [XItem.v1](#%28tech._xitem..v1%29),
    render-item1 is the function that renders it. This yields two images that must
    be combined: the image of the first item and the image of the rest of the items.
    To stack them, we use [above](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._above%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-enum1Â xe)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (xexpr-contentÂ xe))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [XItem.v1](#%28tech._xitem..v1%29)  [Image](part_one.html#%28tech._image%29)
    -> [Image](part_one.html#%28tech._image%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (deal-with-oneÂ itemÂ so-far)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([above/align](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._above%2Falign%29%29)Â ''left
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (render-item1Â item) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â so-far))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â deal-with-oneÂ [empty-image](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29)Â content)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An XItem.v2 is one of: |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''li  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [XWord](#%28tech._xword%29)  ''()))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''li  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Attribute](#%28tech._attribute%29)]  ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  [XWord](#%28tech._xword%29))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''li  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [XEnum.v2](#%28tech._xenum..v2%29)  ''()))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''li  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Attribute](#%28tech._attribute%29)]  ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  [XEnum.v2](#%28tech._xenum..v2%29))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An XEnum.v2 is one of: |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''ul  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [XItem.v2](#%28tech._xitem..v2%29)])
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''ul  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Attribute](#%28tech._attribute%29)]  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [XItem.v2](#%28tech._xitem..v2%29)]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 127: A realistic data representation of XML enumerations'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Flat enumerations are common, but they are also a simple approximation of the
    full-fledged case. In the real world, web browsers must cope with arbitrarily
    nested enumerations that arrive over the web. In XML and its web browser dialect
    XHTML, nesting is straightforward. Any element may show up as the content of any
    other element. To represent thisAre you wondering whether arbitrary nesting is
    the correct way to think about this problem? If so, develop a data definition
    that allows only three levels of nesting and then use it. relationship in our
    limited XHTML representation, we say that an item is either a word or another
    enumeration. [FigureÂ 127](#%28counter._%28figure._fig~3axenum%29%29) displays
    the second revision of the data definition. It includes a revision of the data
    definition for enumerations so that the first definition refers to the correct
    form of item.
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â SIZEÂ 12)Â ;Â font
    size |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â COLORÂ "black")Â ;Â font
    color |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â BTÂ ;Â a
    graphical constant |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([beside](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%29%29)Â ([circle](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._circle%29%29)Â 1Â ''solidÂ BLACK)Â ([text](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29)Â "
    "Â SIZEÂ COLOR))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Image](part_one.html#%28tech._image%29) -> [Image](part_one.html#%28tech._image%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â marks item with bulletÂ Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (bulletizeÂ item)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([beside/align](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29)Â ''centerÂ BTÂ item))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [XEnum.v2](#%28tech._xenum..v2%29) -> [Image](part_one.html#%28tech._image%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â renders an [XEnum.v2](#%28tech._xenum..v2%29) as an image |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-enumÂ xe)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (xexpr-contentÂ xe))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [XItem.v2](#%28tech._xitem..v2%29)  [Image](part_one.html#%28tech._image%29)
    -> [Image](part_one.html#%28tech._image%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (deal-with-oneÂ itemÂ so-far)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([above/align](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._above%2Falign%29%29)Â ''leftÂ (render-itemÂ item)Â so-far)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â deal-with-oneÂ [empty-image](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-image%29%29)Â content)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [XItem.v2](#%28tech._xitem..v2%29) -> [Image](part_one.html#%28tech._image%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â renders one [XItem.v2](#%28tech._xitem..v2%29) as an image |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-itemÂ an-item)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â (xexpr-contentÂ an-item))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (bulletize |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â [(word?Â content) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â ([text](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29)Â (word-textÂ content)Â SIZEÂ BLACK)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (render-enumÂ content)]))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 128: Refining functions to match refinements of data definitions'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The next question is how this change to the data definition affects the rendering
    functions. Put differently, we need to revise render-enum1 and render-item1 so
    that they can cope with [XEnum.v2](#%28tech._xenum..v2%29) and [XItem.v2](#%28tech._xitem..v2%29),
    respectively. Software engineers face these kinds of questions all the time, and
    it is another situation where the design recipe shines.
  prefs: []
  type: TYPE_NORMAL
- en: '[FigureÂ 128](#%28counter._%28figure._fig~3aenum%29%29) shows the complete answer.
    Since the change is confined to the data definitions for [XItem.v2](#%28tech._xitem..v2%29),
    it should not come as a surprise that the change to the rendering program shows
    up in the function for rendering items. While render-item1 does not need to distinguish
    between different forms of [XItem.v1](#%28tech._xitem..v1%29), render-item is
    forced to use a [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    because [XItem.v2](#%28tech._xitem..v2%29) lists two different kinds of items.
    Given that this data definition is close to one from the real world, the distinguishing
    characteristic is not something simpleâ€”<wbr>like ''() vs [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)â€”<wbr>but
    a specific piece of the given item. If the itemâ€™s content is a [XWord](#%28tech._xword%29),
    the rendering function proceeds as before. Otherwise, the item contains an enumeration,
    in which case render-item uses render-enum to deal with the data, because the
    data definition for [XItem.v2](#%28tech._xitem..v2%29) refers back to [XEnum.v2](#%28tech._xenum..v2%29)
    precisely at this point.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 373\. [FigureÂ 128](#%28counter._%28figure._fig~3aenum%29%29) is missing
    test cases. Develop test cases for all the functions.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 374\. The data definitions in [figureÂ 127](#%28counter._%28figure._fig~3axenum%29%29)
    use [list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29).
    Rewrite them so they use [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29).
    Then use the recipe to design the rendering functions for [XEnum.v2](#%28tech._xenum..v2%29)
    and [XItem.v2](#%28tech._xitem..v2%29) from scratch. You should come up with the
    same definitions as in [figureÂ 128](#%28counter._%28figure._fig~3aenum%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 375\. The wrapping of [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    with
  prefs: []
  type: TYPE_NORMAL
- en: ([beside/align](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%2Falign%29%29)Â 'centerÂ BTÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: may surprise you. Edit the function definition so that the wrap-around appears
    once in each clause. Why are you confident that your change works? Which version
    do you prefer?
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 376\. Design a program that counts all "hello"s in an instance of [XEnum.v2](#%28tech._xenum..v2%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 377\. Design a program that replaces all "hello"s with "bye" in an
    enumeration.
  prefs: []
  type: TYPE_NORMAL
- en: 22.3Domain-Specific Languages[ğŸ”—](#(part._sec~3aconfig) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Engineers routinely build large software systems that require a configuration
    for specific contexts before they can be run. This configuration task tends to
    fall to systems administrators who must deal with many different software systems.
    The word â€œconfigurationâ€ refers to the data that the main function needs when
    the program is launched at the command-line or via a gesture (mouse click, swipe).
    In a sense a configuration is just an additional argument, though it is usually
    so complex that program designers prefer to handing it over via a file.
  prefs: []
  type: TYPE_NORMAL
- en: Since software engineers cannot assume that systems administrators know every
    programming language, they tend to devise simple, special-purpose configuration
    languages. These special languages are also known as domain-specific languages
    (DSL).Because configurations abstract a program over various pieces of data, Paul
    Hudak argued in the 1990s that DSLs are the ultimate abstractions, that is, that
    they generalize the ideas of [Abstraction](part_three.html) to perfection. Developing
    these DSLs around a common core, say the well-known XML syntax, simplifies life
    for systems administrators. They can write small XML â€œprogramsâ€ and thus configure
    the systems they must launch.
  prefs: []
  type: TYPE_NORMAL
- en: While the construction of a DSL is often considered a task for an advanced programmer,
    you are actually in a position already to understand, appreciate, and implement
    a reasonably complex DSL. This section explains how it all works. It first reacquaints
    you with finite state machines (FSMs). Then it shows how to design, implement,
    and program a DSL for configuring a system that simulates arbitrary FSMs.
  prefs: []
  type: TYPE_NORMAL
- en: Finite State Machines Remembered The theme of finite state machines is an important
    one in computing, and this book has presented it several times. Here we reuse
    the example from [Finite State Machines](part_two.html#%28part._sec~3asec-fsm-list%29)
    as the component for which we wish to design and implement a configuration DSL.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An FSM is a [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [1Transition](#%28tech._1transition%29)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A 1Transition is a list of two items: |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [FSM-State](part_two.html#%28tech._fsm._state%29)  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [FSM-State](part_two.html#%28tech._fsm._state%29)  ''()))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An FSM-State is a [String](part_one.html#%28tech._string%29) that specifies
    a color |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â data examples |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â fsm-traffic
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ''(("red"Â "green")Â ("green"Â "yellow")Â ("yellow"Â "red"))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [FSM-State](part_two.html#%28tech._fsm._state%29)  [FSM](part_two.html#%28tech._fsm%29)
    -> [FSM-State](part_two.html#%28tech._fsm._state%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â matches the keys pressed by a player with the given [FSM](part_two.html#%28tech._fsm%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (simulateÂ state0Â transitions)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([big-bang](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29)Â state0Â ;Â [FSM-State](part_two.html#%28tech._fsm._state%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[to-draw](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._to-draw%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)Â (current)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([square](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._square%29%29)Â 100Â "solid"Â current))]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[on-key](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-key%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)Â (currentÂ key-event)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â (findÂ transitionsÂ current))])) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [X Y] [[List-of](part_three.html#%28tech._sim-dd._list._of%29) [[List](part_three.html#%28tech._sim-dd._list%29)  X  Y]]
    X -> Y |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â finds the matching Y for the given X in alist |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (findÂ alistÂ x)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â fmÂ ([assoc](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assoc%29%29)Â xÂ alist)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â fm)Â ([second](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29)Â fm)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â "not
    found")))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 129: Finite state machines, revisited'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'For convenience, [figureÂ 129](#%28counter._%28figure._fig~3afsm-again%29%29)
    presents the entire code again, though reformulated using just lists and using
    the full power of ISL+. The program consists of two data definitions, one data
    example, and two function definitions: simulate and find. Unlike the related programs
    in preceding chapters, this one represents a transition as a list of two items:
    the current state and the next one.'
  prefs: []
  type: TYPE_NORMAL
- en: The main function, simulate, consumes a transition table and an initial state;
    it then evaluates a [big-bang](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29)
    expression, which reacts to each key event with a state transition. The states
    are displayed as colored squares. The [to-draw](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._to-draw%29%29)
    and [on-key](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-key%29%29)
    clauses are specified with [lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)
    expressions that consume the current state, plus the actual key event, and that
    produce an image or the next state, respectively.
  prefs: []
  type: TYPE_NORMAL
- en: As its signature shows, the auxiliary find function is completely independent
    of the FSM application. It consumes a list of two-item lists and an item, but
    the actual nature of the items is specified via parameters. In the context of
    this program, X and Y represent [FSM-State](part_two.html#%28tech._fsm._state%29)s,
    meaning find consumes a transition table together with a state and produces a
    state. The function body uses the built-in [assoc](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assoc%29%29)
    function to perform most of the work. Look up the documentation for [assoc](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._assoc%29%29)
    so that you understand why the body of [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    uses an [if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)
    expression.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 378\. Modify the rendering function so that it overlays the name of
    the state onto the colored square.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 379\. Formulate test cases for find.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 380\. Reformulate the data definition for [1Transition](#%28tech._1transition%29)
    so that it is possible to restrict transitions to certain keystrokes. Try to formulate
    the change so that find continues to work without change. What else do you need
    to change to get the complete program to work? Which part of the design recipe
    provides the answer(s)? See [exerciseÂ 229](part_two.html#%28counter._%28exercise._ex~3afsm-design3%29%29)
    for the original exercise statement.
  prefs: []
  type: TYPE_NORMAL
- en: Configurations The FSM simulation function uses two arguments, which jointly
    describe a machine. Rather than teach a potential â€œcustomerâ€ how to open an ISL+
    program in DrRacket and launch a function of two arguments, the â€œsellerâ€ of simulate
    may wish to supplement this product with a configuration component.
  prefs: []
  type: TYPE_NORMAL
- en: 'A configuration component consists of two parts. The first one is a widely
    used simple language that customers use to formulate the initial arguments for
    a componentâ€™s main function(s). The second one is a function that translates what
    customers say into a function call for the main function. For the FSM simulator,
    we must agree on how we represent finite state machines in XML. By judicious planning,
    [XML as S-expressions](#%28part._sec~3axml%29) presents a series of machine examples
    that look just right for the task. Recall the final machine example in this section:'
  prefs: []
  type: TYPE_NORMAL
- en: '| <machine initial="red"> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <action state="red"Â Â Â Â next="green" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <action state="green"Â Â next="yellow" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <action state="yellow" next="red" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| </machine> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Compare it to the transition table fsm-traffic from [figureÂ 129](#%28counter._%28figure._fig~3afsm-again%29%29).
    Also recall the agreed-upon [Xexpr](#%28tech._xexpr%29) representation of this
    example:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â xm0
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ''(machineÂ ((initialÂ "red")) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â (actionÂ ((stateÂ "red")Â (nextÂ "green"))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â (actionÂ ((stateÂ "green")Â (nextÂ "yellow"))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â (actionÂ ((stateÂ "yellow")Â (nextÂ "red"))))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'What we are still lacking is a general data definition that describes all possible
    [Xexpr](#%28tech._xexpr%29) representations of [FSM](part_two.html#%28tech._fsm%29)s:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An XMachine is a nested list of this shape: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ''machine  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  `((initial  ,[FSM-State](part_two.html#%28tech._fsm._state%29)))Â Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [X1T](#%28tech._x1t%29)]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An X1T is a nested list of this shape: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â `(action  ((state  ,[FSM-State](part_two.html#%28tech._fsm._state%29))  (next  ,[FSM-State](part_two.html#%28tech._fsm._state%29))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Like [XEnum.v2](#%28tech._xenum..v2%29), [XMachine](#%28tech._xmachine%29) describes
    a subset of all [Xexpr](#%28tech._xexpr%29). Thus, when we design functions that
    process this new form of data, we may continue to use the generic [Xexpr](#%28tech._xexpr%29)
    functions to access pieces.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 381\. The definitions of [XMachine](#%28tech._xmachine%29) and [X1T](#%28tech._x1t%29)
    use quote, which is highly inappropriate for novice program designers. Rewrite
    them first to use [list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)
    and then [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 382\. Formulate an XML configuration for the BW machine, which switches
    from white to black and back for every key event. Translate the XML configuration
    into an [XMachine](#%28tech._xmachine%29) representation. See [exerciseÂ 227](part_two.html#%28counter._%28exercise._ex~3afsm-design2%29%29)
    for an implementation of the machine as a program.
  prefs: []
  type: TYPE_NORMAL
- en: 'Before we dive into the translation part of the configuration problem, letâ€™s
    spell it out:'
  prefs: []
  type: TYPE_NORMAL
- en: Sample Problem Design a program that uses an [XMachine](#%28tech._xmachine%29)
    configuration to run simulate.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'While this problem is specific to our case, it is easy to imagine a generalization
    for similar systems, and we encourage you to do so.The problem statement suggests
    a complete outline:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [XMachine](#%28tech._xmachine%29) -> [FSM-State](part_two.html#%28tech._fsm._state%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â simulates an FSM via the given configuration |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (simulate-xmachineÂ xm)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (simulateÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Following the problem statement, our function calls simulate with two to-be-determined
    arguments. What we need to complete the definition are two pieces: an initial
    state and a transition table. These two pieces are part of xm, and we are best
    off wishing for appropriate functions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'xm-state0 extracts the initial state from the given [XMachine](#%28tech._xmachine%29):'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (xm-state0Â xm0)Â "red")
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'xm->transitions translates the embedded list of [X1T](#%28tech._x1t%29)s into
    a list of [1Transition](#%28tech._1transition%29)s:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (xm->transitionsÂ xm0)Â fsm-traffic)
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| ;Â [XMachine](#%28tech._xmachine%29) -> [FSM-State](part_two.html#%28tech._fsm._state%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â interprets the given configuration as a state machine |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (simulate-xmachineÂ xm)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (simulateÂ (xm-state0Â xm)Â (xm->transitionsÂ xm))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [XMachine](#%28tech._xmachine%29) -> [FSM-State](part_two.html#%28tech._fsm._state%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â extracts and translates the transition table from xm0 |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (xm-state0Â xm0)Â "red")
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xm-state0Â xm0)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (find-attrÂ (xexpr-attrÂ xm0)Â ''initial)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [XMachine](#%28tech._xmachine%29) -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [1Transition](#%28tech._1transition%29)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â extracts the transition table from xm |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (xm->transitionsÂ xm0)Â fsm-traffic)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xm->transitionsÂ xm)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [X1T](#%28tech._x1t%29)
    -> [1Transition](#%28tech._1transition%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xaction->actionÂ xa)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â (find-attrÂ (xexpr-attrÂ xa)Â ''state)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (find-attrÂ (xexpr-attrÂ xa)Â ''next)))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â xaction->actionÂ (xexpr-contentÂ xm))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 130: Interpreting a DSL program'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Since [XMachine](#%28tech._xmachine%29) is a subset of Xexpr, defining xm-state0
    is straightforward. Given that the initial state is specified as an attribute,
    xm-state0 extracts the list of attributes using xexpr-attr and then retrieves
    the value of the 'initial attribute.
  prefs: []
  type: TYPE_NORMAL
- en: 'Letâ€™s then turn to xm->transitions, which translates the transitions inside
    of an XMachine configuration into a transition table:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [XMachine](#%28tech._xmachine%29) -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [1Transition](#%28tech._1transition%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â extracts & translates the transition table from xm |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xm->transitionsÂ xm)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â ''()) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The name of the function prescribes the signature and suggests a purpose statement.
    Our purpose statement describes a two-step process: (1) extract the Xexpr representation
    of the transitions and (2) translate them into an instance of [[List-of](part_three.html#%28tech._sim-dd._list._of%29)
    [1Transition](#%28tech._1transition%29)].While the extraction part obviously uses
    xexpr-content to get the list, the translation part calls for some more analysis.
    If you look back to the data definition of [XMachine](#%28tech._xmachine%29),
    you see that the content of the [Xexpr](#%28tech._xexpr%29) is a list of [X1T](#%28tech._x1t%29)s.
    The signature tells us that the transition table is a list of [1Transition](#%28tech._1transition%29)s.
    Indeed, it is quite obvious that each item in the former list is translated into
    one item of the latter, which suggests a use of [map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xm->transitionsÂ xm)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [X1T](#%28tech._x1t%29)
    -> [1Transition](#%28tech._1transition%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (xaction->actionÂ xa)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â xaction->actionÂ (xexpr-contentÂ xm))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: As you can see, we follow the design ideas of [Using Abstractions, by Example](part_three.html#%28part._sec~3ausage-examples%29)
    and formulate the function as a [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    whose body uses [map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29).
    Defining xaction->action is again just a matter of extracting the appropriate
    values from an [Xexpr](#%28tech._xexpr%29).
  prefs: []
  type: TYPE_NORMAL
- en: '[FigureÂ 130](#%28counter._%28figure._fig~3adsl%29%29) displays the complete
    solution. Here the translation from the DSL to a proper function call is as large
    as the original component. This is not the case for real-world systems; the DSL
    component tends to be a small fraction of the overall product, which is why the
    approach is so popular.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 383\. Run the code in [figureÂ 130](#%28counter._%28figure._fig~3adsl%29%29)
    with the BW Machine configuration from [exerciseÂ 382](#%28counter._%28exercise._ex~3axmachine-data1%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: machine-configuration.xml
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <machine initial="red"> |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â <action state="red"Â Â Â Â next="green" /> |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â <action state="green"Â Â next="yellow" /> |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â <action state="yellow" next="red" /> |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â </machine> |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '|  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 131: A file with a machine configuration'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 22.4Reading XML[ğŸ”—](#(part._sub~3areading-xml) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Systems administrators expect that sophisticated applications read configuration
    programsThis section uses 2htdp/batch-io 2htdp/universe, and 2htdp/image teachpacks.
    from a file or possibly from some place on the web. In ISL+ your programs can
    retrieve (some) XML information. [FigureÂ 132](#%28counter._%28figure._fig~3axexpr-tp%29%29)
    shows the relevant excerpt from the teachpack. For consistency, the figure uses
    the suffix .v3 for its XML representation, including those data definitions for
    which there is no version 2:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An Xexpr.v3 is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â   â€“  [Symbol](i2-3.html#%28tech._symbol%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â   â€“  [String](part_one.html#%28tech._string%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â   â€“  [Number](part_one.html#%28tech._number%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â   â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Symbol](i2-3.html#%28tech._symbol%29)  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Attribute*.v3](#%28tech._attribute%2A..v3%29)  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Xexpr.v3](#%28tech._xexpr..v3%29)]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â   â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Symbol](i2-3.html#%28tech._symbol%29)  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Xexpr.v3](#%28tech._xexpr..v3%29)])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An Attribute*.v3 is a [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Attribute.v3](#%28tech._attribute..v3%29)].
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An Attribute.v3 is a list of two items: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  [Symbol](i2-3.html#%28tech._symbol%29)  [String](part_one.html#%28tech._string%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Any](part_one.html#%28tech._any%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â is x an [Xexpr.v3](#%28tech._xexpr..v3%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â effect displays bad piece if x is not an [Xexpr.v3](#%28tech._xexpr..v3%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ([xexpr?](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._xexpr~3f%29%29)Â x)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [String](part_one.html#%28tech._string%29) -> [Xexpr.v3](#%28tech._xexpr..v3%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â produces the first XML element in file f |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ([read-xexpr](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%29%29)Â f)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [String](part_one.html#%28tech._string%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â #false, if this url returns a ''404''; #true otherwise |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ([url-exists?](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._url-exists~3f%29%29)Â u)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [String](part_one.html#%28tech._string%29) -> [[Maybe](part_three.html#%28tech._sim-dd._maybe%29)  [Xexpr.v3](#%28tech._xexpr..v3%29)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â retrieves the first XML (HTML) element from URL u |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â #false if ([not](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._not%29%29)  ([url-exists?](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._url-exists~3f%29%29)  u))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ([read-plain-xexpr/web](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-plain-xexpr%2Fweb%29%29)Â u)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [String](part_one.html#%28tech._string%29) -> [[Maybe](part_three.html#%28tech._sim-dd._maybe%29)  [Xexpr.v3](#%28tech._xexpr..v3%29)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â retrieves the first XML (HTML) element from URL u |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â #false if ([not](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._not%29%29)  ([url-exists?](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._url-exists~3f%29%29)  u))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ([read-xexpr/web](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%2Fweb%29%29)Â u)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 132: Reading X-expressions'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Assume we have the file in [figureÂ 131](#%28counter._%28figure._fig~3amachine-configuration..xml%29%29).
    If the 2htdp/batch-io teachpack is required, a program can read the element with
    [read-plain-xexpr](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-plain-xexpr%29%29).
    The function retrieves the XML element in a format that matches the [XMachine](#%28tech._xmachine%29)
    data definition. A function for retrieving XML elements from the web is also available
    in the teachpack. Try this in DrRacket:'
  prefs: []
  type: TYPE_NORMAL
- en: '| >Â ([read-plain-xexpr/web](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-plain-xexpr%2Fweb%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([string-append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string-append%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â "Https://Felleisen.org/" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â "matthias/" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â "HtDP2e/Files/machine-configuration.xml")) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: If your computer is connected to the web, this expression retrieves our standard
    machine configuration.
  prefs: []
  type: TYPE_NORMAL
- en: 'Reading files or web pages introduces an entirely novel idea into our computational
    model. As [Intermezzo 1: Beginning Student Language](i1-2.html) explains, a BSL
    program is evaluated in the same manner in which you evaluate variable expressions
    in algebra. Function definitions are also treated just like in algebra. Indeed,
    most algebra courses introduce conditional function definitions, meaning [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    does not pose any challenges either. Finally, while ISL+ introduces functions
    as values, the evaluation model remains fundamentally the same.'
  prefs: []
  type: TYPE_NORMAL
- en: One essential property of this computational model is that no matter how often
    you call a function f on some argument(s) a  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
  prefs: []
  type: TYPE_NORMAL
- en: (fÂ aÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: the answer remains the same. The introduction of [read-file](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-file%29%29),
    [read-xexpr](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%29%29),
    and their relatives destroys this property, however. The problem is that files
    and web sites may change over time so that every time a program reads files or
    web sites it may get a new result.
  prefs: []
  type: TYPE_NORMAL
- en: Consider the idea of looking up the stock price of a company. Point your browser
    to google.com/finance or any other such financial web site and enter the name
    of your favorite company, say, Ford. In response, the site will display the current
    price of the companyâ€™s stock and other informationâ€”<wbr>for example, how much
    the price has changed since the last time it was posted, the current time, and
    many other facts and ads. The important point is that as you reload this page
    over the course of a day or a week, some of the information on this web page will
    change.
  prefs: []
  type: TYPE_NORMAL
- en: 'An alternative to looking up such company information manually is to write
    a small program that retrieves such information on a regular basis, say, every
    15 seconds. With ISL you can write a world program that performs this task. You
    would launch it like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > (stock-alertÂ "Ford") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'to see a world window that displays an image like the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/ac85f75a7fbd8559a96044f6bbea3f30.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: 'To develop such a program requires skills beyond normal program design. First,
    you need to investigate how the web site formats its information. In the case
    of Googleâ€™s financial service page, an inspection of the web source code shows
    the following pattern near the top:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Â Â <meta content="17.09" itemprop="price" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <meta content="+0.07" itemprop="priceChange" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <meta content="0.41" itemprop="priceChangePercent" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <meta content="2013-08-12T16:59:06Z" itemprop="quoteTime" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â <meta content="NYSE real-time data" itemprop="dataSource" /> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: If we had a function that could search an [Xexpr.v3](#%28tech._xexpr..v3%29)
    and extract (the representation of XML) meta elements with the attribute value
    "price" and "priceChange", the rest of stock-alert would be straightforward.
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â PREFIXÂ "Https://www.google.com/finance?q=")
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â SIZEÂ 22)Â ;Â font
    size |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â dataÂ [priceÂ delta])
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A StockWorld is a structure: (make-data  [String](part_one.html#%28tech._string%29)  [String](part_one.html#%28tech._string%29))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [String](part_one.html#%28tech._string%29) -> [StockWorld](#%28tech._stockworld%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â retrieves the stock price of co and its change every 15s |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (stock-alertÂ co)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â urlÂ ([string-append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string-append%29%29)Â PREFIXÂ co))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [[StockWorld](#%28tech._stockworld%29) -> [StockWorld](#%28tech._stockworld%29)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (retrieve-stock-dataÂ __w)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â xÂ ([read-xexpr/web](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%2Fweb%29%29)Â url)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â (make-dataÂ (getÂ xÂ "price") |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (getÂ xÂ "priceChange")))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [StockWorld](#%28tech._stockworld%29) -> [Image](part_one.html#%28tech._image%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-stock-dataÂ w)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [[StockWorld](#%28tech._stockworld%29)  [String](part_one.html#%28tech._string%29)
    -> [String](part_one.html#%28tech._string%29)] -> [Image](part_one.html#%28tech._image%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (wordÂ selÂ col)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([text](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29)Â (selÂ w)Â SIZEÂ col)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([overlay](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._overlay%29%29)Â ([beside](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._beside%29%29)Â (wordÂ data-priceÂ ''black)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([text](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29)Â "Â Â "Â SIZEÂ ''white)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (wordÂ data-deltaÂ ''red)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([rectangle](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._rectangle%29%29)Â 300Â 35Â ''solidÂ ''white)))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([big-bang](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29)Â (retrieve-stock-dataÂ ''no-use)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [[on-tick](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-tick%29%29)Â retrieve-stock-dataÂ 15]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [[to-draw](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._to-draw%29%29)Â render-stock-data])))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 133: Web data as an event'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: It is no longer possible to complete this exercise because the web service no
    longer delivers stock quotes.
  prefs: []
  type: TYPE_NORMAL
- en: '[FigureÂ 133](#%28counter._%28figure._fig~3areal-time%29%29) displays the core
    of the program. The design of get is left to the exercises because its workings
    are all about intertwined data.'
  prefs: []
  type: TYPE_NORMAL
- en: 'As the figure shows, the main function defines two local ones: a clock-tick
    handler and a rendering function. The [big-bang](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29)
    specification requests that the clock tick every 15 seconds. When the clock ticks,
    ISL+ applies retrieve-stock-data to the current world, which it ignores. Instead,
    the function visits the web site via [read-xexpr/web](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%2Fweb%29%29)
    and extracts the appropriate information with get. Thus, the new world is created
    from newly available information on the web, not some local data.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 384\. [FigureÂ 133](#%28counter._%28figure._fig~3areal-time%29%29) mentions
    [read-xexpr/web](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%2Fweb%29%29).
    See [figureÂ 132](#%28counter._%28figure._fig~3axexpr-tp%29%29) for its signature
    and purpose statement and then read its documentation to determine the difference
    to its â€œplainâ€ relative.
  prefs: []
  type: TYPE_NORMAL
- en: '[FigureÂ 133](#%28counter._%28figure._fig~3areal-time%29%29) is also missing
    several important pieces, in particular the interpretation of data and purpose
    statements for all the locally defined functions. Formulate the missing pieces
    so that you get to understand the program.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 385\. Look up the current stock price for your favorite company at
    Googleâ€™s financial service page. If you donâ€™t favor a company, pick Ford. Then
    save the source code of the page as a file in your working directory. Use [read-xexpr](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-xexpr%29%29)
    in DrRacket to view the source as an [Xexpr.v3](#%28tech._xexpr..v3%29).
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 386\. Here is the get function:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Xexpr.v3](#%28tech._xexpr..v3%29)  [String](part_one.html#%28tech._string%29)
    -> [String](part_one.html#%28tech._string%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â retrieves the value of the "content" attribute |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â from a ''meta element that has attribute "itemprop" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â with value s |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (getÂ ''(metaÂ ((contentÂ "+1")Â (itempropÂ "F")))Â "F") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â "+1") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (getÂ xÂ s)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â resultÂ (get-xexprÂ xÂ s)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29)Â result)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â result |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â "not
    found")))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: It assumes the existence of get-xexpr, a function that searches an arbitrary
    [Xexpr.v3](#%28tech._xexpr..v3%29) for the desired attribute and produces [[Maybe](part_three.html#%28tech._sim-dd._maybe%29)
    [String](part_one.html#%28tech._string%29)].
  prefs: []
  type: TYPE_NORMAL
- en: Formulate test cases that look for other values than "F" and that force get
    to signal an error.
  prefs: []
  type: TYPE_NORMAL
- en: Design get-xexpr. Derive functional examples for this function from those for
    get. Generalize these examples so that you are confident get-xexpr can traverse
    an arbitrary [Xexpr.v3](#%28tech._xexpr..v3%29). Finally, formulate a test that
    uses the web data saved in [exerciseÂ 385](#%28counter._%28exercise._ex~3aweb-data1%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: 23Simultaneous Processing[ğŸ”—](#(part._ch~3asimu) "Link to here")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Some functions have to consume two arguments that belong to classes with nontrivial
    data definitions. How to design such functions depends on the relationship between
    the arguments. First, one of the arguments may have to be treated as if it were
    atomic. Second, it is possible that the function must process the two arguments
    in lockstep. Finally, the function may process the given data in accordance to
    all possible cases. This chapter illustrates the three cases with examples and
    provides an augmented design recipe. The last section discusses the equality of
    compound data.
  prefs: []
  type: TYPE_NORMAL
- en: '23.1Processing Two Lists Simultaneously: Case 1[ğŸ”—](#(part._sec~3atwo-inputs~3acase1)
    "Link to here")'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Consider the following signature, purpose statement, and header:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â replaces the final ''() in front with end |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (replace-eol-withÂ frontÂ end)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â front) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The signature says that the function consumes two lists. Letâ€™s see how the
    design recipe works in this case.We start by working through examples. If the
    first argument is ''(), replace-eol-with must produce the second one, no matter
    what it is:'
  prefs: []
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (replace-eol-withÂ '()Â '(aÂ b))Â '(aÂ b))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'In contrast, if the first argument is not ''(), the purpose statement requires
    that we replace ''() at the end of front with end:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (replace-eol-withÂ ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 1Â ''())Â ''(a))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 1Â ''(a)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (replace-eol-with
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 2Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 1Â ''()))Â ''(a))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 2Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 1Â ''(a))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The purpose statement and the examples suggest that as long as the second argument
    is a list, the function does not need to know anything about it. By implication,
    its template should be that of a list-processing function with respect to the
    first argument:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (replace-eol-withÂ frontÂ end)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â front)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â front)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (replace-eol-withÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â front)Â end)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Letâ€™s fill the gaps in the template following the fifth step of the design
    recipe. If front is ''(), replace-eol-with produces end. If front is not ''(),
    we must recall what the template expressions compute:'
  prefs: []
  type: TYPE_NORMAL
- en: ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  front)
    evaluates to the first item on the list, and
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: (replace-eol-with  ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  front)  end)
    replaces the final '() in ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  front)
    with end.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Stop! Use the table method to understand what these bullets mean for the running
    example.From here it is a small step to the complete definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (replace-eol-withÂ frontÂ end)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â front)Â end]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â front)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â (replace-eol-withÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â front)Â end))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ExerciseÂ 387\. Design cross. The function consumes a list of symbols and a list
    of numbers and produces all possible ordered pairs of symbols and numbers. That
    is, when given '(a  b  c) and '(1  2), the expected result is '((a  1)  (a  2)  (b  1)  (b  2)  (c  1)  (c  2)).
  prefs: []
  type: TYPE_NORMAL
- en: '23.2Processing Two Lists Simultaneously: Case 2[ğŸ”—](#(part._sec~3atwo-inputs~3acase2)
    "Link to here")'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: '[Functions that Produce Lists](part_two.html#%28part._sec~3alist-produce%29)
    presents the function wages*, which computes the weekly wages of some workers
    given their work hours. It consumes a list of numbers, which represents the hours
    worked per week, and produces a list of numbers, which are the corresponding weekly
    wages. While the problem assumes that all employees received the same pay rate,
    even a small company pays its workers differentiated wages.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Here we look at a slightly more realistic version. The function now consumes
    two lists: the list of hours worked and the list of corresponding hourly wages.
    We translate this revised problem into a revised header:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â multiplies the corresponding items on |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â hours and wages/h |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â assume the two lists are of equal length |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (wages*.v2Â hoursÂ wages/h)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ''()) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Making up examples is straightforward:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (wages*.v2Â ''()Â ''())Â ''())
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (wages*.v2Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 5.65)Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 40))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 226.0))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (wages*.v2Â ''(5.65Â 8.75)Â ''(40.0Â 30.0))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ''(226.0Â 262.5)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'As required, all three examples use lists of equal length.The assumption concerning
    the inputs can also be exploited for the development of the template. More concretely,
    the condition says that ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  hours)
    is true when ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  wages/h)
    is true, and furthermore, ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)  hours)
    is true when ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)  wages/h)
    is true. It is thus acceptable to use a template for one of the two lists:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (wages*.v2Â hoursÂ wages/h)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â hours)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â hours)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â wages/h)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (wages*.v2Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â hours)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â wages/h)))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: In the first [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause, both hours and wages/h are '(). Hence no selector expressions are needed.
    In the second clause, both hours and wages/h are constructed lists, which means
    we need four selector expressions. Finally, because the last two are lists of
    equal length, they make up a natural candidate for the natural recursion of wages*.v2.
  prefs: []
  type: TYPE_NORMAL
- en: The only unusual aspect of this template is that the recursive application consists
    of two expressions, both selector expressions for the two arguments. But, this
    idea directly follows from the assumption.
  prefs: []
  type: TYPE_NORMAL
- en: 'From here, it is a short step to a complete function definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (wages*.v2Â hoursÂ wages/h)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â hours)Â ''()]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â (weekly-wageÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â hours)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â wages/h))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â (wages*.v2Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â hours)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â wages/h)))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The first example implies that the answer for the first [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause is ''(). In the second one, we have three values available:'
  prefs: []
  type: TYPE_NORMAL
- en: ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  hours),
    which represents the first number of weekly hours;
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  wages/h),
    which is the first pay rate; and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: (wages*.v2  ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  hours)  ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  wages/h)),
    which, according to the purpose statement, computes the list of weekly wages for
    the remainders of the two lists.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now we just need to combine these values to get the final answer. As suggested
    by the examples, we must compute the weekly wage for the first employee and construct
    a list from that wage and the rest of the wages:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â (weekly-wageÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â hours)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â wages/h))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â (wages*.v2Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â hours)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â wages/h)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The auxiliary function weekly-wage uses the number of hours worked and the
    pay rate to compute the weekly wage for one worker:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Number](part_one.html#%28tech._number%29)  [Number](part_one.html#%28tech._number%29)
    -> [Number](part_one.html#%28tech._number%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â computes the weekly wage from pay-rate and hours |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (weekly-wageÂ pay-rateÂ hours)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â pay-rateÂ hours))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Stop! Which function do you need to use if you wish to compute the wages for
    one worker? Which function do you need to change if you wish to deal with income
    taxes?
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 388\. In the real world, wages*.v2 consumes lists of employee structures
    and lists of work records. An employee structure contains an employeeâ€™s name,
    social security number, and pay rate. A work record also contains an employeeâ€™s
    name and the number of hours worked in a week. The result is a list of structures
    that contain the name of the employee and the weekly wage.
  prefs: []
  type: TYPE_NORMAL
- en: Modify the program in this section so that it works on these realistic versions
    of data. Provide the necessary structure type definitions and data definitions.
    Use the design recipe to guide the modification process.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 389\. Design the zip function, which consumes a list of names, represented
    as strings, and a list of phone numbers, also strings. It combines those equally
    long lists into a list of phone records:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â phone-recordÂ [nameÂ number])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A PhoneRecord is a structure: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â (make-phone-record  [String](part_one.html#%28tech._string%29)  [String](part_one.html#%28tech._string%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Assume that the corresponding list items belong to the same person.
  prefs: []
  type: TYPE_NORMAL
- en: '23.3Processing Two Lists Simultaneously: Case 3[ğŸ”—](#(part._sec~3atwo-inputs~3acase3)
    "Link to here")'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is a third type of problem:'
  prefs: []
  type: TYPE_NORMAL
- en: Sample Problem Given a list of symbols los and a natural number n, the function
    list-pick extracts the nth symbol from los; if there is no such symbol, it signals
    an error.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The question is how well the recipe works for the design of list-pick.While
    the data definition for a list of symbols is fairly familiar by now, recall the
    class of natural numbers from [Natural Numbers](part_two.html#%28part._sec~3anats%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â N is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  0 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([add1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._add1%29%29)  [N](part_two.html#%28tech._n%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Now we can proceed to the second step:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Symbol](i2-3.html#%28tech._symbol%29)]
    [N](part_two.html#%28tech._n%29) -> [Symbol](i2-3.html#%28tech._symbol%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â extracts the nth symbol from l; |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â signals an error if there is no such symbol |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-pickÂ lÂ n)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ''a) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Both lists of symbols and natural numbers are classes with complex data definitions.
    This combination makes the problem nonstandard, meaning we must pay attention
    to every detail for every step of the design recipe.At this point, we usually
    pick some input examples and figure out what the desired output is. We start with
    inputs for which the function has to work flawlessly: ''(a  b  c) and 2. For a
    list of three symbols and the index 2, list-pick must return a symbol. The question
    is whether it is ''b or ''c. In grade school, you would have counted 1, 2, and
    picked ''b without a first thought. But this is computer science, not grade school.
    Here people start counting from 0, meaning that ''c is an equally appropriate
    choice. And indeed, this is the choice we use:'
  prefs: []
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (list-pickÂ '(aÂ bÂ c)Â 2)Â 'c)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Now that we have eliminated this fine point of list-pick, letâ€™s look at the
    actual problem, the choice of inputs. The goal of the example step is to cover
    the input space as much as possible. We do so by picking one input per clause
    in the description of complex forms of data. Here this procedure suggests we pick
    at least two elements from each class because each data definition has two clauses.
    We choose '() and ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  'a  '())
    for the first argument, and 0 and 3 for the latter. Two choices per argument means
    four examples total; after all, there is no immediately obvious connection between
    the two arguments and no restriction in the signature.
  prefs: []
  type: TYPE_NORMAL
- en: 'As it turns out, only one of these pairings produces a proper result; the remaining
    ones choose a position that does not exist because the list doesnâ€™t contain enough
    symbols:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([check-error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-error%29%29)Â (list-pickÂ ''()Â 0)Â "list
    too short") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (list-pickÂ ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ''aÂ ''())Â 0)Â ''a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-error%29%29)Â (list-pickÂ ''()Â 3)Â "list
    too short") |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The function is expected to signal an error, and we pick our favorite message
    here.
  prefs: []
  type: TYPE_NORMAL
- en: Stop! Put these fragments into DrRacketâ€™s definitions area and run the partial
    program.
  prefs: []
  type: TYPE_NORMAL
- en: 'The discussion on examples indicates that there are indeed four independent
    cases that we must inspect for the design of the function. One way to discover
    these cases is to arrange the conditions for each of the clauses into a two-dimensional
    table:'
  prefs: []
  type: TYPE_NORMAL
- en: '|  |  | ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  l)
    |  | ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)  l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)  n  0)
    |  |  |  |  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)  n  0)
    |  |  |  |  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The horizontal dimension of the table lists those questions that list-pick
    must ask about lists; the vertical dimension lists the questions about natural
    numbers. By this arrangement, we naturally get four squares, where each represents
    the case when both the conditions on the horizontal and the vertical axis are
    true.Our table suggests that the [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    for the function template has four clauses. We can figure out the appropriate
    condition for each of these clauses by [and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)-ing
    the horizontal and vertical condition for each box in the table:'
  prefs: []
  type: TYPE_NORMAL
- en: '|  |  | ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  l)
    |  | ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)  l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)  n  0)
    |  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â l)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)  n  0)
    |  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â l)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    outline of the template is merely a translation of this table into a conditional:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-pickÂ lÂ n)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â l))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â l))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'As always, the [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    expression allows us to distinguish the four possibilities and to focus on each
    individually as we add selector expressions to each [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-pickÂ lÂ n)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â l))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)[...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â l))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The first argument, l, is a list, and a templateâ€™s [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause for non-empty lists contains two selector expressions. The second argument,
    n, belongs to [N](part_two.html#%28tech._n%29), and the templateâ€™s [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause for non-0 numbers needs only one selector expression. In those cases where
    either ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  l)
    or ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)  n  0)
    holds, the respective argument is atomic and there is no need for a corresponding
    selector expression.The final step of the template construction demands that we
    annotate the template with recursions where the results of selector expressions
    belong to the same class as the inputs. For this first example, we focus on the
    last [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause, which contains selector expressions for both arguments. It is, however,
    unclear how to form the natural recursions. If we disregard the purpose of the
    function, there are three possible recursions:'
  prefs: []
  type: TYPE_NORMAL
- en: (list-pick  ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  l)  ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)  n))
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: (list-pick  l  ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)  n))
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: (list-pick  ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  l)  n)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Each one represents a feasible combination of the available expressions. Since
    we cannot know which one matters or whether all three matter, we move on to the
    next development stage.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Symbol](i2-3.html#%28tech._symbol%29)]
    [N](part_two.html#%28tech._n%29) -> [Symbol](i2-3.html#%28tech._symbol%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â extracts the nth symbol from l; |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â signals an error if there is no such symbol |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-pickÂ lÂ n)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â ''list-pickÂ "list
    too short")] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â ''list-pickÂ "list
    too short")] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â l))Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â l))Â (list-pickÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)Â ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 134: Indexing into a list'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Following the design recipe for the fifth step, letâ€™s analyze each [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause in the template and decide what a proper answer is:'
  prefs: []
  type: TYPE_NORMAL
- en: If ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)  ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)  n  0)  ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  l))
    holds, list-pick must pick the first symbol from an empty list, which is impossible.
    The answer must be an error signal.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)  ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)  n  0)  ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  l))
    holds, list-pick is again asked to pick a symbol from an empty list.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)  ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)  n  0)  ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)  l))
    holds, list-pick is supposed to produce the first symbol from l. The selector
    expression ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  l)
    is the answer.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)  ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)  n  0)  ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)  l))
    holds, we must analyze what the available expressions compute. As we have seen,
    it is a good idea to work through an existing example for this step. We pick a
    shortened variant of the first example:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (list-pickÂ '(aÂ b)Â 1)Â 'b)
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Here is what the three natural recursions compute with these values:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: (list-pick  '(b)  0) produces 'b;
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: (list-pick  '(a  b)  0) evaluates to 'a, the wrong answer;
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: and (list-pick  '(b)  1) signals an error.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: From this, we conclude that (list-pick  ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  l)  ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)  n))
    computes the desired answer in the last [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'ExerciseÂ 390\. Design the function tree-pick. The function consumes a tree
    of symbols and a list of directions:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â branchÂ [[left](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29)Â [right](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29)])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A TOS is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  [Symbol](i2-3.html#%28tech._symbol%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-branch  [TOS](#%28tech._to%29)  [TOS](#%28tech._to%29)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Direction is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  [''](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29)[left](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._left%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  [''](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29)[right](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._right%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A list of [Direction](#%28tech._direction%29)s is also called a path. |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Clearly a [Direction](#%28tech._direction%29) tells the function whether to
    choose the left or the right branch in a nonsymbolic tree. What is the result
    of the tree-pick function? Donâ€™t forget to formulate a full signature. The function
    signals an error when given a symbol and a non-empty path.
  prefs: []
  type: TYPE_NORMAL
- en: 23.4Function Simplification[ğŸ”—](#(part._sec~3atwo-inputs~3asimplify) "Link to
    here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The list-pick function in [figureÂ 134](#%28counter._%28figure._fig~3alist-pick%29%29)
    is far more complicated than necessary. The first two [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clauses signal an error. That is, if either
  prefs: []
  type: TYPE_NORMAL
- en: ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alos))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: or
  prefs: []
  type: TYPE_NORMAL
- en: ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alos))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'holds, the answer is an error. We can translate this observation into code:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-pickÂ alosÂ n)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alos))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alos)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â ''list-pickÂ "list
    too short")] |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â alos))Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â alos)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â alos))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â (list-pickÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alos)Â ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: To simplify this function even more, we need to get acquainted with algebraic
    laws concerning Booleans:These equations are known as de Morganâ€™s laws.
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â bexp1Â a-bexp)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â bexp2Â a-bexp))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  | == |  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â bexp1Â bexp2)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â a-bexp) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'A similar law applies when the sub-expressions of the [and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)s
    are swapped. Applying these laws to list-pick yields this:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-pickÂ nÂ alos)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0))Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alos))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â ''list-pickÂ "list
    too short")] |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â alos))Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â alos)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â alos))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â (list-pickÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alos)Â ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Now consider ([or](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._or%29%29)  ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)  n  0)  ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)  n  0)).
    It is always #true because n belongs to [N](part_two.html#%28tech._n%29). Since
    ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)  #true  ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  alos))
    is equivalent to ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  alos),
    we can rewrite the function again:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-pickÂ alosÂ n)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alos)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â ''list-pickÂ "list
    too short")] |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â alos))Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â alos)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)Â alos))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â (list-pickÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alos)Â ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'This last definition is already significantly simpler than the definition in
    [figureÂ 134](#%28counter._%28figure._fig~3alist-pick%29%29), but we can do even
    better than this. Compare the first condition in the latest version of list-pick
    with the second and third. Since the first [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause filters out all those cases when alos is empty, ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)  alos)
    in the last two clauses is always going to evaluate to #true. If we replace the
    condition with #true and simplify the [and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)
    expressions again, we get a three-line version of list-pick'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â list-pick: [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Symbol](i2-3.html#%28tech._symbol%29)]
    [N](part_two.html#%28tech._n%29)[>= 0] -> [Symbol](i2-3.html#%28tech._symbol%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â determines the nth symbol from alos, counting from 0; |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â signals an error if there is no nth symbol |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (list-pickÂ alosÂ n)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alos)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â ''list-pickÂ "list
    too short")] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 0)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â alos)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([>](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3e%29%29)Â nÂ 0)Â (list-pickÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alos)Â ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 135: Indexing into a list, simplified'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 135](#%28counter._%28figure._fig~3alist-pick2%29%29) displays this
    simplified version of list-pick. While it is far simpler than the original, it
    is important to understand that we designed the original in a systematic manner
    and that we were able to transform the first into the second with well-established
    algebraic laws. We can therefore trust this simple version. If we try to find
    the simple versions of functions directly, we sooner or later fail to take care
    of a case in our analysis, and we are guaranteed to produce flawed programs.'
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 391\. Design replace-eol-with using the strategy of [Processing Two
    Lists Simultaneously: Case 3](#%28part._sec~3atwo-inputs~3acase3%29). Start from
    the tests. Simplify the result systematically.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 392\. Simplify the function tree-pick from [exerciseÂ 390](#%28counter._%28exercise._ex~3atree-pick%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: 23.5Designing Functions that Consume Two Complex Inputs[ğŸ”—](#(part._sec~3atwo-inputs~3adesign)
    "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'The proper approach to designing functions of two (or more) complex arguments
    is to follow the general recipe. You must conduct a data analysis and define the
    relevant classes of data. If the use of parametric definitions such as [List-of](part_three.html#%28tech._sim-dd._list._of%29)
    and short-hand examples such as ''(1  b  &) confuses you, expand them so that
    the constructors become explicit. Next you need a function signature and purpose.
    At this point, you can think ahead and decide which of the following three situations
    you are facing:'
  prefs: []
  type: TYPE_NORMAL
- en: If one of the parameters plays a dominant role, think of the other as an atomic
    piece of data as far as the function is concerned.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In some cases the parameters range over the same class of values and must have
    the same size. For example, two lists must have the same length, or two web pages
    must have the same length and where one of them contains an embedded page, the
    other one does, too. If the two parameters have this equal status and the purpose
    suggests that they are processed in a synchronized manner, you choose one parameter,
    organize the function around it, and traverse the other in a parallel manner.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If there is no obvious connection between the two parameters, you must analyze
    all possible cases with examples. Then use this analysis to develop the template,
    especially the recursive parts.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Once you decide that a function falls into the third category, develop a two-dimensional
    table to make sure that no case falls through the cracks. Letâ€™s use a nontrivial
    pair of data definitions to explain this idea again:'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â An LOD is one of: &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  ''() &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  [Direction](#%28tech._direction%29)  [LOD](#%28tech._lod%29))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â A TID is one of: &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  [Symbol](i2-3.html#%28tech._symbol%29) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  (make-binary  [TID](#%28tech._tid%29)  [TID](#%28tech._tid%29))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ;Â â€“  (make-with  [TID](#%28tech._tid%29)  [Symbol](i2-3.html#%28tech._symbol%29)  [TID](#%28tech._tid%29))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The left data definition is the usual list definition; the right one is a three-clause
    variant of [TOS](#%28tech._to%29). It uses two structure type definitions:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â withÂ [lftÂ infoÂ rght])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â binaryÂ [lftÂ rght])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Assuming the function consumes an [LOD](#%28tech._lod%29) and a [TID](#%28tech._tid%29),
    the table that you should come up with has this shape:'
  prefs: []
  type: TYPE_NORMAL
- en: '|  |  | ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  l)
    |  | ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)  l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([symbol?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3f%29%29)  t)
    |  |  |  |  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (binary?  t) |  |  |  |  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (with?  t) |  |  |  |  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Along the horizontal direction we enumerate the conditions that recognize the
    sub-classes for the first parameter, here [LOD](#%28tech._lod%29), and along the
    vertical direction we enumerate the conditions for the second parameter, [TID](#%28tech._tid%29).
  prefs: []
  type: TYPE_NORMAL
- en: The table guides the development of both the function examples and the function
    template. As explained, the examples must cover all possible cases; that is, there
    must be at least one example for each cell in the table. Similarly, the template
    must have one [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause per cell; its condition combines the horizontal and the vertical conditions
    in an [and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)
    expression. Each [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause, in turn, must contain all feasible selector expressions for both parameters.
    If one of the parameters is atomic, there is no need for a selector expression.
    Finally, you need to be aware of the feasible natural recursions. In general,
    all possible combinations of selector expressions (and optionally, atomic arguments)
    are candidates for a natural recursion. Because we canâ€™t know which ones are necessary
    and which ones arenâ€™t, we keep them in mind for the coding step.
  prefs: []
  type: TYPE_NORMAL
- en: In summary, the design of multiparameter functions is just a variation on the
    old design-recipe theme. The key idea is to translate the data definitions into
    a table that shows all feasible and interesting combinations. The development
    of function examples and the template exploit the table as much as possible.
  prefs: []
  type: TYPE_NORMAL
- en: '23.6Finger Exercises: Two Inputs[ğŸ”—](#(part._sec~3atwo-inputs~3aex) "Link to
    here")'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: ExerciseÂ 393\. [FigureÂ 62](part_two.html#%28counter._%28figure._fig~3asets-vs-lists%29%29)
    presents two data definitions for finite sets. Design the union function for the
    representation of finite sets of your choice. It consumes two sets and produces
    one that contains the elements of both.
  prefs: []
  type: TYPE_NORMAL
- en: Design intersect for the same set representation. It consumes two sets and produces
    the set of exactly those elements that occur in both.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 394\. Design merge. The function consumes two lists of numbers, sorted
    in ascending order. It produces a single sorted list of numbers that contains
    all the numbers on both inputs lists. A number occurs in the output as many times
    as it occurs on the two input lists together.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 395\. Design take. It consumes a list l and a natural number n. It
    produces the first n items from l or all of l if it is too short.
  prefs: []
  type: TYPE_NORMAL
- en: Design drop. It consumes a list l and a natural number n. Its result is l with
    the first n items removed or just â€™() if l is too short.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An HM-Word is a [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Letter](part_two.html#%28tech._letter%29)
    or "_"] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â interpretation  "_" represents a letter to be guessed |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [HM-Word](#%28tech._hm._word%29)  [N](part_two.html#%28tech._n%29) -> [String](part_one.html#%28tech._string%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â runs a simplistic hangman game, produces the current state |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (playÂ the-pickÂ time-limit)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â the-wordÂ Â ([explode](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._explode%29%29)Â the-pick))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â the-guessÂ ([make-list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._make-list%29%29)Â (lengthÂ the-word)Â "_"))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [HM-Word](#%28tech._hm._word%29) -> [HM-Word](#%28tech._hm._word%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (do-nothingÂ s)Â s)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [HM-Word](#%28tech._hm._word%29)  [KeyEvent](part_one.html#%28tech._keyevent%29)
    -> [HM-Word](#%28tech._hm._word%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (checked-compareÂ current-statusÂ ke)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29)Â keÂ LETTERS)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (compare-wordÂ the-wordÂ current-statusÂ ke) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â current-status))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([implode](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._implode%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([big-bang](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._big-bang%29%29)Â the-guessÂ ;Â [HM-Word](#%28tech._hm._word%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â [[to-draw](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._to-draw%29%29)Â render-word]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â [[on-tick](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-tick%29%29)Â do-nothingÂ 1Â time-limit]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â [[on-key](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28form._world._%28%28lib._2htdp%2Funiverse..rkt%29._on-key%29%29)Â Â checked-compare]))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [HM-Word](#%28tech._hm._word%29) -> [Image](part_one.html#%28tech._image%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (render-wordÂ w)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([text](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29)Â ([implode](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._implode%29%29)Â w)Â 22Â "black"))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 136: A simple hangman game'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ExerciseÂ 396\. Hangman is a well-known guessing game. One player picks a word,
    the other player gets told how many letters the word contains. The latter picks
    a letter and asks the first player whether and where this letter occurs in the
    chosen word. The game is over after an agreed-upon time or number of rounds.
  prefs: []
  type: TYPE_NORMAL
- en: '[FigureÂ 136](#%28counter._%28figure._fig~3ahangman-game%29%29) presents the
    essence of a time-limited version of the game. See [Local Definitions Add Expressive
    Power](part_three.html#%28part._sec~3alocal-is-power%29) for why checked-compare
    is defined locally.'
  prefs: []
  type: TYPE_NORMAL
- en: The goal of this exercise is to design compare-word, the central function. It
    consumes the word to be guessed, a word s that represents how much/little the
    guessing player has discovered, and the current guess. The function produces s
    with all "_" where the guess revealed a letter.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you have designed the function, run the program like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â LOCATIONÂ "/usr/share/dict/words")Â ;Â on
    OS X |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â AS-LISTÂ ([read-lines](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-lines%29%29)Â LOCATION))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â SIZEÂ (lengthÂ AS-LIST))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (playÂ ([list-ref](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list-ref%29%29)Â AS-LISTÂ ([random](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._random%29%29)Â SIZE))Â 10)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: See [figureÂ 74](part_two.html#%28counter._%28figure._fig~3areading-a-dictionary%29%29)
    for an explanation. Enjoy and refine as desired!
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 397\. In a factory, employees punch time cards as they arrive in the
    morning and leave in the evening. Electronic time cards contain an employee number
    and record the number of hours worked per week. Employee records always contain
    the name of the employee, an employee number, and a pay rate.
  prefs: []
  type: TYPE_NORMAL
- en: Design wages*.v3. The function consumes a list of employee records and a list
    of time-card records. It produces a list of wage records, which contain the name
    and weekly wage of an employee. The function signals an error if it cannot find
    an employee record for a time card or vice versa.
  prefs: []
  type: TYPE_NORMAL
- en: Assumption There is at most one time card per employee number.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 398\. A linear combination is the sum of many linear terms, that is,
    products of variables and numbers. The latter are called coefficients in this
    context. Here are some examples:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ![image](../Images/8011f33851416d69861562711b793baa.png) |  | ![image](../Images/82fcae48076fbe7779c73ed1127d1325.png)
    |  | ![image](../Images/fbfa013108ecd462f2c27da453838ca1.png) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: In all examples, the coefficient of x is 5, that of y is 17, and the one for
    z is 3.
  prefs: []
  type: TYPE_NORMAL
- en: If we are given values for variables, we can determine the value of a polynomial.
    For example, if x = 10, the value of ![image](../Images/eb9294e336c71ad7f96346414bc13f46.png)
    is 50; if x = 10 and y = 1, the value of ![image](../Images/51344006b1331e0c3327482737c9a6ab.png)
    is 67; and if x = 10, y = 1, and z = 2, the value of ![image](../Images/e89265ae8dbca10242330152e6a111ce.png)
    is 73.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are many different representations of linear combinations. We could,
    for example, represent them with functions. An alternative representation is a
    list of its coefficients. The above combinations would be represented as:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 5)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 5Â 17)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 5Â 17Â 3)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: This choice of representation assumes a fixed order of variables.
  prefs: []
  type: TYPE_NORMAL
- en: 'Design value. The function consumes two equally long lists: a linear combination
    and a list of variable values. It produces the value of the combination for these
    values.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 399\. Louise, Jane, Laura, Dana, and Mary decide to run a lottery that
    assigns one gift recipient to each of them. Since Jane is a developer, they ask
    her to write a program that performs this task in an impartial manner. Of course,
    the program must not assign any of the sisters to herself.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the core of Janeâ€™s program:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [String](part_one.html#%28tech._string%29)]
    -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [String](part_one.html#%28tech._string%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â picks a random non-identity arrangement of names |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (gift-pickÂ names)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (random-pick |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (non-sameÂ namesÂ (arrangementsÂ names)))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [String](part_one.html#%28tech._string%29)]
    -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29) [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [String](part_one.html#%28tech._string%29)]]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â returns all possible permutations of names |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â see [exerciseÂ 213](part_two.html#%28counter._%28exercise._ex~3apermutations%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (arrangementsÂ names)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'It consumes a list of names and randomly picks one of those permutations that
    do not agree with the original list at any place.Your task is to design two auxiliary
    functions:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[NEList-of](part_three.html#%28tech._sim-dd._nelist._of%29) X] -> X |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â returns a random item from the list |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (random-pickÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [String](part_one.html#%28tech._string%29)]
    [[List-of](part_three.html#%28tech._sim-dd._list._of%29) [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [String](part_one.html#%28tech._string%29)]]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â -> |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29) [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [String](part_one.html#%28tech._string%29)]]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â produces the list of those lists in ll that do |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â not agree with names at any place |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (non-sameÂ namesÂ ll)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ll) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Recall that [random](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._random%29%29)
    picks a random number; see [exerciseÂ 99](part_one.html#%28counter._mix._%28exercise._mix-ufo-move%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 400\. Design the function DNAprefix. The function takes two arguments,
    both lists of ''a, ''c, ''g, and ''t, symbols that occur in DNA descriptions.
    The first list is called a pattern, the second one a search string. The function
    returns #true if the pattern is identical to the initial part of the search string;
    otherwise it returns #false.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Also design DNAdelta. This function is like DNAprefix but returns the first
    item in the search string beyond the pattern. If the lists are identical and there
    is no DNA letter beyond the pattern, the function signals an error. If the pattern
    does not match the beginning of the search string, it returns #false. The function
    must not traverse either of the lists more than once.'
  prefs: []
  type: TYPE_NORMAL
- en: Can DNAprefix or DNAdelta be simplified?
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 401\. Design sexp=?, a function that determines whether two S-expressions
    are equal. For convenience, here is the data definition in condensed form:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â An S-expr (S-expression) is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  [Atom](#%28tech._atom%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“ [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [S-expr](#%28tech._s._expr%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An Atom is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  [Number](part_one.html#%28tech._number%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  [String](part_one.html#%28tech._string%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  [Symbol](i2-3.html#%28tech._symbol%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Whenever you use [check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29),
    it uses a function like sexp=? to check whether the two arbitrary values are equal.
    If not, the check fails and [check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)
    reports it as such.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 402\. Reread [exerciseÂ 354](#%28counter._%28exercise._ex~3absl-var-eval%29%29).
    Explain the reasoning behind our hint to think of the given expression as an atomic
    value at first.
  prefs: []
  type: TYPE_NORMAL
- en: '23.7Project: Database[ğŸ”—](#(part._db._sec~3aproj-db) "Link to here")'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Many software applications use a database to keep track of data. Roughly speaking,
    a database is a table that comes with an explicitly stated organization rule.
    The former is the content; the latter isThis section pulls together knowledge
    from all four parts of the book. called a schema. [FigureÂ 137](#%28counter._db._%28figure._fig~3adb-tables%29%29)
    shows two examples. Each table consists of two parts: the schema above the line
    and the content below.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Letâ€™s focus on the table on the left. It has three columns and four rows. Each
    column comes with a two-part rule:'
  prefs: []
  type: TYPE_NORMAL
- en: the rule in the left-most column says that the label of the column is â€œNameâ€
    and that every piece of data in this column is a [String](part_one.html#%28tech._string%29);
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: the middle column is labeled â€œAgeâ€ and contains [Integer](part_one.html#%28tech._integer%29)s;
    and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: the label of the right-most one is â€œPresentâ€; its values are [Boolean](part_one.html#%28tech._boolean%29).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Stop! Explain the table on the right in the same way.
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Name &#124;  &#124; Age &#124;  &#124; Present &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; [String](part_one.html#%28tech._string%29) &#124;  &#124; [Integer](part_one.html#%28tech._integer%29)
    &#124;  &#124; [Boolean](part_one.html#%28tech._boolean%29) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Alice" &#124;  &#124; 35 &#124;  &#124; #true &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Bob" &#124;  &#124; 25 &#124;  &#124; #false &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Carol" &#124;  &#124; 30 &#124;  &#124; #true &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Dave" &#124;  &#124; 32 &#124;  &#124; #false &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |  |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Present &#124;  &#124; Description &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; [Boolean](part_one.html#%28tech._boolean%29) &#124;  &#124; [String](part_one.html#%28tech._string%29)
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; #true &#124;  &#124; "presence" &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; #false &#124;  &#124; "absence" &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 137: Databases as tables'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Computer scientists think of these tables as relations. The schema introduces
    terminology to refer to columns of a relation and to individual cells in a row.
    Each row relates a fixed number of values; the collection of all rows makes up
    the entire relation. In this terminology, the first row of the left table in [figureÂ 137](#%28counter._db._%28figure._fig~3adb-tables%29%29)
    relates "Alice" to 35 and #true. Furthermore, the first cell of a row is called
    the â€œNameâ€ cell, the second the â€œAgeâ€ cell, and the third one the â€œPresentâ€ cell.'
  prefs: []
  type: TYPE_NORMAL
- en: 'In this section, we represent databases via structures and lists:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â dbÂ [schemaÂ content])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A DB is a structure: (make-db  [Schema](#%28tech._db._schema%29)  [Content](#%28tech._db._content%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Schema is a [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Spec](#%28tech._db._spec%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Spec is a [[List](part_three.html#%28tech._sim-dd._list%29)  [Label](#%28tech._db._label%29)  [Predicate](#%28tech._db._predicate%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Label is a [String](part_one.html#%28tech._string%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Predicate is a [[Any](part_one.html#%28tech._any%29) -> [Boolean](part_one.html#%28tech._boolean%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A (piece of) Content is a [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Row](#%28tech._db._row%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Row is a [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Cell](#%28tech._db._cell%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Cell is [Any](part_one.html#%28tech._any%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â constraint cells do not contain functions |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â integrity constraint In (make-db  sch  con), |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â for every row in con, |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â (I1) its length is the same as sch''s, and |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â (I2) its ith [Cell](#%28tech._db._cell%29) satisfies the ith [Predicate](#%28tech._db._predicate%29)
    in sch |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Stop! Translate the databases from [figureÂ 137](#%28counter._db._%28figure._fig~3adb-tables%29%29)
    into the chosen data representation. Note that the content of the tables already
    uses ISL+ data.
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â school-schema
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â `(("Name"Â Â Â Â ,[string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â ("Age"Â Â Â Â Â ,[integer?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._integer~3f%29%29))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â ("Present"Â ,[boolean?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29))))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |  |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â presence-schema
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â `(("Present"Â Â Â Â Â ,[boolean?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â ("Description"Â ,[string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29))))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |  |  |  |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â school-content
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â `(("Alice"Â 35Â #true) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â ("Bob"Â Â Â 25Â #false) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â ("Carol"Â 30Â #true) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â ("Dave"Â Â 32Â #false))) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |  |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â presence-content
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â `((#trueÂ Â "presence") &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (#falseÂ "absence"))) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |  |  |  |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â school-db
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â (make-dbÂ school-schema &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â Â Â school-content)) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |  |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â presence-db
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â (make-dbÂ presence-schema &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â Â Â presence-content)) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 138: Databases as ISL+ data'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 138](#%28counter._db._%28figure._fig~3adb-isl%29%29) shows how to represent
    the two tables in [figureÂ 137](#%28counter._db._%28figure._fig~3adb-tables%29%29)
    as [DB](#%28tech._db._db%29)s. Its left-hand side represents the schema, the content,
    and the database from the left-hand side table in [figureÂ 137](#%28counter._db._%28figure._fig~3adb-tables%29%29);
    its right part corresponds to the right-hand side table. For succinctness, the
    examples use the [quasiquote](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quasiquote%29%29)
    and [unquote](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._unquote%29%29)
    notation. Recall that it allows the inclusion of a value such as [boolean?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29)
    in an otherwise quoted list. If you feel uncomfortable with this notation, reformulate
    these examples with [list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29).'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 403\. A [Spec](#%28tech._db._spec%29) combines a [Label](#%28tech._db._label%29)
    and a [Predicate](#%28tech._db._predicate%29) into a list. While acceptable, this
    choice violates our guideline of using a structure type for a fixed number of
    pieces of information.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is an alternative data representation:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â specÂ [labelÂ predicate])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Spec is a structure: (make-spec  [Label](#%28tech._db._label%29)  [Predicate](#%28tech._db._predicate%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Use this alternative definition to represent the databases from [figureÂ 137](#%28counter._db._%28figure._fig~3adb-tables%29%29).Integrity
    Checking The use of databases critically relies on their integrity. Here â€œintegrityâ€
    refers to the constraints (I1) and (I2) from the data definition. Checking database
    integrity is clearly a task for a function:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [DB](#%28tech._db._db%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â do all rows in db satisfy (I1) and (I2) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (integrity-checkÂ school-db)Â #true)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (integrity-checkÂ presence-db)Â #true)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (integrity-checkÂ db)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â #false) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The wording of the two constraints suggests that some function has to produce
    #true for every row in the content of the given database. Expressing this idea
    in code calls for a use of [andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)
    on the content of db:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (integrity-checkÂ db)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [Row](#%28tech._db._row%29)
    -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-integrity-checkÂ row)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)Â row-integrity-checkÂ (db-contentÂ db))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Following the design recipe for the use of existing abstractions, the template
    introduces the auxiliary function via a [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    definition.The design of row-integrity-check starts from this:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Row](#%28tech._db._row%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â does row satisfy (I1) and (I2) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-integrity-checkÂ row)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â #false) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'As always, the goal of formulating a purpose statement is to understand the
    problem. Here it says that the function checks two conditions. When two tasks
    are involved, our design guidelines call for functions and the combination of
    their results:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â (length-of-row-checkÂ row)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â (check-every-cellÂ row)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Add these functions to your wish list; their names convey their purpose.Before
    we design these functions, we must contemplate whether we can compose existing
    primitive operations to compute the desired value. For example, we know that (length  row)
    counts how many cells are in row. Pushing a bit more in this direction, we clearly
    want
  prefs: []
  type: TYPE_NORMAL
- en: ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â (lengthÂ row)Â (lengthÂ (db-schemaÂ db)))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'This condition checks that the length of row is equal to that of dbâ€™s schema.Similarly,
    check-every-cell calls for checking that some function produces #true for every
    cell in the row. Once again, it looks like [andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)
    might be called for:'
  prefs: []
  type: TYPE_NORMAL
- en: ([andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)Â cell-integrity-checkÂ row)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The purpose of cell-integrity-check is obviously to check constraint (I2), that
    is,
  prefs: []
  type: TYPE_NORMAL
- en: whether â€œthe ith [Cell](#%28tech._db._cell%29) satisfies the ith [Predicate](#%28tech._db._predicate%29)
    in dbâ€™s schema.â€
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: And now we are stuck because this purpose statement refers to the relative position
    of the given cell in row. The point of [andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)
    is, however, to apply cell-integrity-check to every cell uniformly.When you are
    stuck, you must work through examples. For auxiliary or [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    functions, itâ€™s best to derive these examples from the ones for the main function.
    The first example for integrity-check asserts that school-content satisfies the
    integrity constraints. Clearly all rows in school-content have the same length
    as school-schema. The question is why a row such as
  prefs: []
  type: TYPE_NORMAL
- en: ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â "Alice"Â 35Â #true)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'satisfies the predicates in the corresponding schema:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â "Name"Â Â Â Â [string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â "Age"Â Â Â Â Â [integer?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._integer~3f%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â "Present"Â [boolean?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The answer is that all three applications of the three predicates to the respective
    cells yields true:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > ([string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29)Â "Alice")
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| #true |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ([integer?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._integer~3f%29%29)Â 35)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| #true |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ([boolean?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29)Â #true)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| #true |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: From here, it is just a short step to see that the function must process these
    two listsâ€”<wbr>dbâ€™s schema and the given rowâ€”<wbr>in parallel.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 404\. Design the function andmap2. It consumes a function f from two
    values to [Boolean](part_one.html#%28tech._boolean%29) and two equally long lists.
    Its result is also a [Boolean](part_one.html#%28tech._boolean%29). Specifically,
    it applies f to pairs of corresponding values from the two lists, and if f always
    produces #true, andmap2 produces #true, too. Otherwise, andmap2 produces #false.
    In short, andmap2 is like [andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)
    but for two lists.'
  prefs: []
  type: TYPE_NORMAL
- en: Stop! Solve [exerciseÂ 404](#%28counter._db._%28exercise._ex~3aandmap2%29%29)
    before reading on.
  prefs: []
  type: TYPE_NORMAL
- en: 'If we had andmap2 in ISL+, checking the second condition on row would be straightforward:'
  prefs: []
  type: TYPE_NORMAL
- en: '| (andmap2Â ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)Â (sÂ c)Â [([second](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29)Â s)Â c])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â (db-schemaÂ db) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â row) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The given function consumes a [Spec](#%28tech._db._spec%29) s from dbâ€™s schema,
    extracts the predicate in the second position, and applies it to the given [Cell](#%28tech._db._cell%29)
    c. Whatever the predicate returns is the result of the [lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)
    function.
  prefs: []
  type: TYPE_NORMAL
- en: Stop again! Explain [([second](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29)  s)  c].
  prefs: []
  type: TYPE_NORMAL
- en: 'As it turns out, [andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)
    in ISL+ is already like andmap2:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (integrity-checkÂ db)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [Row](#%28tech._db._row%29)
    -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â does row satisfy (I1) and (I2) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-integrity-checkÂ row)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â (lengthÂ row)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (lengthÂ (db-schemaÂ db))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)Â ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)Â (sÂ c)Â [([second](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29)Â s)Â c])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (db-schemaÂ db) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â row)))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)Â row-integrity-checkÂ (db-contentÂ db))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Stop a last time! Develop a test for which integrity-check must fail.
  prefs: []
  type: TYPE_NORMAL
- en: 'Note on Expression Hoisting Our definition of integrity-check suffers from
    several problems, some visible, some invisible. Clearly, the function extracts
    dbâ€™s schema twice. With the existing [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    definition it is possible to introduce a definition and avoid this duplication:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (integrity-check.v2Â db)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â schemaÂ (db-schemaÂ db))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Row](#%28tech._db._row%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â does row satisfy (I1) and (I2) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-integrity-checkÂ row)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â (lengthÂ row)Â (lengthÂ schema))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)Â ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)Â (sÂ c)Â [([second](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29)Â s)Â c])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â schema |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â row)))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)Â row-integrity-checkÂ (db-contentÂ db))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: We know from [Local Definitions](part_three.html#%28part._sec~3alocal-definitions%29)
    that lifting such an expression may shorten the time needed to run the integrity
    check. Like the definition of inf in [figureÂ 100](part_three.html#%28counter._%28figure._fig~3alocal-performance%29%29),
    the original version of integrity-check extracts the schema from db for every
    single row, even though it obviously stays the same.
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (integrity-check.v3Â db)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â schemaÂ Â (db-schemaÂ db))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (db-contentÂ db))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â widthÂ Â Â (lengthÂ schema))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Row](#%28tech._db._row%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â does row satisfy (I1) and (I2) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-integrity-checkÂ row)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([and](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._and%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â (lengthÂ row)Â width)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)Â ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)Â (sÂ c)Â [([second](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29)Â s)Â c])
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â schema |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â row)))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([andmap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._andmap%29%29)Â row-integrity-checkÂ content)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 139: The result of systematic expression hoisting'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Terminology Computer scientists speak of â€œhoisting an expression.â€ In a similar
    vein, the row-integrity-check function determines the length of dbâ€™s schema every
    single time it is called. The result is always the same. Hence, if we are interested
    in improving the performance of this function, we can use a [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    definition to name the width of the database content once and for all. [FigureÂ 139](#%28counter._db._%28figure._fig~3ahoisted%29%29)
    displays the result of hoisting (length  schema) out of the row-integrity-check.
    For readability, this final definition also names the content field of db. End
  prefs: []
  type: TYPE_NORMAL
- en: 'Projections and Selections Programs need to extract data from databases. One
    kind of extraction is to select content, which is explained in [Real-World Data:
    iTunes](part_two.html#%28part._itunes-data._sec~3aitunes%29). The other kind of
    extraction produces a reduced database; it is dubbed projection. More specifically,
    a projection constructs a database by retaining only certain columns from a given
    database.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The description of a projection suggests the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [DB](#%28tech._db._db%29) [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Label](#%28tech._db._label%29)]
    -> [DB](#%28tech._db._db%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â retains a column from db if its label is in labels |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (projectÂ dbÂ labels)Â (make-dbÂ ''()Â ''()))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Given the complexity of a projection, it is best to work through an example
    first. Say we wish to eliminate the age column from the database on the left in
    [figureÂ 137](#%28counter._db._%28figure._fig~3adb-tables%29%29). Here is what
    this transformation looks like in terms of tables:'
  prefs: []
  type: TYPE_NORMAL
- en: '| the original database |  | ... eliminating the â€œAgeâ€ column |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Name &#124;  &#124; Age &#124;  &#124; Present &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; [String](part_one.html#%28tech._string%29) &#124;  &#124; [Integer](part_one.html#%28tech._integer%29)
    &#124;  &#124; [Boolean](part_one.html#%28tech._boolean%29) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Alice" &#124;  &#124; 35 &#124;  &#124; #true &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Bob" &#124;  &#124; 25 &#124;  &#124; #false &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Carol" &#124;  &#124; 30 &#124;  &#124; #true &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Dave" &#124;  &#124; 32 &#124;  &#124; #false &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Name &#124;  &#124; Present &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; [String](part_one.html#%28tech._string%29) &#124;  &#124; [Boolean](part_one.html#%28tech._boolean%29)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Alice" &#124;  &#124; #true &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Bob" &#124;  &#124; #false &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Carol" &#124;  &#124; #true &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Dave" &#124;  &#124; #false &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'A natural way to articulate the example as a test reuses [figureÂ 138](#%28counter._db._%28figure._fig~3adb-isl%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â projected-content
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â `(("Alice"Â #true) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ("Bob"Â Â Â #false) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ("Carol"Â #true) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ("Dave"Â Â #false))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â projected-schema
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â `(("Name"Â ,[string?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3f%29%29))Â ("Present"Â ,[boolean?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._boolean~3f%29%29))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â projected-db
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (make-dbÂ projected-schemaÂ projected-content)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â  Stop! Read this test carefully. What''s wrong? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (projectÂ school-dbÂ ''("Name"Â "Present"))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â projected-db) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (projectÂ dbÂ labels)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â schemaÂ Â (db-schemaÂ db))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (db-contentÂ db))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Spec](#%28tech._db._spec%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â does this spec belong to the new schema |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (keep?Â c)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Row](#%28tech._db._row%29) -> [Row](#%28tech._db._row%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â retains those columns whose name is in labels |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-projectÂ row)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (make-dbÂ ([filter](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29)Â keep?Â schema)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â row-projectÂ content))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 140: A template for project'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: If you fill in the above template and run the code in DrRacket, you get the
    error message
  prefs: []
  type: TYPE_NORMAL
- en: first argument of equality cannot be a function
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'before DrRacket can even figure out whether the test succeeds. Recall from
    [Functions Are Values](part_three.html#%28part._sec~3afunctions-as-values%29)
    that functions are infinitely large objects and it is impossible to ensure that
    two functions always produce the same result when applied to the same arguments.
    We therefore weaken the test case:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (db-contentÂ (projectÂ school-dbÂ ''("Name"Â "Present"))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â projected-content) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'For the template, we again reuse existing abstractions; see [figureÂ 140](#%28counter._db._%28figure._fig~3aproject-template%29%29).
    The [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    expression defines two functions: one for use with [filter](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29)
    for narrowing down the schema of the given database and the other for use with
    [map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)
    for thinning out the content. In addition, the function again extracts and names
    the schema and the content from the given database.'
  prefs: []
  type: TYPE_NORMAL
- en: Before we turn to the wish list, letâ€™s step back and study the decision to go
    with two reuses of existing abstraction. The signature tells us that the function
    consumes a structure and produces an element of [DB](#%28tech._db._db%29), so
  prefs: []
  type: TYPE_NORMAL
- en: '| ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â schemaÂ (db-schemaÂ db))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (db-contentÂ db)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (make-dbÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â schemaÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â contentÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'is clearly called for. It is also straightforward to see that the new schema
    is created from the old schema and the new content from the old content. Furthermore,
    the purpose statement of project calls for the retention of only those labels
    that are mentioned in the second argument. Hence, the [filter](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29)
    function correctly narrows down the given schema. In contrast, the rows per se
    stay except that each of them loses some cells. Thus, [map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)
    is the proper way of processing content.Now we can turn to the design of the two
    auxiliary functions. The design of keep? is straightforward. Here is the complete
    definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Spec](#%28tech._db._spec%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â does this spec belong to the new schema |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (keep?Â c)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â c)Â labels))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The function is applied to a [Spec](#%28tech._db._spec%29), which combines
    a [Label](#%28tech._db._label%29) and a [Predicate](#%28tech._db._predicate%29)
    in a list. If the former belongs to labels, the given [Spec](#%28tech._db._spec%29)
    is kept.For the design of row-project, the goal is to keep those [Cell](#%28tech._db._cell%29)s
    in each [Row](#%28tech._db._row%29) of content whose name is a member of the given
    labels. Letâ€™s work through the above example. The four rows are:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â "Alice"Â 35Â #true)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â "Bob"Â Â Â 25Â #false)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â "Carol"Â 30Â #true)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â "Dave"Â Â 32Â #false)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Each of these rows is as long as school-schema:'
  prefs: []
  type: TYPE_NORMAL
- en: ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â "Name"Â "Age"Â "Present")
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The names in the schema determine the names of the cells in the given rows.
    Hence, row-project must keep the first and third cell of each row because it is
    their names that are in the given labels.Since [Row](#%28tech._db._row%29) is
    defined recursively, this matching process between the content of the [Cell](#%28tech._db._cell%29)s
    and their names calls for a recursive helper function that row-project can apply
    to the content and the labels of the cells. Letâ€™s specify it as a wish:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Row](#%28tech._db._row%29) [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Label](#%28tech._db._label%29)]
    -> [Row](#%28tech._db._row%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â retains those cells whose corresponding element |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â in names is also in labels |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-filterÂ rowÂ names)Â ''())
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Using this wish, row-project is a one-liner:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-projectÂ row)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (row-filterÂ rowÂ ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â [first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â schema)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The [map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)
    expression extracts the names of the cells, and those names are handed to row-filter
    to extract the matching cells.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 405\. Design the function row-filter. Construct examples for row-filter
    from the examples for project.
  prefs: []
  type: TYPE_NORMAL
- en: Assumption The given database passes an integrity check, meaning each row is
    as long as the schema and thus its list of names.
  prefs: []
  type: TYPE_NORMAL
- en: '[FigureÂ 141](#%28counter._db._%28figure._fig~3adb-project%29%29) puts all the
    pieces together. The function project has the suffix .v1 because it calls for
    some improvement. The following exercises ask you to implement some of those.'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (project.v1Â dbÂ labels)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â schemaÂ Â (db-schemaÂ db))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (db-contentÂ db))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Spec](#%28tech._db._spec%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â does this column belong to the new schema |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (keep?Â c)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â c)Â labels))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Row](#%28tech._db._row%29) -> [Row](#%28tech._db._row%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â retains those columns whose name is in labels |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-projectÂ row)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â (row-filterÂ rowÂ ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â [first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â schema)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Row](#%28tech._db._row%29) [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Label](#%28tech._db._label%29)]
    -> [Row](#%28tech._db._row%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â retains those cells whose name is in labels |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-filterÂ rowÂ names)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â names)Â ''()]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â names)Â labels)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â row)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (row-filterÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â row)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â names)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (row-filterÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â row)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â names)))])))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (make-dbÂ ([filter](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29)Â keep?Â schema)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â row-projectÂ content))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 141: Database projection'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ExerciseÂ 406\. The row-project function recomputes the labels for every row
    of the databaseâ€™s content. Does the result differ from function call to function
    call? If not, hoist the expression.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 407\. Redesign row-filter using [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29).
    Once you have done so, you may merge row-project and row-filter into a single
    function. Hint The [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)
    function in ISL+ may consume two lists and process them in parallel.
  prefs: []
  type: TYPE_NORMAL
- en: The final observation is that row-project checks the membership of a label in
    labels for every single cell. For the cells of the same column in different rows,
    the result is going to be the same. Hence it also makes sense to hoist this computation
    out of the function.
  prefs: []
  type: TYPE_NORMAL
- en: This form of hoisting is somewhat more difficult than plain expression hoisting.
    We basically wish to pre-compute the result of
  prefs: []
  type: TYPE_NORMAL
- en: ([member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29)Â labelÂ labels)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'for all rows and pass the results into the function instead of the list of
    labels. That is, we replace the list of labels with a list of [Boolean](part_one.html#%28tech._boolean%29)s
    that indicate whether the cell in the corresponding position is to be kept. Fortunately,
    computing those [Boolean](part_one.html#%28tech._boolean%29)s is just another
    application of keep? on the schema:'
  prefs: []
  type: TYPE_NORMAL
- en: ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â keep?Â schema)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Instead of keeping some [Spec](#%28tech._db._spec%29)s from the given schema
    and throwing away the others, this expression just collects the decisions.
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (projectÂ dbÂ labels)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â schemaÂ Â (db-schemaÂ db))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â contentÂ (db-contentÂ db))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Spec](#%28tech._db._spec%29) -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â does this column belong to the new schema |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (keep?Â c)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â c)Â labels))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â [Row](#%28tech._db._row%29) -> [Row](#%28tech._db._row%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â retains those columns whose name is in labels |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (row-projectÂ row)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)Â (cellÂ mÂ c)Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â mÂ ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â cellÂ c)Â c))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ''() |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â row |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â mask)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â maskÂ ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â keep?Â schema)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (make-dbÂ ([filter](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29)Â keep?Â schema)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â ([map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)Â row-projectÂ content))))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 142: Database projection'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 142](#%28counter._db._%28figure._fig~3adb-project2%29%29) shows the
    final version of project and integrates the solutions for the preceding exercises.
    It also uses [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    to extract and name schema and content, plus keep? for checking whether the label
    in some [Spec](#%28tech._db._spec%29) is worth keeping. The remaining two definitions
    introduce mask, which stands for the list of [Boolean](part_one.html#%28tech._boolean%29)s
    discussed above, and the revised version of row-project. The latter uses [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)
    to process the given row and mask in parallel.'
  prefs: []
  type: TYPE_NORMAL
- en: Compare this revised definition of project with project.v1 in [figureÂ 141](#%28counter._db._%28figure._fig~3adb-project%29%29).
    The final definition is both simpler and faster than the original version. Systematic
    design combined with careful revisions pays off; test suites ensure that revisions
    donâ€™t mess up the functionality of the program.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 408\. Design the function select. It consumes a database, a list of
    labels, and a predicate on rows. The result is a list of rows that satisfy the
    given predicate, projected down to the given set of labels.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 409\. Design reorder. The function consumes a database db and list
    lol of [Label](#%28tech._db._label%29)s. It produces a database like db but with
    its columns reordered according to lol. Hint Read up on [list-ref](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list-ref%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: At first assume that lol consists exactly of the labels of dbâ€™s columns. Once
    you have completed the design, study what has to be changed if lol contains fewer
    labels than there are columns and strings that are not labels of a column in db.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 410\. Design the function db-union, which consumes two databases with
    the exact same schema and produces a new database with this schema and the joint
    content of both. The function must eliminate rows with the exact same content.
  prefs: []
  type: TYPE_NORMAL
- en: Assume that the schemas agree on the predicates for each column.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 411\. Design join, a function that consumes two databases: db-1 and
    db-2. The schema of db-2 starts with the exact same [Spec](#%28tech._db._spec%29)
    that the schema of db-1 ends in. The function creates a database from db-1 by
    replacing the last cell in each row with the translation of the cell in db-2.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is an example. Take the databases in [figureÂ 137](#%28counter._db._%28figure._fig~3adb-tables%29%29).
    The two satisfy the assumption of these exercises, that is, the last [Spec](#%28tech._db._spec%29)
    in the schema of the first is equal to the first [Spec](#%28tech._db._spec%29)
    of the second. Hence it is possible to join them:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Name |  | Age |  | Description |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| [String](part_one.html#%28tech._string%29) |  | [Integer](part_one.html#%28tech._integer%29)
    |  | [String](part_one.html#%28tech._string%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Alice" |  | 35 |  | "presence" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Bob" |  | 25 |  | "absence" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Carol" |  | 30 |  | "presence" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Dave" |  | 32 |  | "absence" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Its translation maps #true to "presence" and #false to "absence".'
  prefs: []
  type: TYPE_NORMAL
- en: Hints (1) In general, the second database may â€œtranslateâ€ a cell to a row of
    values, not just one value. Modify the example by adding additional terms to the
    row for "presence" and "absence".
  prefs: []
  type: TYPE_NORMAL
- en: '(2) It may also â€œtranslateâ€ a cell to several rows, in which case the process
    adds several rows to the new database. Here is a second example, a slightly different
    pair of databases from those in [figureÂ 137](#%28counter._db._%28figure._fig~3adb-tables%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Name &#124;  &#124; Age &#124;  &#124; Present &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; [String](part_one.html#%28tech._string%29) &#124;  &#124; [Integer](part_one.html#%28tech._integer%29)
    &#124;  &#124; [Boolean](part_one.html#%28tech._boolean%29) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Alice" &#124;  &#124; 35 &#124;  &#124; #true &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Bob" &#124;  &#124; 25 &#124;  &#124; #false &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Carol" &#124;  &#124; 30 &#124;  &#124; #true &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; "Dave" &#124;  &#124; 32 &#124;  &#124; #false &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |  |  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Present &#124;  &#124; Description &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; [Boolean](part_one.html#%28tech._boolean%29) &#124;  &#124; [String](part_one.html#%28tech._string%29)
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; #true &#124;  &#124; "presence" &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; #true &#124;  &#124; "here" &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; #false &#124;  &#124; "absence" &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; #false &#124;  &#124; "there" &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Joining the left database with the one on the right yields a database with
    eight rows:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Name |  | Age |  | Description |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| [String](part_one.html#%28tech._string%29) |  | [Integer](part_one.html#%28tech._integer%29)
    |  | [String](part_one.html#%28tech._string%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Alice" |  | 35 |  | "presence" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Alice" |  | 35 |  | "here" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Bob" |  | 25 |  | "absence" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Bob" |  | 25 |  | "there" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Carol" |  | 30 |  | "presence" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Carol" |  | 30 |  | "here" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Dave" |  | 32 |  | "absence" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| "Dave" |  | 32 |  | "there" |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: (3) Use iterative refinement to solve the problem. For the first iteration,
    assume that a â€œtranslationâ€ finds only one row per cell. For the second one, drop
    the assumption.
  prefs: []
  type: TYPE_NORMAL
- en: Note on Assumptions This exercise and the entire section mostly rely on informally
    stated assumptions about the given databases. Here, the design of join assumes
    that â€œthe schema of db-2 starts with the exact same [Spec](#%28tech._db._spec%29)
    that the schema of db-1 ends in.â€ In reality, database functions must be checked
    functions in the spirit of [Input Errors](part_one.html#%28part._sec~3ainput-errors%29).
    Designing checked-join would be impossible for you, however. A comparison of the
    last [Spec](#%28tech._db._spec%29) in the schema of db-1 with the first one in
    db-2 calls for a comparison of functions. For practical solutions, see a text
    on databases.
  prefs: []
  type: TYPE_NORMAL
- en: 24Summary[ğŸ”—](#(part._ch~3asummary4) "Link to here")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This fourth part of the book is about the design of functions that process
    data whose description requires many intertwined definitions. These forms of data
    show up everywhere in the real world, from your computerâ€™s local file system to
    the world wide web and geometric shapes used in animated movies. After working
    through this part of the book carefully, you know that the design recipe scales
    to these forms of data, too:'
  prefs: []
  type: TYPE_NORMAL
- en: When the description of program data calls for several mutually referential
    data definitions, the design recipe calls for the simultaneous development of
    templates, one per data definition. If a data definition A refers to a data definition
    B, then the template function-for-A refers to function-for-B in the exact same
    place and manner. Otherwise the design recipes work as before, function for function.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When a function has to process two types of complex data, you need to distinguish
    three cases. First, the function may deal with one of the arguments as if it were
    atomic. Second, the two arguments are expected to have the exact same structure,
    and the function traverses them in a completely parallel manner. Third, the function
    may have to deal with all possible combinations separately. In this case, you
    make a two-dimensional table that along one dimension enumerates all kinds of
    data from one data definition and along the other one deals with the second kind
    of data. Finally you use the tableâ€™s cells to formulate conditions and answers
    for the various cases.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This part of the book deals with functions on two complex arguments. If you
    ever encounter one of those rare cases where a function receives three complex
    pieces of data, you know you need (to imagine) a three-dimensional table.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: You have now seen all forms of structural data that you are likely to encounter
    over the course of your career, though the details will differ. If you are ever
    stuck, remember the design recipe; it will get you started.
  prefs: []
  type: TYPE_NORMAL
