- en: Update operations
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更新操作
- en: 原文：[https://rust-exercises.com/100-exercises/07_threads/10_patch.html](https://rust-exercises.com/100-exercises/07_threads/10_patch.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://rust-exercises.com/100-exercises/07_threads/10_patch.html](https://rust-exercises.com/100-exercises/07_threads/10_patch.html)
- en: So far we've implemented only insertion and retrieval operations.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们只实现了插入和检索操作。
- en: Let's see how we can expand the system to provide an update operation.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看我们如何扩展系统以提供更新操作。
- en: '[Legacy updates](#legacy-updates)'
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[遗留更新](#legacy-updates)'
- en: 'In the non-threaded version of the system, updates were fairly straightforward:
    `TicketStore` exposed a `get_mut` method that allowed the caller to obtain a mutable
    reference to a ticket, and then modify it.'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在系统的非线程版本中，更新操作相当直接：`TicketStore`公开了一个`get_mut`方法，允许调用者获取一个对票证的可变引用，然后对其进行修改。
- en: '[Multithreaded updates](#multithreaded-updates)'
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[多线程更新](#multithreaded-updates)'
- en: 'The same strategy won''t work in the current multithreaded version. The borrow
    checker would stop us: `SyncSender<&mut Ticket>` isn''t `''static` because `&mut
    Ticket` doesn''t satisfy the `''static` lifetime, therefore they can''t be captured
    by the closure that gets passed to `std::thread::spawn`.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在当前的多线程版本中，相同的策略将不起作用。借用检查器会阻止我们：`SyncSender<&mut Ticket>`不是`'static`，因为`&mut
    Ticket`不满足`'static`生命周期，因此它们不能被传递给`std::thread::spawn`的闭包捕获。
- en: There are a few ways to work around this limitation. We'll explore a few of
    them in the following exercises.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种方法可以绕过这个限制。我们将在接下来的练习中探讨其中的一些。
- en: '[Patching](#patching)'
  id: totrans-9
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[修补](#patching)'
- en: We can't send a `&mut Ticket` over a channel, therefore we can't mutate on the
    client-side.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不能通过通道发送一个`&mut Ticket`，因此我们无法在客户端进行修改。
- en: Can we mutate on the server-side?
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们能否在服务器端进行修改？
- en: 'We can, if we tell the server what needs to be changed. In other words, if
    we send a **patch** to the server:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们告诉服务器需要更改的内容，我们就可以这样做。换句话说，如果我们向服务器发送一个**补丁**：
- en: '[PRE0]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The `id` field is mandatory, since it's required to identify the ticket that
    needs to be updated.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '`id`字段是必需的，因为它需要用来识别需要更新的票证。'
- en: 'All other fields are optional:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 所有其他字段都是可选的：
- en: If a field is `None`, it means that the field should not be changed.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果一个字段是`None`，这意味着该字段不应被更改。
- en: If a field is `Some(value)`, it means that the field should be changed to `value`.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果一个字段是`Some(value)`，这意味着该字段应更改为`value`。
- en: '[Exercise](#exercise)'
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[练习](#exercise)'
- en: The exercise for this section is located in [`07_threads/10_patch`](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/07_threads/10_patch)
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 本节的练习位于[`07_threads/10_patch`](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/07_threads/10_patch)
