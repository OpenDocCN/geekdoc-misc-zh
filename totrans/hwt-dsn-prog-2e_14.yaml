- en: VIÂ AccumulatorsğŸ”—
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: åŸæ–‡ï¼š[https://htdp.org/2024-11-6/Book/part_six.html](https://htdp.org/2024-11-6/Book/part_six.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Â Â Â Â [31Â The Loss of Knowledge](#%28part._ch~3aaccumulator-samples%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [31.1Â A Problem with Structural Processing](#%28part._sec~3aloss~3astructural%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [31.2Â A Problem with Generative Recursion](#%28part._sec~3aloss~3agenerative%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â [32Â Designing Accumulator-Style Functions](#%28part._sec~3adesign-accu%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [32.1Â Recognizing the Need for an Accumulator](#%28part._sec~3aneed-accu%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [32.2Â Adding Accumulators](#%28part._sec~3aaccu-style%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [32.3Â Transforming Functions into Accumulator Style](#%28part._sec~3atrans-accu%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [32.4Â A Graphical Editor, with Mouse](#%28part._accu-edit._sec~3aedit3%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â [33Â More Uses of Accumulation](#%28part._ch~3amore-accu%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [33.1Â Accumulators and Trees](#%28part._sec~3amore-accu-trees%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [33.2Â Data Representations with Accumulators](#%28part._sec~3amore-accu-mc%29)
    |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [33.3Â Accumulators as Results](#%28part._sec~3afractal-acc%29) |'
  prefs: []
  type: TYPE_TB
- en: '| Â Â Â Â [34Â Summary](#%28part._ch~3asummary6%29) |'
  prefs: []
  type: TYPE_TB
- en: When you ask ISL+ to apply some function f to an argument a, you usually get
    some value v. If you evaluate (f  a) again, you get v again. As a matter of fact,
    you get v no matter how often you request the evaluation of (f  a).The function
    application may also loop forever or signal an error, but we ignore these possibilities.
    We also ignore random, which is the true exception to this rule. Whether the function
    is applied for the first time or the hundredth time, whether the application is
    located in DrRacketâ€™s interactions area or inside the function itself, doesnâ€™t
    matter. The function works according to its purpose statement, and thatâ€™s all
    you need to know.
  prefs: []
  type: TYPE_NORMAL
- en: This principle of context-independence plays a critical role in the design of
    recursive functions. When it comes to design, you are free to assume that the
    function computes what the purpose statement promisesâ€”<wbr>even if the function
    isnâ€™t defined yet. In particular, you are free to use the results of recursive
    calls to create the code of some function, usually in one of its cond clauses.
    The template and coding steps of the design recipes for both structurally and
    generative-recursive functions rely on this idea.
  prefs: []
  type: TYPE_NORMAL
- en: While context-independence facilitates the design of functions, it causes two
    problems. In general, context-independence induces a loss of knowledge during
    a recursive evaluation; a function does not â€œknowâ€ whether it is called on a complete
    list or on a piece of that list. For structurally recursive programs, this loss
    of knowledge means that they may have to traverse data more than once, inducing
    a performance cost. For functions that employ generative recursion, the loss means
    that the function may not be able to compute the result at all. The preceding
    part illustrates this second problem with a graph traversal function that cannot
    find a path between two nodes for a circular graph.
  prefs: []
  type: TYPE_NORMAL
- en: This part introduces a variant of the design recipes to address this â€œloss of
    contextâ€ problem. Since we wish to retain the principle that (f  a) returns the
    same result no matter how often or where it is evaluated, the only solution is
    to add an argument that represents the context of the function call. We call this
    additional argument an accumulator. During the traversal of data, the recursive
    calls continue to receive regular arguments while accumulators change in relation
    to those and the context.
  prefs: []
  type: TYPE_NORMAL
- en: Designing functions with accumulators correctly is clearly more complex than
    any of the design approaches from the preceding chapters. The key is to understand
    the relationship between the proper arguments and the accumulators. The following
    chapters explain how to design functions with accumulators and how they work.
  prefs: []
  type: TYPE_NORMAL
- en: 31The Loss of Knowledge[ğŸ”—](#(part._ch~3aaccumulator-samples) "Link to here")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Both functions designed according to structural recipes and the generative one
    suffer from the loss of knowledge, though in different ways. This chapter explains
    with two examplesâ€”<wbr>one from each categoryâ€”<wbr>how the lack of contextual
    knowledge affects the performance of functions. While the first section is about
    structural recursion, the second one addresses concerns in the generative realm.
  prefs: []
  type: TYPE_NORMAL
- en: 31.1A Problem with Structural Processing[ğŸ”—](#(part._sec~3aloss~3astructural)
    "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Letâ€™s start with a seemingly straightforward example:'
  prefs: []
  type: TYPE_NORMAL
- en: Sample Problem You are working for a geometer team that will measure the length
    of road segments. The team asked you to design a program that translates these
    relative distances between a series of road points into absolute distances from
    some starting point.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'For example, we might be given a line such as this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/5a9d2f0469cb71f538386aaa55496b62.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: 'Each number specifies the distance between two dots. What we need is the following
    picture, where each dot is annotated with the distance to the left-most end:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/afa989beb9cef02557601cb8f1a81d95.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: Designing a program that performs this calculation is a mere exercise in structural
    function design. [FigureÂ 177](#%28counter._%28figure._fig~3arel-abs-dist%29%29)
    contains the complete program. When the given list is not '(), the natural recursion
    computes the absolute distance of the remainder of the dots to the first one on
    ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  l).
    Because the first is not the actual origin and has a distance of ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  l)
    to the origin, we must add ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  l)
    to each number on the result of the natural recursion. This second stepâ€”<wbr>adding
    a number to each item on a list of numbersâ€”<wbr>requires an auxiliary function.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â converts a list of relative to absolute distances |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â the first number represents the distance to the origin |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (relative->absoluteÂ ''(50Â 40Â 70Â 30Â 30))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ''(50Â 90Â 160Â 190Â 220)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (relative->absoluteÂ l)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â ''()]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â rest-of-l
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (relative->absoluteÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â adjusted
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (add-to-eachÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â rest-of-l)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â adjusted))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Number](part_one.html#%28tech._number%29) [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â adds n to each number on l |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 50Â (add-to-eachÂ 50Â ''(40Â 110Â 140Â 170)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ''(50Â 90Â 160Â 190Â 220)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (add-to-eachÂ nÂ l)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â ''()]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â n)Â (add-to-eachÂ nÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 177: Converting relative distances to absolute distances'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'While designing the program is relatively straightforward, using it on larger
    and larger lists reveals a problem. Consider the evaluation of the following expression:'
  prefs: []
  type: TYPE_NORMAL
- en: (relative->absoluteÂ ([build-list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._build-list%29%29)Â sizeÂ [add1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._add1%29%29)))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'As we increase size, the time needed grows even faster:'
  prefs: []
  type: TYPE_NORMAL
- en: '| size |  | 1000 |  | 2000 |  | 3000 |  | 4000 |  | 5000 |  | 6000 |  | 7000
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| time |  | 25 |  | 109 |  | 234 |  | 429 |  | 689 |  | 978 |  | 1365 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Instead of doubling as we go from 1000 to 2000 items, the time quadruples.
    This is also the approximate relationship for going from 2000 to 4000, and so
    on.The times will differ from computer to computer and year to year. These measurements
    were conducted in 2017 on a MacMini running OS X 10.11; the previous measurement
    took place in 1998, and the times were 100x larger. Using the terminology of [Intermezzo
    5: The Cost of Computation](i5-6.html), we say that the functionâ€™s performance
    is O(n2) where n is the length of the given list.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 489\. Reformulate add-to-each using [map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29)
    and [lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 490\. Develop a formula that describes the abstract running time of
    relative->absolute. Hint Evaluate the expression
  prefs: []
  type: TYPE_NORMAL
- en: (relative->absoluteÂ ([build-list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._build-list%29%29)Â sizeÂ [add1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._add1%29%29)))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: by hand. Start by replacing size with 1, 2, and 3\. How many recursions of relative->absolute
    and add-to-each are required each time?
  prefs: []
  type: TYPE_NORMAL
- en: Considering the simplicity of the problem, the amount of work that the program
    performs is surprising. If we were to convert the same list by hand, we would
    tally up the total distance and just add it to the relative distances as we take
    steps along the line. Why canâ€™t a program do so?
  prefs: []
  type: TYPE_NORMAL
- en: 'Letâ€™s attempt to design a version of the function that is close to our manual
    method. We still start from the list-processing template:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (relative->absolute/aÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (relative->absolute/aÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Now letâ€™s simulate a hand-evaluation:'
  prefs: []
  type: TYPE_NORMAL
- en: '| (relative->absolute/aÂ ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 3Â 2Â 7))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â 3Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (relative->absolute/aÂ ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 2Â 7)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â 3Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â 2Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â (relative->absolute/aÂ ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 7))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â 3Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â 2Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â 7Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â (relative->absolute/aÂ ''())))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The first item of the result list should obviously be 3, and it is easy to construct
    this list. But, the second one should be ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)  3  2),
    yet the second instance of relative->absolute/a has no way of â€œknowingâ€ that the
    first item of the original list is 3. The â€œknowledgeâ€ is lost.
  prefs: []
  type: TYPE_NORMAL
- en: Again, the problem is that recursive functions are independent of their context.
    A function processes L in ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  N  L)
    the same way as in ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  K  L).
    Indeed, if given L by itself, it would also process the list in that way.
  prefs: []
  type: TYPE_NORMAL
- en: 'To make up for the loss of â€œknowledge,â€ we equip the function with an additional
    parameter: accu-dist. The latter represents the accumulated distance, which is
    the tally that we keep when we convert a list of relative distances to a list
    of absolute distances. Its initial value must be 0. As the function traverses
    the list, it must add its numbers to the tally.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the revised definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (relative->absolute/aÂ lÂ accu-dist)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â ''()]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â tallyÂ ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â accu-dist)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â tally
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â (relative->absolute/aÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)Â tally)))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'The recursive application consumes the rest of the list and the new absolute
    distance of the current point to the origin. Although both arguments are changing
    for every call, the change in the second one strictly depends on the first argument.
    The function is still a plain list-processing procedure.Now letâ€™s evaluate our
    running example again:'
  prefs: []
  type: TYPE_NORMAL
- en: '| (relative->absolute/aÂ ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 3Â 2Â 7))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (relative->absolute/aÂ ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 3Â 2Â 7)Â 0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 3Â (relative->absolute/aÂ ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 2Â 7)Â 3))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 3Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 5Â (relative->absolute/aÂ ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â 7)Â 5)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 3Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 5Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 12Â ???)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 3Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 5Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â 12Â ''())))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Stop! Fill in the question marks in line 4.
  prefs: []
  type: TYPE_NORMAL
- en: The hand-evaluation shows just how much the use of an accumulator simplifies
    the conversion process. Each item in the list is processed once. When relative->absolute/a
    reaches the end of the argument list, the result is completely determined and
    no further work is needed. In general, the function performs on the order of N
    natural recursion steps for a list with N items.
  prefs: []
  type: TYPE_NORMAL
- en: One problem is that, unlike relative->absolute, the new function consumes two
    arguments, not just one. Worse, someone might accidentally misuse relative->absolute/a
    by applying it to a list of numbers and a number that isnâ€™t 0. We can solve both
    problems with a function definition that uses a [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    definition to encapsulate relative->absolute/a; [figureÂ 178](#%28counter._%28figure._fig~3arel-abs-human%29%29)
    shows the result. Now, relative->absolute is indistinguishable from relative->absolute.v2
    with respect to input-output.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â converts a list of relative to absolute distances |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â the first number represents the distance to the origin |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (relative->absolute.v2Â ''(50Â 40Â 70Â 30Â 30))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ''(50Â 90Â 160Â 190Â 220)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (relative->absolute.v2Â l0)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    [Number](part_one.html#%28tech._number%29) -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (relative->absolute/aÂ lÂ accu-dist)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â ''()]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â accuÂ ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â accu-dist)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â accu
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (relative->absolute/aÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)Â accu)))])))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (relative->absolute/aÂ l0Â 0))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 178: Converting relative distances with an accumulator'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Now letâ€™s look at how this version of the program performs. To this end, we
    evaluate
  prefs: []
  type: TYPE_NORMAL
- en: (relative->absolute.v2Â ([build-list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._build-list%29%29)Â sizeÂ [add1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._add1%29%29)))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'and tabulate the results for several values of size:'
  prefs: []
  type: TYPE_NORMAL
- en: '| size |  | 1000 |  | 2000 |  | 3000 |  | 4000 |  | 5000 |  | 6000 |  | 7000
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| time |  | 0 |  | 0 |  | 0 |  | 0 |  | 0 |  | 1 |  | 1 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Amazingly, relative->absolute.v2 never takes more than one second to process
    such lists, even for a list of 7000 numbers. Comparing this performance to the
    one of relative->absolute, you may think that accumulators are a miracle cure
    for all slow-running programs. Unfortunately, this isnâ€™t the case, but when a
    structurally recursive function has to re-process the result of the natural recursion
    you should definitely consider the use of accumulators. In this particular case,
    the performance improved from O(n2) to O(n)â€”<wbr>with an additional large reduction
    in the constant.ExerciseÂ 491\. With a bit of design and a bit of tinkering, a
    friend of yours came up with the following solution for the sample problem:Adrian
    German and Mardin Yadegar suggested this exercise.
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (relative->absoluteÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â ([reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)Â (elementÂ accu)Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â elementÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â accu))Â accu))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'This simple solution merely uses well-known ISL+ functions: [reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)
    and [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29).
    Using [lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29),
    as you know, is just a convenience. You may also recall from [Abstraction](part_three.html)
    that [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)
    is designable with the design recipes presented in the first two parts of the
    book.'
  prefs: []
  type: TYPE_NORMAL
- en: Does your friendâ€™s solution mean there is no need for our complicated design
    in this motivational section? For an answer, see [Recognizing the Need for an
    Accumulator](#%28part._sec~3aneed-accu%29), but reflect on the question first.
    Hint Try to design [reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)
    on your own.
  prefs: []
  type: TYPE_NORMAL
- en: 31.2A Problem with Generative Recursion[ğŸ”—](#(part._sec~3aloss~3agenerative)
    "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Letâ€™s revisit the problem of â€œtravelingâ€ along a path in a graph:'
  prefs: []
  type: TYPE_NORMAL
- en: Sample Problem Design an algorithm that checks whether two nodes are connected
    in a simple graph. In such a graph, each node has exactly one, directional connection
    to another, and possibly itself.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Algorithms that Backtrack](part_five.html#%28part._ch~3abacktrack%29) covers
    the variant where the algorithm has to discover the path. This sample problem
    is simpler than that because this section focuses on the design of an accumulator
    version of the algorithm.'
  prefs: []
  type: TYPE_NORMAL
- en: Consider the sample graph in [figureÂ 179](#%28counter._%28figure._fig~3asim-graph%29%29).
    There are six nodes, A through F, and six connections. A path from A to E must
    contain B and C. There is no path, though, from A to F or from any other node
    besides itself.
  prefs: []
  type: TYPE_NORMAL
- en: '| ![image](../Images/ffae0bf654547134d6aa452e51e99619.png) |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '&#124; ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â a-sg
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ''((AÂ B) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (BÂ C) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (CÂ E) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (DÂ E) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (EÂ B) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â (FÂ F))) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 179: A simple graph'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The right part of [figureÂ 179](#%28counter._%28figure._fig~3asim-graph%29%29)
    shows how to represent this graph with nested lists. Each node is represented
    by a list of two symbols. The first symbol is the label of the node; the second
    one is the single node that is reachable from the first one. Here are the relevant
    data definitions:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â A SimpleGraph is a [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Connection](#%28tech._connection%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Connection is a list of two items: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  [Node](#%28tech._node%29)  [Node](#%28tech._node%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Node is a [Symbol](i2-3.html#%28tech._symbol%29). |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'They are straightforward translations of our informal descriptions.We already
    know that the problem calls for generative recursion, and it is easy to create
    the header material:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Node](#%28tech._node%29)  [Node](#%28tech._node%29)  [SimpleGraph](#%28tech._simplegraph%29)
    -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â is there a path from origin to destination |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â in the simple graph sg |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (path-exists?Â ''AÂ ''EÂ a-sg)Â #true)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (path-exists?Â ''AÂ ''FÂ a-sg)Â #false)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (path-exists?Â originÂ destinationÂ sg)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â #false) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'What we need are answers to the four basic questions of the recipe for generative
    recursion:'
  prefs: []
  type: TYPE_NORMAL
- en: The problem is trivial if origin is the same as destination.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The trivial solution is #true.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'If origin is not the same as destination, there is only one thing we can do:
    step to the immediate neighbor and search for destination from there.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There is no need to do anything if we find the solution to the new problem.
    If originâ€™s neighbor is connected to destination, then so is origin. Otherwise
    there is no connection.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: From here we just need to express these answers in ISL+ to obtain a full-fledged
    program.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Node](#%28tech._node%29)  [Node](#%28tech._node%29)  [SimpleGraph](#%28tech._simplegraph%29)
    -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â is there a path from origin to destination in sg |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (path-exists?Â ''AÂ ''EÂ a-sg)Â #true)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (path-exists?Â ''AÂ ''FÂ a-sg)Â #false)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (path-exists?Â originÂ destinationÂ sg)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([symbol=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29)Â originÂ destination)Â #t]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (path-exists?Â (neighborÂ originÂ sg)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â destination |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sg)])) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Node](#%28tech._node%29)  [SimpleGraph](#%28tech._simplegraph%29) -> [Node](#%28tech._node%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â determine the node that is connected to a-node in sg |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (neighborÂ ''AÂ a-sg)Â ''B)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-error%29%29)Â (neighborÂ ''GÂ a-sg)Â "neighbor:
    not a node") |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (neighborÂ a-nodeÂ sg)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â sg)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â "neighbor:
    not a node")] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([symbol=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â sg))Â a-node)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([second](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._second%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â sg))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â (neighborÂ a-nodeÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â sg)))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 180: Finding a path in a simple graph'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 180](#%28counter._%28figure._fig~3apath-exists1%29%29) contains the
    complete program, including the function for finding the neighbor of a node in
    a simple graphâ€”<wbr>a straightforward exercise in structural recursionâ€”<wbr>and
    test cases for both possible outcomes. Donâ€™t run the program, however. If you
    do, be ready with your mouse to stop the run-away program. Indeed, even a casual
    look at the function suggests that we have a problem. Although the function is
    supposed to produce #false if there is no path from origin to destination, the
    program doesnâ€™t contain #false anywhere. Conversely, we need to ask what the function
    actually does when there is no path between two nodes.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Take another look at [figureÂ 179](#%28counter._%28figure._fig~3asim-graph%29%29).
    In this simple graph there is no path from C to D. The connection that leaves
    C passes right by D and instead goes to E. So letâ€™s look at a hand-evaluation:'
  prefs: []
  type: TYPE_NORMAL
- en: '| (path-exists?Â ''CÂ ''DÂ ''((AÂ B)Â ![image](../Images/f3b90b6103b5a2c514feeda21cedbd2e.png)Â (FÂ F)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (path-exists?Â ''EÂ ''DÂ ''((AÂ B)Â Â ![image](../Images/214edf4315b3bce96edc25fa984eb817.png)Â (FÂ F)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (path-exists?Â ''BÂ ''DÂ ''((AÂ B)Â Â ![image](../Images/762d4f59557b80d1b76fe806118563ab.png)Â (FÂ F)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (path-exists?Â ''CÂ ''DÂ ''((AÂ B)Â Â ![image](../Images/c909d5a4ab1a156df8fdb211f315406f.png)Â (FÂ F)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: It confirms that as the function recurs, it calls itself with the exact same
    arguments again and again. In other words, the evaluation never stops.
  prefs: []
  type: TYPE_NORMAL
- en: Our problem with path-exists? is again a loss of â€œknowledge,â€ similar to that
    of relative->absolute above. Like relative->absolute, the design of path-exists?
    uses a recipe and assumes that recursive calls are independent of their context.
    In the case of path-exists? this means, in particular, that the function doesnâ€™t
    â€œknowâ€ whether a previous application in the current chain of recursions received
    the exact same arguments.
  prefs: []
  type: TYPE_NORMAL
- en: The solution to this design problem follows the pattern of the preceding section.
    We add a parameter, which we call seen and which represents the accumulated list
    of starter nodes that the function has encountered, starting with the original
    application. Its initial value must be '(). As the function checks on a specific
    origin and moves to its neighbors, origin is added to seen.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is a first revision of path-exists?, dubbed path-exists?/a:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Node](#%28tech._node%29)  [Node](#%28tech._node%29)  [SimpleGraph](#%28tech._simplegraph%29)
    [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Node](#%28tech._node%29)]
    -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â is there a path from origin to destination |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â assume there are no paths for the nodes in seen |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (path-exists?/aÂ originÂ destinationÂ sgÂ seen)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([symbol=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29)Â originÂ destination)Â #true]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (path-exists?/aÂ (neighborÂ originÂ sg)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â destination |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sg |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â originÂ seen))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The addition of the new parameter alone does not solve our problem, but, as
    the hand-evaluation of
  prefs: []
  type: TYPE_NORMAL
- en: (path-exists?/aÂ 'CÂ 'DÂ '((AÂ B)Â ![image](../Images/3a950954c22e19d9d89ddb3d8ab43f03.png)Â (FÂ F))Â '())
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'shows, it provides the foundation for one:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ==Â (path-exists?/aÂ ''EÂ ''DÂ ''((AÂ B)Â ![image](../Images/e58bb455008467615958a41a77a5084f.png)Â (FÂ F))Â ''(C))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (path-exists?/aÂ ''BÂ ''DÂ ''((AÂ B)Â ![image](../Images/20282f15827ece33fef21e4aa8ab7a7d.png)Â (FÂ F))Â ''(EÂ C))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (path-exists?/aÂ ''CÂ ''DÂ ''((AÂ B)Â ![image](../Images/f0c780d328fcc52fa9608528d8c8f2bc.png)Â (FÂ F))Â ''(BÂ EÂ C))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: In contrast to the original function, the revised function no longer calls itself
    with the exact same arguments. While the three arguments proper are again the
    same for the third recursive application, the accumulator argument is different
    from that of the first application. Instead of '(), it is now '(B  E  C). The
    new value tells us that during the search of a path from 'C to 'D, the function
    has inspected 'B, 'E, and 'C as starting points.
  prefs: []
  type: TYPE_NORMAL
- en: 'All we need to do now is to make the algorithm exploit the accumulated knowledge.
    Specifically, the algorithm can determine whether the given origin is already
    an item in seen. If so, the problem is also trivially solvable, yielding #false
    as the solution. [FigureÂ 181](#%28counter._%28figure._fig~3apath-exists2%29%29)
    contains the definition of path-exists.v2?, which is the revision of path-exists?.
    The definition refers to [member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29),
    an ISL+ function.'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Node](#%28tech._node%29)  [Node](#%28tech._node%29)  [SimpleGraph](#%28tech._simplegraph%29)
    -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â is there a path from origin to destination in sg |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (path-exists.v2?Â ''AÂ ''EÂ a-sg)Â #true)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (path-exists.v2?Â ''AÂ ''FÂ a-sg)Â #false)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (path-exists.v2?Â originÂ destinationÂ sg)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [Node](#%28tech._node%29)  [Node](#%28tech._node%29)  [SimpleGraph](#%28tech._simplegraph%29)
    [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Node](#%28tech._node%29)]
    -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (path-exists?/aÂ originÂ seen)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([symbol=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._symbol~3d~3f%29%29)Â originÂ destination)Â #t]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29)Â originÂ seen)Â #f]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (path-exists?/aÂ (neighborÂ originÂ sg)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â originÂ seen))])))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (path-exists?/aÂ originÂ ''()))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 181: Finding a path in a simple graph with an accumulator'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The definition of path-exists.v2? also eliminates the two minor problems with
    the first revision. By localizing the definition of the accumulating function,
    we can ensure that the first call always uses '() as the initial value for seen.
    And, path-exists.v2? satisfies the exact same signature and purpose statement
    as the path-exists? function.
  prefs: []
  type: TYPE_NORMAL
- en: Still, there is a significant difference between path-exists.v2? and relative-to-absolute2.
    Whereas the latter was equivalent to the original function, path-exists.v2? improves
    on path-exists?. While the latter fails to find an answer for some inputs, path-exists.v2?
    finds a solution for any simple graph.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 492\. Modify the definitions in [figureÂ 169](part_five.html#%28counter._fsm._%28figure._fig~3afind-path-code%29%29)
    so that the program produces #false, even if it encounters the same origin twice.'
  prefs: []
  type: TYPE_NORMAL
- en: 32Designing Accumulator-Style Functions[ğŸ”—](#(part._sec~3adesign-accu) "Link
    to here")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The preceding chapter illustrates the need for accumulating extra knowledge
    with two examples. In one case, accumulation makes it easy to understand the function
    and yields one that is far faster than the original version. In the other case,
    accumulation is necessary for the function to work properly. In both cases, though,
    the need for accumulation becomes apparent only once a properly designed function
    exists.
  prefs: []
  type: TYPE_NORMAL
- en: 'Generalizing from the preceding chapter suggests that the design of accumulator
    functions has two major aspects:'
  prefs: []
  type: TYPE_NORMAL
- en: the recognition that a function benefits from an accumulator; and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: an understanding of what the accumulator represents.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The first two sections address these two questions. Because the second one is
    a difficult topic, the third section illustrates it with a series of examples
    that convert regular functions into accumulating ones.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29) X] -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)
    X] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â constructs the reverse of alox |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (invertÂ ''(aÂ bÂ c))Â ''(cÂ bÂ a))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (invertÂ alox)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alox)Â ''()]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â (add-as-lastÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â alox)Â (invertÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alox)))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â X [[List-of](part_three.html#%28tech._sim-dd._list._of%29) X] -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)
    X] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â adds an-x to the end of alox |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (add-as-lastÂ ''aÂ ''(cÂ b))Â ''(cÂ bÂ a))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (add-as-lastÂ an-xÂ alox)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alox)Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â an-x)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â alox)Â (add-as-lastÂ an-xÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alox)))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 182: Design with accumulators, a structural example'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 32.1Recognizing the Need for an Accumulator[ğŸ”—](#(part._sec~3aneed-accu) "Link
    to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Recognizing the need for accumulators is not an easy task. We have seen two
    reasons, and they are the most prevalent ones. In either case, it is critical
    that we first built a complete function based on a conventional design recipe.
    Then we study the function and proceed as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: If a structurally recursive function traverses the result of its natural recursion
    with an auxiliary, recursive function, consider the use of an accumulator parameter.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Take a look at the definition of invert in [figureÂ 182](#%28counter._%28figure._fig~3adesign-accu-ex%29%29).
    The result of the recursive application produces the reverse of the rest of the
    list. It uses add-as-last to add the first item to this reversed list and thus
    creates the reverse of the entire list. This second, auxiliary function is also
    recursive. We have thus identified an accumulator candidate.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'It is now time to study some hand-evaluations, as in [A Problem with Structural
    Processing](#%28part._sec~3aloss~3astructural%29), to see whether an accumulator
    helps. Consider the following:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '| (invertÂ ''(aÂ bÂ c)) |'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (add-as-lastÂ ''aÂ (invertÂ ''(bÂ c))) |'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (add-as-lastÂ ''aÂ (add-as-lastÂ ''bÂ (invertÂ ''(c)))) |'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ... |'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (add-as-lastÂ ''aÂ (add-as-lastÂ ''bÂ ''(c))) |'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (add-as-lastÂ ''aÂ ''(cÂ b)) |'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â ''(cÂ bÂ a) |'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: Stop! Replace the dots with the two missing steps. Then you can see that invert
    eventually reaches the end of the given listâ€”<wbr>just like add-as-lastâ€”<wbr>and
    if it knew which items to put there, there would be no need for the auxiliary
    function.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: If we are dealing with a function based on generative recursion, we are faced
    with a much more difficult task. Our goal must be to understand whether the algorithm
    can fail to produce a result for inputs for which we expect a result. If so, adding
    a parameter that accumulates knowledge may help. Because these situations are
    complex, we defer the discussion of an example to [More Uses of Accumulation](#%28part._ch~3amore-accu%29).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'ExerciseÂ 493\. Argue that, in the terminology of [Intermezzo 5: The Cost of
    Computation](i5-6.html), invert consumes O(n2) time when the given list consists
    of n items.'
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 494\. Does the insertion sort> function from [Auxiliary Functions that
    Recur](part_two.html#%28part._sec~3asort.I%29) need an accumulator? If so, why?
    If not, why not?
  prefs: []
  type: TYPE_NORMAL
- en: 32.2Adding Accumulators[ğŸ”—](#(part._sec~3aaccu-style) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Once you have decided that an existing function should be equipped with an
    accumulator, take these two steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Determine the knowledge that the accumulator represents, what kind of data to
    use, and how the knowledge is acquired as data.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For example, for the conversion of relative distances to absolute distances,
    it suffices to accumulate the total distance encountered so far. As the function
    processes the list of relative distances, it adds each new relative distance found
    to the accumulatorâ€™s current value. For the routing problem, the accumulator remembers
    every node encountered. As the path-checking function traverses the graph, it
    [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)es
    each new node on to the accumulator.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In general, you will want to proceed as follows.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Create an accumulator template:'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '| ;Â Domain -> Range |'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (functionÂ d0)
    |'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â Domain
    AccuDomain -> Range |'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator ... |'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (function/aÂ dÂ a)
    |'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))
    |'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (function/aÂ d0Â a0))) |'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_BQ
  type: TYPE_TB
- en: Sketch a manual evaluation of an application of function to understand the nature
    of the accumulator.
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: Determine the kind of data that the accumulator tracks.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Write down a statement that explains the accumulator as a relationship between
    the argument d of the auxiliary function/a and the original argument d0.
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: Note The relationship remains constant, also called invariant, over the course
    of the evaluation. Because of this property, an accumulator statement is often
    called an invariant.
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: Use the invariant to determine the initial value a0 for a.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Also exploit the invariant to determine how to compute the accumulator for the
    recursive function calls within the definition of function/a.
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: Exploit the accumulatorâ€™s knowledge for the design of function/a.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For a structurally recursive function, the accumulatorâ€™s value is typically
    used in the base case, that is, the [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause that does not recur. For functions that use generative-recursive functions,
    the accumulated knowledge might be used in an existing base case, in a new base
    case, or in the [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clauses that deal with generative recursion.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'As you can see, the key is the precise description of the role of the accumulator.
    It is therefore important to practice this skill.Letâ€™s take a look at the invert
    example:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (invert.v2Â alox0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)
    X] ??? -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29) X] |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â constructs the reverse of alox |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator ... |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (invert/aÂ aloxÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alox)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (invert/aÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alox)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  a  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (invert/aÂ alox0Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: As illustrated in the preceding section, this template suffices to sketch a
    manual evaluation of an example such as
  prefs: []
  type: TYPE_NORMAL
- en: (invertÂ '(aÂ bÂ c))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Here is the idea:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ==Â (invert/aÂ ''(aÂ bÂ c)Â a0) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (invert/aÂ ''(bÂ c)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  ''a  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  a0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (invert/aÂ ''(c)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  ''b  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  ''a  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  a0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ==Â (invert/aÂ ''()Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  ''c  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  ''b  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  ''a  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  a0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'This sketch suggests that invert/a can keep track of all the items it has seen
    in a list that tracks the difference between alox0 and a in reverse order. The
    initial value is clearly ''(); updating the accumulator inside of invert/a with
    [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)
    produces exactly the desired value when invert/a reaches ''().Here is a refined
    template that includes these insights:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (invert.v2Â alox0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)
    X] [[List-of](part_three.html#%28tech._sim-dd._list._of%29) X] -> [[List-of](part_three.html#%28tech._sim-dd._list._of%29)
    X] |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â constructs the reverse of alox |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  a is the list of all those |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â items on alox0 that precede alox |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â in reverse order |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (invert/aÂ aloxÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alox)Â a]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (invert/aÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alox)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)  ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  alox)  a))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (invert/aÂ alox0Â ''()))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: While the body of the [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    definition initializes the accumulator with '(), the recursive call uses [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)
    to add the current head of alox to the accumulator. In the base case, invert/a
    uses the knowledge in the accumulator, the reversed list.
  prefs: []
  type: TYPE_NORMAL
- en: Note how, once again, invert.v2 merely traverses the list. In contrast, invert
    reprocesses every result of its natural recursion with add-as-last. Stop! Measure
    how much faster invert.v2 runs than invert.
  prefs: []
  type: TYPE_NORMAL
- en: Terminology Programmers use the phrase accumulator-style function to discuss
    functions that use an accumulator parameter. Examples of functions in accumulator
    style are relative->absolute/a, invert/a, and path-exists?/a.
  prefs: []
  type: TYPE_NORMAL
- en: 32.3Transforming Functions into Accumulator Style[ğŸ”—](#(part._sec~3atrans-accu)
    "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Articulating the accumulator statement is difficult, but, without formulating
    a good invariant, it is impossible to understand an accumulator-style function.
    Since the goal of a programmer is to make sure that others who follow understand
    the code easily, practicing this skill is critical. And formulating invariants
    deserves a lot of practice.
  prefs: []
  type: TYPE_NORMAL
- en: 'The goal of this section is to study the formulation of accumulator statements
    with three case studies: a summation function, the factorial function, and a tree-traversal
    function. Each such case is about the conversion of a structurally recursive function
    into accumulator style. None actually calls for the use of an accumulator parameter.
    But they are easily understood and, with the elimination of all other distractions,
    using such examples allows us to focus on the articulation of the accumulator
    invariant.'
  prefs: []
  type: TYPE_NORMAL
- en: 'For the first example, consider these definitions of the sum function:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (sum.v1Â alon)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alon)Â 0]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â alon)Â (sum.v1Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alon)))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Here is the first step toward an accumulator version:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (sum.v2Â alon0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    ??? -> [Number](part_one.html#%28tech._number%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â computes the sum of the numbers on alon |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  ... |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (sum/aÂ alonÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alon)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (sum/aÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alon)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  a  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (sum/aÂ alon0Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Stop! Supply a signature and a test case that works for both.
  prefs: []
  type: TYPE_NORMAL
- en: As suggested by our first step, we have put the template for sum/a into a [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    definition, added an accumulator parameter, and renamed the parameter of sum .
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (sum.v1Â ''(10Â 4)) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 10Â (sum.v1Â ''(4)))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 10Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 4Â (sum.v1Â ''())))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 10Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 4Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 0)))
    &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ... &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â 14 &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (sum.v2Â ''(10Â 4)) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â (sum/aÂ ''(10Â 4)Â a0) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â (sum/aÂ ''(4)Â ...Â 10Â ...Â a0) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â (sum/aÂ ''()Â ...Â 4Â ...Â 10Â ...Â a0) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ... &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â 14 &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 183: Calculating with accumulator-style templates'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 183](#%28counter._%28figure._fig~3asum-accu%29%29) shows two side-by-side
    sketches of hand-evaluations. A comparison immediately suggests the central idea,
    namely, that sum/a can use the accumulator to add up the numbers it encounters.
    Concerning the accumulator invariant, the calculations suggest a represents the
    sum of the numbers encountered so far:'
  prefs: []
  type: TYPE_NORMAL
- en: a is the sum of the numbers that alon lacks from alon0
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'For example, the invariant forces the following relationships to hold:'
  prefs: []
  type: TYPE_NORMAL
- en: '| if |  | alon0 |  | is |  | ''(10  4  6) |  | ''(10  4  6) |  | ''(10  4  6)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| and |  | alon |  | is |  | ''(4  6) |  | ''(6) |  | ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| then |  | a |  | should be |  | 10 |  | 14 |  | 20 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Given this precise invariant, the rest of the design is straightforward:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (sum.v2Â alon0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Number](part_one.html#%28tech._number%29)]
    [Number](part_one.html#%28tech._number%29) -> [Number](part_one.html#%28tech._number%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â computes the sum of the numbers on alon |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  a is the sum of the numbers |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â that alon lacks from alon0 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (sum/aÂ alonÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â alon)Â a]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (sum/aÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â alon)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â alon)Â a))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (sum/aÂ alon0Â 0))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: If alon is '(), sum/a returns a because it represents the sum of all numbers
    on alon. The invariant also implies that 0 is the initial value for a0 and [+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)
    updates the accumulator by adding the number that is about to be â€œforgottenâ€â€”<wbr>([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  alon)â€”<wbr>to
    the accumulator a.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 495\. Complete the manual evaluation of (sum/a  '(10  4)  0) in [figureÂ 183](#%28counter._%28figure._fig~3asum-accu%29%29).
    Doing so shows that the sum and sum.v2 add up the given numbers in reverse order.
    While sum adds up the numbers from right to left, the accumulator-style version
    adds them up from left to right.
  prefs: []
  type: TYPE_NORMAL
- en: 'Note on Numbers Remember that for exact numbers, this difference has no effect
    on the final result. For inexact numbers, the difference can be significant. See
    the exercises at the end of [Intermezzo 5: The Cost of Computation](i5-6.html).'
  prefs: []
  type: TYPE_NORMAL
- en: 'For the second example, we turn to the well-known factorial function: The factorial
    function is useful for the analysis of algorithms.'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [N](part_two.html#%28tech._n%29) -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â computes ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  n  ([-](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._-%29%29)  n  1)  ([-](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._-%29%29)  n  2)  ...  1)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (!.v1Â 3)Â 6)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (!.v1Â n)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([zero?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._zero~3f%29%29)Â n)Â 1]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â nÂ (!.v1Â ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n)))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'While relative-2-absolute and invert processed lists, the factorial function
    works on natural numbers, which its template reflects.We proceed as before with
    a template for an accumulator-style version:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (!.v2Â n0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [N](part_two.html#%28tech._n%29)
    ??? -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â computes ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  n  ([-](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._-%29%29)  n  1)  ([-](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._-%29%29)  n  2)  ...  1)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  ... |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (!/aÂ nÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([zero?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._zero~3f%29%29)Â n)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (!/aÂ ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  a  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (!/aÂ n0Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'followed by a sketch of a hand-evaluation:'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (!.v1Â 3) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 3Â (!.v1Â 2))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 3Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â 2Â (!.v1Â 1)))
    &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ... &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â 6 &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (!.v2Â 3) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â (!/aÂ 3Â a0) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â (!/aÂ 2Â ...Â 3Â ...Â a0) &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ... &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; ==Â 6 &#124;'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The left column indicates how the original version works; the right one sketches
    how the accumulator-style function proceeds. Both structurally traverse a natural
    number until they reach 0. While the original version schedules only multiplications,
    the accumulator keeps track of each number as the structural traversal descends
    through the given natural number.Given the goal of multiplying these numbers,
    !/a can use the accumulator to multiply the numbers immediately:'
  prefs: []
  type: TYPE_NORMAL
- en: a is the product of the natural numbers in the interval [n0,n).
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In particular, when n0 is 3 and n is 1, a is 6.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 496\. What should the value of a be when n0 is 10 and n is 8?
  prefs: []
  type: TYPE_NORMAL
- en: 'Using this invariant we can easily pick the initial value for aâ€”<wbr>it is
    1â€”<wbr>and we know that multiplying the current accumulator with n is the proper
    update operation:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (!.v2Â n0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [N](part_two.html#%28tech._n%29)  [N](part_two.html#%28tech._n%29)
    -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â computes ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)  n  ([-](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._-%29%29)  n  1)  ([-](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._-%29%29)  n  2)  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  1)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  a is the product of the |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â natural numbers in the interval [n0,n) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (!/aÂ nÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([zero?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._zero~3f%29%29)Â n)Â a]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (!/aÂ ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n)Â ([*](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2A%29%29)Â nÂ a))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (!/aÂ n0Â 1))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: It also follows from the accumulator statement that when n is 0, the accumulator
    is the product of n through 1, meaning it is the desired result. So, like sum,
    !/a returns a in this case and uses the result of the recursion in the second
    case.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 497\. Like sum, !.v1 performs the primitive computations, multiplication
    in this case, in reverse order. Surprisingly, this affects the performance of
    the function in a negative manner.
  prefs: []
  type: TYPE_NORMAL
- en: Measure how long it takes to evaluate (!.v1  20) 1,000 times. Recall that ([time](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._time%29%29)  an-expression)
    function determines how long it takes to run an-expression.
  prefs: []
  type: TYPE_NORMAL
- en: For the third and last example, we use a function that measures the height of
    simplified binary trees. The example illustrates that accumulator-style programming
    applies to all kinds of data, not just those defined with single self-references.
    Indeed, it is as commonly used for complicated data definitions as it is for lists
    and natural numbers.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here are the relevant definitions:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â nodeÂ [leftÂ right])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A Tree is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-node  [Tree](#%28tech._tree%29)  [Tree](#%28tech._tree%29)) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â example
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (make-nodeÂ (make-nodeÂ ''()Â (make-nodeÂ ''()Â ''()))Â ''())) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'These trees carry no information; their leaves are ''(). Still, there are many
    different trees, as [figureÂ 184](#%28counter._%28figure._fig~3asim-bt-ex%29%29)
    shows; it also uses suggestive graphics to bring across what these pieces of data
    look like as trees.One property that one may wish to compute is the height of
    such a tree:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (heightÂ abt)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â abt)Â 0]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â ([max](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._max%29%29)Â (heightÂ (node-leftÂ abt))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (heightÂ (node-rightÂ abt)))Â 1)])) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Stop! Supply a signature and a test. The table in [figureÂ 184](#%28counter._%28figure._fig~3asim-bt-ex%29%29)
    indicates how to measure the height of a tree, though it leaves the notion somewhat
    ambiguous: it is either the number of nodes from the root of the tree to the highest
    leaf or the number of connections on such a path. The height function follows
    the second option.'
  prefs: []
  type: TYPE_NORMAL
- en: '| ![image](../Images/ec16cb0d2d45394c52262a9a1b32745e.png) |  | ''() |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ![image](../Images/5a56eab97d4227baec984499f0a3bf33.png) |  | (make-nodeÂ ''()Â ''())
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '|  |  |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ![image](../Images/55a7125f85f6973f27f23e5346acea7b.png) |  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; (make-node &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â (make-nodeÂ ''() &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â Â Â Â Â Â Â Â Â Â Â Â (make-nodeÂ ''()Â ''())) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '&#124; Â Â ''()) &#124;'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '|'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 184: Some stripped-down binary trees'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'To transform this function into an accumulator-style function, we follow the
    standard path. We begin with an appropriate template:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (height.v2Â abt0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [Tree](#%28tech._tree%29)
    ??? -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â measures the height of abt |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  ... |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (height/aÂ abtÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â abt)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (height/aÂ (node-leftÂ abt)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  a  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (height/aÂ (node-rightÂ abt)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  a  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (height/aÂ abt0Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'As always, the problem is to determine what knowledge the accumulator represents.
    One obvious choice is the number of traversed branches:'
  prefs: []
  type: TYPE_NORMAL
- en: a is the number of steps it takes to reach abt from abt0.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Illustrating this accumulator invariant is best done with a graphical example.
    Take a second look at [figureÂ 184](#%28counter._%28figure._fig~3asim-bt-ex%29%29).
    The bottom-most tree comes with two annotations, each pointing out one subtree:'
  prefs: []
  type: TYPE_NORMAL
- en: If abt0 is the complete tree and abt is the subtree pointed to by the circled
    1, the accumulatorâ€™s value must be 1 because it takes exactly one step to get
    from the root of abt to the root of abt0.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In the same spirit, for the subtree labeled 2 the accumulator is 2 because it
    takes two steps to get to this place.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'As for the preceding two examples, the invariant basically dictates how to
    follow the rest of the design recipe for accumulators: the initial value for a
    is 0; the update operation is [add1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._add1%29%29);
    and the base case uses the accumulated knowledge by returning it. Translating
    this into code yields the following skeleton definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (height.v2Â abt0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [Tree](#%28tech._tree%29)  [N](part_two.html#%28tech._n%29)
    -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â measures the height of abt |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  a is the number of steps |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â it takes to reach abt from abt0 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (height/aÂ abtÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â abt)Â a]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (height/aÂ (node-leftÂ abt)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â aÂ 1))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (height/aÂ (node-rightÂ abt)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â aÂ 1))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (height/aÂ abt0Â 0))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: But, in contrast to the first two examples, a is not the final result. In the
    second [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause, the two recursive calls yield two values. The design recipe for structural
    functions dictates that we combine those in order to formulate an answer for this
    case; the dots above indicate that we still need to pick an operation that combines
    these values.
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Tree](#%28tech._tree%29) -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â measures the height of abt0 |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (height.v2Â example)Â 3)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (height.v2Â abt0)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [Tree](#%28tech._tree%29)  [N](part_two.html#%28tech._n%29)
    -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â measures the height of abt |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  a is the number of steps |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â it takes to reach abt from abt0 |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (height/aÂ abtÂ a)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â abt)Â a]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([max](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._max%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (height/aÂ (node-leftÂ abt)Â Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â aÂ 1))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (height/aÂ (node-rightÂ abt)Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â aÂ 1)))])))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (height/aÂ abt0Â 0))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 185: The accumulator-style version of height'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Following the design recipe also tells us that we need to interpret the two
    values to find the appropriate function. According to the purpose statement for
    height/a, the first value is the height of the left subtree, and the second one
    is the height of the right one. Given that we are interested in the height of
    abt itself and that the height is the largest number of steps it takes to reach
    a leaf, we use the [max](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._max%29%29)
    function to pick the proper one; see [figureÂ 185](#%28counter._%28figure._fig~3aheight-accu%29%29)
    for the complete definition.
  prefs: []
  type: TYPE_NORMAL
- en: 'Note on an Alternative Design In addition to counting the number of steps it
    takes to reach a node, an accumulator function could hold on to the largest height
    encountered so far. Here is the accumulator statement for the design idea:'
  prefs: []
  type: TYPE_NORMAL
- en: The first accumulator represents the number of steps it takes to reach abt from
    (the root of) abt0. The second one stands for the height of the part in abt0 that
    is strictly to the left of abt.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Clearly, this statement assumes a template with two accumulator parameters,
    something we have not encountered before:'
  prefs: []
  type: TYPE_NORMAL
- en: '| [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â ;Â [Tree](#%28tech._tree%29)  [N](part_two.html#%28tech._n%29)  [N](part_two.html#%28tech._n%29)
    -> [N](part_two.html#%28tech._n%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ;Â measures the height of abt |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ;Â accumulator  s is the number of steps |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ;Â it takes to reach abt from abt0 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ;Â accumulator  m is the maximal height of |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ;Â the part of abt0 that is to the left of abt |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (h/aÂ abtÂ sÂ m)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â abt)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (h/aÂ (node-leftÂ abt)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  s  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  m  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (h/aÂ (node-rightÂ abt)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  s  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)  m  [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ExerciseÂ 498\. Complete height.v3. Hint The bottom-most tree of [figureÂ 184](#%28counter._%28figure._fig~3asim-bt-ex%29%29)
    contains no subtree to the left of the subtree marked with 1. It contains one
    complete path from root to tree in the part of the tree that is to the left of
    the subtree marked with 2; this path consists of two steps.
  prefs: []
  type: TYPE_NORMAL
- en: This second design has a more complex accumulator invariant than the first one.
    By implication, its implementation requires more care than the first one. At the
    same time, it comes without any obvious advantages.
  prefs: []
  type: TYPE_NORMAL
- en: Our point is that different accumulator invariants yield different variants.
    You can design both variants systematically, following the same design recipe.
    When you have complete function definitions, you can compare and contrast the
    results, and you can then decide which one to keep, based on evidence. End
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 499\. Design an accumulator-style version of product, the function
    that computes the product of a list of numbers. Stop when you have formulated
    the accumulator invariant and have someone check it.
  prefs: []
  type: TYPE_NORMAL
- en: The performance of product is O(n) where n is the length of the list. Does the
    accumulator version improve on this?
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 500\. Design an accumulator-style version of how-many, which is the
    function that determines the number of items on a list. Stop when you have formulated
    the invariant and have someone check it.
  prefs: []
  type: TYPE_NORMAL
- en: The performance of how-many is O(n) where n is the length of the list. Does
    the accumulator version improve on this?
  prefs: []
  type: TYPE_NORMAL
- en: When you evaluate (how-many  some-non-empty-list) by hand, n applications of
    [add1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._add1%29%29)
    are pending by the time the function reaches '()â€”<wbr>where n is the number of
    items on the list. Computer scientists sometime say that how-many needs O(n) space
    to Computer scientists refer to this space as stack space, but you can safely
    ignore this terminology for now. represent these pending function applications.
    Does the accumulator reduce the amount of space needed to compute the result?
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 501\. Design an accumulator-style version of add-to-pi. The function
    adds a natural number to [pi](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._pi%29%29)
    without using [+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [N](part_two.html#%28tech._n%29) -> [Number](part_one.html#%28tech._number%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â adds n to [pi](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._pi%29%29)
    without using [+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-within](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-within%29%29)Â (add-to-piÂ 2)Â ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 2Â [pi](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._pi%29%29))Â 0.001)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (add-to-piÂ n)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([zero?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._zero~3f%29%29)Â n)Â [pi](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._pi%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([add1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._add1%29%29)Â (add-to-piÂ ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n)))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Stop when you have formulated the accumulator invariant and have someone check
    it.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 502\. Design the function palindrome, which accepts a non-empty list
    and constructs a palindrome by mirroring the list around the last item. When given
    ([explode](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._explode%29%29)  "abc"),
    it yields ([explode](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._explode%29%29)  "abcba").
  prefs: []
  type: TYPE_NORMAL
- en: 'Hint Here is a solution designed by function composition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [[NEList-of](part_three.html#%28tech._sim-dd._nelist._of%29)  [1String](part_one.html#%28tech._1string%29)]
    -> [[NEList-of](part_three.html#%28tech._sim-dd._nelist._of%29)  [1String](part_one.html#%28tech._1string%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â creates a palindrome from s0 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â (mirrorÂ ([explode](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._explode%29%29)Â "abc"))Â ([explode](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._explode%29%29)Â "abcba"))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (mirrorÂ s0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29)Â (all-but-lastÂ s0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â (lastÂ s0))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)Â (all-but-lastÂ s0))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'See [Auxiliary Functions that Generalize](part_two.html#%28part._sec~3agen-funcs%29)
    for last; design all-but-last in an analogous manner.This solution traverses s0
    four times:'
  prefs: []
  type: TYPE_NORMAL
- en: via all-but-last,
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: via last,
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: via all-but-last again, and
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: via [reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29),
    which is ISL+â€™s version of invert.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Even with [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    definition for the result of all-but-last, the function needs three traversals.
    While these traversals arenâ€™t â€œstackedâ€ and therefore donâ€™t have a disastrous
    impact on the functionâ€™s performance, an accumulator version can compute the same
    result with a single traversal.ExerciseÂ 503\. [ExerciseÂ 467](part_five.html#%28counter._%28exercise._ex~3atriangulate2%29%29)
    implicitly asks for the design of a function that rotates a [Matrix](part_two.html#%28tech._matrix%29)
    until the first coefficient of the first row differs from 0. In the context of
    [ExerciseÂ 467](part_five.html#%28counter._%28exercise._ex~3atriangulate2%29%29),
    the solution calls for a generative-recursive function that creates a new matrix
    by shifting the first row to the end when it encounters a 0 in the first position.
    Here is the solution:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Matrix](part_two.html#%28tech._matrix%29) -> [Matrix](part_two.html#%28tech._matrix%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â finds a row that doesn''t start with 0 and |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â uses it as the first one |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â generative moves the first row to last place |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â no termination if all rows start with 0 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â ([rotate](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._rotate%29%29)Â ''((0Â 4Â 5)Â (1Â 2Â 3)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ''((1Â 2Â 3)Â (0Â 4Â 5))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ([rotate](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._rotate%29%29)Â M)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([not](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._not%29%29)Â ([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â M))Â 0))Â M]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([rotate](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._rotate%29%29)Â ([append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â M)Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â M))))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Stop! Modify this function so that it signals an error when all rows start
    with 0.If you measure this function on large instances of [Matrix](part_two.html#%28tech._matrix%29),
    you get a surprising result:'
  prefs: []
  type: TYPE_NORMAL
- en: '| rows in M |  | 1000 |  | 2000 |  | 3000 |  | 4000 |  | 5000 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| [rotate](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._rotate%29%29)
    |  | 17 |  | 66 |  | 151 |  | 272 |  | 436 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: As the number of rows increases from 1,000 to 5,000, the time spent by [rotate](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._rotate%29%29)
    does not increase by a factor of five but by twenty.The problem is that [rotate](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._rotate%29%29)
    uses [append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29),
    which makes a brand-new list like ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)  M)
    only to add ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)  M)
    at the end. If M consists of 1,000 rows and the last row is the only one with
    a non-0 coefficient, thatâ€™s roughly
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/2fb2af078d174deda318c344d4f46220.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: 'lists. How many lists do we get if M consists of 5,000 lines?Now suppose we
    conjecture that the accumulator-style version is faster than the generative one.
    Here is the accumulator template for a structurally recursive version of [rotate](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._rotate%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (rotate.v2Â M0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [Matrix](part_two.html#%28tech._matrix%29)  ...
    -> [Matrix](part_two.html#%28tech._matrix%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  ... |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (rotate/aÂ MÂ seen)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â M))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]Â ;Â Can
    this be simplified to ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)  M)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (rotate/aÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â M)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â seenÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (rotate/aÂ M0Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The goal is to remember the first row when its leading coefficient is 0 without
    using [append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29)
    for every recursion.
  prefs: []
  type: TYPE_NORMAL
- en: Formulate an accumulator statement. Then follow the accumulator design recipe
    to complete the above function. Measure how fast it runs on a Matrix that consists
    of rows with leading 0s except for the last one. If you completed the design correctly,
    the function is quite fast.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 504\. Design to10. It consumes a list of digits and produces the corresponding
    number. The first item on the list is the most significant digit. Hence, when
    applied to '(1  0  2), it produces 102.
  prefs: []
  type: TYPE_NORMAL
- en: Domain Knowledge You may recall from grade school that the result is determined
    by ![image](../Images/941ee522b6aef18a6ea41e553835207a.png)
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 505\. Design the function is-prime, which consumes a natural number
    and returns #true if it is prime and #false otherwise.'
  prefs: []
  type: TYPE_NORMAL
- en: Domain Knowledge A number n is prime if it is not divisible by any number between
    n - 1 and 2.
  prefs: []
  type: TYPE_NORMAL
- en: 'Hint The design recipe for [N](part_two.html#%28tech._n%29) [>=1] suggests
    the following template:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [N](part_two.html#%28tech._n%29) [>=1] -> [Boolean](part_one.html#%28tech._boolean%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â determines whether n is a prime number |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (is-prime?Â n)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3d%29%29)Â nÂ 1)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (is-prime?Â ([sub1](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sub1%29%29)Â n))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: This template immediately tells you that the function forgets n, its initial
    argument as it recurs. Since n is definitely needed to determine whether n is
    divisible by ([-](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._-%29%29)  n  1),
    ([-](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._-%29%29)  n  2),
    and so on, you know that you need an accumulator-style function.Note on Speed
    Programmers who encounter accumulator-style functions for the first time often
    get the impression that they are always faster than their plain counterparts.
    So letâ€™s take a look at the solution of [exerciseÂ 497](#%28counter._%28exercise._ex~3atime-factorial%29%29):An
    explanation of these times is beyond the scope of this book.
  prefs: []
  type: TYPE_NORMAL
- en: '| !.v1 |  | 5.760 |  | 5.780 |  | 5.800 |  | 5.820 |  | 5.870 |  | 5.806 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| !.v2 |  | 5.970 |  | 5.940 |  | 5.980 |  | 5.970 |  | 6.690 |  | 6.111 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The tableâ€™s top row shows the number of seconds for five runs of (!.v1  20),
    while the bottom one lists those of running (!.v2  20). The last column shows
    the averages. In short, the table shows that people jump to premature conclusions;
    the performance of at least one accumulator-style function is worse than that
    of the original. Do not trust prejudices. Instead, measure performance characteristics
    of your programs for yourself. End
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 506\. Design an accumulator-style version of [map](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._map%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 507\. [ExerciseÂ 257](part_three.html#%28counter._%28exercise._ex~3adesigning-build-list%29%29)
    explains how to design [foldl](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldl%29%29)
    with the design recipes and guidelines of the first two parts of the book:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (f*ldlÂ [+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 0Â ''(1Â 2Â 3))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([foldl](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldl%29%29)Â [+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â 0Â ''(1Â 2Â 3)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (f*ldlÂ [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ''()Â ''(aÂ bÂ c))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([foldl](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldl%29%29)Â [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ''()Â ''(aÂ bÂ c)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â version 1 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (f*ldlÂ fÂ iÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â fÂ iÂ ([reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)Â l)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'That is, [foldl](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldl%29%29)
    is the result of reversing the given list and then using [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)
    to fold the given function over this intermediate list.The f*ldl function obviously
    traverses the list twice, but once we design all the functions, it becomes clear
    how much harder it has to work:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â version 2 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (f*ldlÂ fÂ iÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ([reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)Â l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â ''()]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (add-to-endÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (add-to-endÂ xÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â x)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (add-to-endÂ xÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â i]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (fÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â ([reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)Â l))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'We know that [reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)
    has to traverse a list once for every item on the list, meaning f*ldl really performs
    ![image](../Images/422fb072e460e041f53e410bfa5af570.png) traversals for a list
    of length n. Fortunately, we know how to eliminate this bottleneck with an accumulator:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â version 3 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (f*ldlÂ fÂ iÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (reverse/aÂ lÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â a]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (reverse/aÂ ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â a))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â i]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (fÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l)))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29)Â (reverse/aÂ lÂ ''()))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Once [reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)
    uses an accumulator, we actually get the apparent performance of two traversals
    of the list. The question is whether we can improve on this by adding an accumulator
    to the locally defined [foldr](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldr%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â version 4 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (f*ldlÂ fÂ iÂ l0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (foldr/aÂ aÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â a]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (foldr/aÂ (fÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â a)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (foldr/aÂ iÂ l0))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Since equipping the function with an accumulator reverses the order in which
    the list is traversed, the initial reversal of the list is superfluous.Task 1
    Recall the signature for [foldl](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldl%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: ;Â [X Y] [X Y -> Y] Y [[List-of](part_three.html#%28tech._sim-dd._list._of%29)
    X] -> Y
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'It is also the signature of f*ldl. Formulate the signature for foldr/a and
    its accumulator invariant. Hint Assume that the difference between l0 and l is
    ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  x1  x2  x3).
    What is a, then?You may also be wondering why foldr/a consumes its arguments in
    this unusual order, first the accumulator and then the list. To understand the
    reason for this ordering, imagine instead that foldr/a also consumes fâ€”<wbr>as
    the first argument. At this point it becomes abundantly clear that foldr/a is
    [foldl](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._foldl%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â version 5 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (f*ldlÂ fÂ iÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â i]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â (f*ldlÂ fÂ (fÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â l)Â i)Â ([rest](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._rest%29%29)Â l))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Task 2 Design build-l*st using an accumulator-style approach. The function
    must satisfy the following tests:'
  prefs: []
  type: TYPE_NORMAL
- en: ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (build-l*stÂ nÂ f)Â ([build-list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._build-list%29%29)Â nÂ f))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: for any natural number n and function f.
  prefs: []
  type: TYPE_NORMAL
- en: 32.4A Graphical Editor, with Mouse[ğŸ”—](#(part._accu-edit._sec~3aedit3) "Link
    to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: '[A Graphical Editor](part_one.html#%28part._sec~3aedit1%29) introduces the
    notion of a one-line editor and presents a number of exercises on creating a graphical
    editor. Recall that a graphical editor is an interactive program that interprets
    key events as editing actions on a string. In particular, when a user presses
    the left or right arrow keys, the cursor moves left or right; similarly, pressing
    the delete key removes a [1String](part_one.html#%28tech._1string%29) from the
    edited text. The editor program uses a data representation that combines two strings
    in a structure. [A Graphical Editor, Revisited](part_two.html#%28part._list-edit2._sec~3aedit2%29)
    resumes these exercises and shows how the same program can greatly benefit from
    a different data structure, one that combines two strings.'
  prefs: []
  type: TYPE_NORMAL
- en: Neither of these sections deals with mouse actions for navigation, even though
    all modern applications support this functionality. The basic difficulty with
    mouse events is to place the cursor at the appropriate spot. Since the program
    deals with a single line of text, a mouse click at (x,y) clearly aims to place
    the cursor between the letters that are visible at or around the x position. This
    section fills the gap.
  prefs: []
  type: TYPE_NORMAL
- en: 'Recall the relevant definitions from [A Graphical Editor, Revisited](part_two.html#%28part._list-edit2._sec~3aedit2%29):'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â FONT-SIZEÂ 11)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â FONT-COLORÂ "black")
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [1String](part_one.html#%28tech._1string%29)]
    -> [Image](part_one.html#%28tech._image%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â renders a string as an image for the editor |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (editor-textÂ s)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([text](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._text%29%29)Â ([implode](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._implode%29%29)Â s)Â FONT-SIZEÂ FONT-COLOR))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â editorÂ [preÂ post])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â An Editor is a structure: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â Â Â (make-editor  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [1String](part_one.html#%28tech._1string%29)]  [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [1String](part_one.html#%28tech._1string%29)])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â interpretation if (make-editor  p  s) is the state of |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â an interactive editor, ([reverse](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._reverse%29%29)  p)
    corresponds to |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â the text to the left of the cursor and s to the |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â text on the right |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ExerciseÂ 508\. Design split-structural using the structural design recipe. The
    function consumes a list of [1String](part_one.html#%28tech._1string%29)s ed and
    a natural number x; the former represents the complete string in some [Editor](#%28tech._accu-edit._editor%29)
    and the latter the x-coordinate of the mouse click. The function produces
  prefs: []
  type: TYPE_NORMAL
- en: (make-editorÂ pÂ s)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'such that (1) p and s make up ed and (2) x is larger than the image of p and
    smaller than the image of p extended with the first [1String](part_one.html#%28tech._1string%29)
    on s (if any).Here is the first condition expressed with an ISL+ expression:'
  prefs: []
  type: TYPE_NORMAL
- en: ([string=?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string~3d~3f%29%29)Â ([string-append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._string-append%29%29)Â pÂ s)Â ed)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The second one is
  prefs: []
  type: TYPE_NORMAL
- en: '| ([<=](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~3c~3d%29%29)Â ([image-width](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._image-width%29%29)Â (editor-textÂ p))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â x |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â ([image-width](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._image-width%29%29)Â (editor-textÂ ([append](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._append%29%29)Â pÂ ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â s)))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: assuming ([cons?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons~3f%29%29)  s).
  prefs: []
  type: TYPE_NORMAL
- en: Hints (1) The x-coordinate measures the distance from the left. Hence the function
    must check whether larger and larger prefixes of ed fit into the given width.
    The first one that doesnâ€™t fit corresponds to the pre field of the desired [Editor](#%28tech._accu-edit._editor%29),
    the remainder of ed to the post field.
  prefs: []
  type: TYPE_NORMAL
- en: (2) Designing this function calls for thoroughly developing examples and tests.
    See [Intervals, Enumerations, and Itemizations](part_one.html#%28part._ch~3aintervals-enums%29).
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 509\. Design the function split. Use the accumulator design recipe
    to improve on the result of [exerciseÂ 508](#%28counter._accu-edit._%28exercise._ex~3aeditor-mouse-structural%29%29).
    After all, the hints already point out that when the function discovers the correct
    split point, it needs both parts of the list, and one part is obviously lost due
    to recursion.
  prefs: []
  type: TYPE_NORMAL
- en: Once you have solved this exercise, equip the main function of [A Graphical
    Editor, Revisited](part_two.html#%28part._list-edit2._sec~3aedit2%29) with a clause
    for mouse clicks. As you experiment with moving the cursor via mouse clicks, you
    will notice that it does not exactly behave like applications that you use on
    your other devicesâ€”<wbr>even though split passes all its tests.
  prefs: []
  type: TYPE_NORMAL
- en: Graphical programs, like editors, call for experimentation to come up with the
    best â€œlook and feelâ€ experiences. In this case, your editor is too simplistic
    with its placement of the cursor. After the applications on your computer determine
    the split point, they also determine which letter division is closer to the x-coordinate
    and place the cursor there.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 510\. Many operating systems come with the fmt program, which can rearrange
    the words in a file so that all lines in the resulting file have a maximal width.
    As a widely used program, fmt supports a range of related functions. This exercise
    focuses on its core functionality.
  prefs: []
  type: TYPE_NORMAL
- en: Design the program fmt. It consumes a natural number w, the name of an input
    file in-f, and the name of an output file out-fâ€”<wbr>in the same sense as [read-file](http://docs.racket-lang.org/teachpack/2htdpbatch-io.html#%28def._%28%28lib._2htdp%2Fbatch-io..rkt%29._read-file%29%29)
    from the 2htdp/batch-io teachpack. Its purpose is to read all the words from the
    in-f, to arrange these words in the given order into lines of maximal width w,
    and to write these lines to out-f.
  prefs: []
  type: TYPE_NORMAL
- en: 33More Uses of Accumulation[ğŸ”—](#(part._ch~3amore-accu) "Link to here")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: This chapter presents three more uses of accumulators. The first section concerns
    the use of accumulators in conjunction with tree-processing functions. It uses
    the compilation of ISL+ as an illustrative example. The second section explains
    why we occasionally want accumulators inside of data representations and how to
    go about placing them there. The final section resumes the discussion of rendering
    fractals.
  prefs: []
  type: TYPE_NORMAL
- en: 33.1Accumulators and Trees[ğŸ”—](#(part._sec~3amore-accu-trees) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: When you ask DrRacket to run an ISL+ program, it translates the program to commands
    for your specific computer. This process is called compilation, and the part of
    DrRacket that performs the task is called a compiler. Before the compiler translates
    the ISL+ program, it checks that every variable is declared via a [define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29),
    a [define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29),
    or a [lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: Stop! Enter x, ([lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)  (y)  x),
    and (x  5) as complete ISL+ programs into DrRacket and ask it to run each. What
    do you expect to see?
  prefs: []
  type: TYPE_NORMAL
- en: 'Letâ€™s phrase this idea as a sample problem:'
  prefs: []
  type: TYPE_NORMAL
- en: Sample Problem You have been hired to re-create a part of the ISL+ compiler.
    Specifically, your task deals with the following language fragment, specified
    in the so-called grammar notation that many programming language manuals use:We
    use the Greek letter Î» instead of [lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29)
    to signal that this exercise deals with ISL+ as an object of study, not just a
    programming language.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Â Â expression | Â  | = | Â  | variable |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  | Â  | &#124; | Â  | ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)Â (variable)Â expression)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  | Â  | &#124; | Â  | (expressionÂ expression) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Remember from intermezzo 1 that you can read the grammar aloud replacing = with
    â€œis one ofâ€ and | with â€œor.â€
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Recall that [Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)
    expressions are functions without names. They bind their parameter in their body.
    Conversely, a variable occurrence is declared by a surrounding [Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)
    that specifies the same name as a parameter. You may wish to revisit [Intermezzo
    3: Scope and Abstraction](i3-4.html) because it deals with the same issue from
    the perspective of a programmer. Look for the terms â€œbinding occurrence,â€ â€œbound
    occurrence,â€ and â€œfree.â€'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Develop a data representation for the above language fragment; use symbols to
    represent variables. Then design a function that replaces all undeclared variables
    with '*undeclared.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'This problem is representative of many steps in the translation process and,
    at the same time, is a great case study for accumulator-style functions.Before
    we dive into the problem, letâ€™s look at some examples in this mini-language, recalling
    what we know about [lambda](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._lambda%29%29):'
  prefs: []
  type: TYPE_NORMAL
- en: ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (x)  x)
    is the function that returns whatever it is given, also known as the identity
    function;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (x)  y)
    looks like a function that returns y whenever it is given an argument, except
    that y isnâ€™t declared;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (y)  ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (x)  y))
    is a function that, when given some value v, produces a function that always returns
    v;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: (([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (x)  x)  ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (x)  x))
    applies the identity function to itself;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: (([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (x)  (x  x))  ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (x)  (x  x)))
    is a short infinite loop; and
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ((([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (y)  ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (x)  y))  ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (z)  z))  ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (w)  w))
    is a complex expression that is best run in ISL+ to find out whether it terminates.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Indeed, you can run all of the above ISL+ expressions in DrRacket to confirm
    what is written about them.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 511\. Explain the scope of each binding occurrence in the above examples.
    Draw arrows from the bound to the binding occurrences.
  prefs: []
  type: TYPE_NORMAL
- en: 'Developing a data representation for the language is easy, especially because
    its description uses a grammar notation. Here is one possibility:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â A Lam is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“ a [Symbol](i2-3.html#%28tech._symbol%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  ''Î»  ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  [Symbol](i2-3.html#%28tech._symbol%29))  [Lam](#%28tech._lam%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)  [Lam](#%28tech._lam%29)  [Lam](#%28tech._lam%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Because of [quote](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29),
    this data representation makes it easy to create data representations for expressions
    in our subset of ISL+:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ex1Â ''(Î»Â (x)Â x))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ex2Â ''(Î»Â (x)Â y))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ex3Â ''(Î»Â (y)Â (Î»Â (x)Â y)))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â ex4Â ''((Î»Â (x)Â (xÂ x))Â (Î»Â (x)Â (xÂ x))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: These four data examples are representations of some of the above expressions.
    Stop! Create data representations for the remaining examples.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 512\. Define is-var?, is-Î»?, and is-app?, that is, predicates that
    distinguish variables from Î» expressions and applications.
  prefs: []
  type: TYPE_NORMAL
- en: Also define
  prefs: []
  type: TYPE_NORMAL
- en: Î»-para, which extracts the parameter from a Î» expression;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Î»-body, which extracts the body from a Î» expression;
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: app-fun, which extracts the function from an application; and
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: app-arg, which extracts the argument from an application.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: With these predicates and selectors, you basically can act as if you had defined
    a structure-oriented data representation.
  prefs: []
  type: TYPE_NORMAL
- en: Design declareds, which produces the list of all symbols used as Î» parameters
    in a Î» term. Donâ€™t worry about duplicate symbols.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 513\. Develop a data representation for the same subset of ISL+ that
    uses structures instead of lists. Also provide data representations for ex1, ex2,
    and ex3 following your data definition.
  prefs: []
  type: TYPE_NORMAL
- en: 'We follow the structural design recipe, and here is the product of steps two
    and three:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Lam](#%28tech._lam%29) -> [Lam](#%28tech._lam%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â replaces all symbols s in le with ''*undeclared |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â if they do not occur within the body of a Î» |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â expression whose parameter is s |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (undeclaredsÂ ex1)Â ex1)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (undeclaredsÂ ex2)Â ''(Î»Â (x)Â *undeclared))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (undeclaredsÂ ex3)Â ex3)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (undeclaredsÂ ex4)Â ex4)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (undeclaredsÂ le0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â le0) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Note how we expect undeclareds to process ex4 even though the expression loops
    forever when run; compilers donâ€™t run programs, they read them and create others.A
    close look at the purpose statement directly suggests that the function needs
    an accumulator. This becomes even clearer when we inspect the template for undeclareds:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (undeclaredsÂ le)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(is-var?Â le)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(is-Î»?Â le)Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (undeclaredsÂ (Î»-bodyÂ le))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(is-app?Â le) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (undeclaredsÂ (app-funÂ le))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (undeclaredsÂ (app-argÂ le))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'When undeclareds recurs on the body of (the representation of) a Î» expression,
    it forgets (Î»-para  le), the declared variable.So, letâ€™s start with an accumulator-style
    template:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (undeclaredsÂ le0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (;Â [Lam](#%28tech._lam%29) ??? -> [Lam](#%28tech._lam%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ;Â accumulator  a represents ... |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (undeclareds/aÂ leÂ a)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â [(is-var?Â le)Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â [(is-Î»?Â le) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (undeclareds/aÂ (Î»-bodyÂ le)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â aÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â [(is-app?Â le) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (undeclareds/aÂ (app-funÂ le)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â aÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â (undeclareds/aÂ (app-argÂ le)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â aÂ [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))])))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (undeclareds/aÂ le0Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'In this context, we can now formulate an accumulator invariant:'
  prefs: []
  type: TYPE_NORMAL
- en: a represents the list of Î» parameters encountered on the path from the top of
    le0 to the top of le.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: For example, if le0 is
  prefs: []
  type: TYPE_NORMAL
- en: '''(((Î»Â (y)Â ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)  (x)  y))Â (Î»Â (z)Â z))Â (Î»Â (w)Â w))'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: and le is the highlighted subtree, then a contains y. The left side of [figureÂ 186](#%28counter._%28figure._fig~3alam-tree%29%29)
    presents a graphical illustration of the same example. It shows a [Lam](#%28tech._lam%29)
    expression as an upside-down tree; that is, the root is at the top. An @ node
    represents an application with two descendants; the other nodes are self-explanatory.
    In this tree diagram, the bold path leads from le0 to le through a single variable
    declaration.Similarly, if we pick a different subtree of the same piece of data,
  prefs: []
  type: TYPE_NORMAL
- en: '''(((Î»Â (y)Â (Î»Â (x)Â y))Â (Î»Â (z)Â z))Â (Î»Â (w)Â w))'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: we get an accumulator that contains both 'y and 'x. The right side of [figureÂ 186](#%28counter._%28figure._fig~3alam-tree%29%29)
    makes this point again. Here the bold path leads through two 'Î» nodes to the boxed
    subtree, and the accumulator is the list of declared variables along the bold
    path.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/89e19d71adf5622a85eebdf60ebc7fae.png) Â Â Â Â Â Â Â Â Â Â  ![image](../Images/94eb3a0d4d95c808454d82af78335146.png)'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 186: [Lam](#%28tech._lam%29) terms as trees'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Now that we have settled on the data representation of the accumulator and
    its invariant, we can resolve the remaining design questions:'
  prefs: []
  type: TYPE_NORMAL
- en: We pick an initial accumulator value of '().
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We use [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)
    to add (Î»-para  le) to a.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We exploit the accumulator for the clause where undeclareds/a deals with a variable.
    Specifically, the function uses the accumulator to check whether the variable
    is in the scope of a declaration.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[FigureÂ 187](#%28counter._%28figure._fig~3aundeclareds%29%29) shows how to
    translate these ideas into a complete function definition. Note the name declareds
    for the accumulator; it brings across the key idea behind the accumulator invariant,
    helping the programmer understand the definition. The base case uses [member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29)
    from ISL+ to determine whether the variable le is in declareds and, if not, replaces
    it with ''*undeclared. The second [cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    clause uses a [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    to introduce the extended accumulator newd. Because para is also used to rebuild
    the expression, it has its own local definition. Finally, the last clause concerns
    function applications, which do not declare variables and do not use any directly.
    As a result, it is by far the simplest of the three clauses.'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Lam](#%28tech._lam%29) -> [Lam](#%28tech._lam%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (undeclaredsÂ le0)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [Lam](#%28tech._lam%29)
    [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [Symbol](i2-3.html#%28tech._symbol%29)]
    -> [Lam](#%28tech._lam%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â accumulator  declareds is a list of all Î» |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â parameters on the path from le0 to le |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (undeclareds/aÂ leÂ declareds)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [(is-var?Â le) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([member?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._member~3f%29%29)Â leÂ declareds)Â leÂ ''*undeclared)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [(is-Î»?Â le) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â paraÂ (Î»-paraÂ le))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â bodyÂ (Î»-bodyÂ le))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â newdÂ ([cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)Â paraÂ declareds)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â ''Î»Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â para)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (undeclareds/aÂ bodyÂ newd)))] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [(is-app?Â le) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â funÂ (app-funÂ le))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â argÂ (app-argÂ le)))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â (undeclareds/aÂ funÂ declareds)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (undeclareds/aÂ argÂ declareds)))]))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (undeclareds/aÂ le0Â ''()))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 187: Finding undeclared variables'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ExerciseÂ 514\. Make up an ISL+ expression in which x occurs both free and bound.
    Formulate it as an element of [Lam](#%28tech._lam%29). Does undeclareds work properly
    on your expression?
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 515\. Consider the following expression:'
  prefs: []
  type: TYPE_NORMAL
- en: ([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)Â (*undeclared)Â (([Î»](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._~ce~bb%29%29)Â (x)Â (xÂ *undeclared))Â y))
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Yes, it uses *undeclared as a variable. Represent it in [Lam](#%28tech._lam%29)
    and check what undeclareds produces for this expression.Modify undeclareds so
    that it replaces a free occurrence of 'x with
  prefs: []
  type: TYPE_NORMAL
- en: ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â '*undeclaredÂ 'x)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: and a bound one 'y with
  prefs: []
  type: TYPE_NORMAL
- en: ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â '*declaredÂ 'y)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Doing so unambiguously identifies problem spots, which a program development
    environment such as DrRacket can use to highlight errors.
  prefs: []
  type: TYPE_NORMAL
- en: Note The trick of replacing a variable occurrence with the representation of
    an application feels awkward. If you dislike it, consider synthesizing the symbols
    '*undeclared:x and 'declared:y instead.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 516\. Redesign the undeclareds function for the structure-based data
    representation from [exerciseÂ 513](#%28counter._%28exercise._ex~3afree-bound-dd0%29%29).
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/735e00896b758e5026c91977c6194f18.png) Â Â Â Â Â Â Â Â Â Â  ![image](../Images/dbf625348840aca6825fb3d8115abae5.png)'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 188: Static distances'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ExerciseÂ 517\. Design static-distance. The function replaces all occurrences
    of variables with a natural number that represents how far away the declaring
    Î» is. [FigureÂ 188](#%28counter._%28figure._fig~3asd%29%29) illustrates the idea
    for the term
  prefs: []
  type: TYPE_NORMAL
- en: '''((Î»Â (x)Â ((Î»Â (y)Â (yÂ x))Â x))Â (Î»Â (z)Â z))'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: in graphical form. It includes dotted arrows that point from variable occurrences
    to the corresponding variable declarations. On the right, the figure shows a tree
    of the same shape, though without the arrows. The 'Î» nodes come without names,
    and variable occurrences have been replaced by natural numbers that specify which
    'Î» declares the variable. Each natural number n says that the binding occurrence
    is n steps upwardâ€”<wbr>toward the root of the [Lam](#%28tech._lam%29) tree. A
    value of 0 denotes the first 'Î» on the path to the root, 1 the second one, and
    so on.
  prefs: []
  type: TYPE_NORMAL
- en: Hint The undeclareds accumulator of undeclareds/a is a list of all parameters
    on path from le to le0 in reverse orderâ€”<wbr>the last one seen is first on the
    list.
  prefs: []
  type: TYPE_NORMAL
- en: 33.2Data Representations with Accumulators[ğŸ”—](#(part._sec~3amore-accu-mc) "Link
    to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'The end of [Intermezzo 5: The Cost of Computation](i5-6.html) explains that
    *SL measures the size of containers, say lists, by traversing them and hints that
    other programming languages use a different,See [Finite State Machines](part_two.html#%28part._sec~3asec-fsm-list%29)
    for an early example of this idea. less expensive way, to compute sizes. In this
    section, we show how to implement this idea with the addition of an accumulator
    to data representations.'
  prefs: []
  type: TYPE_NORMAL
- en: Consider the ubiquitous lists in *SL. All lists are constructed from [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)
    and '(); operations such as [quote](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._quote%29%29)
    and [list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29),
    for example, are merely abbreviations for these two. As [What Is '(), What Is
    cons](part_two.html#%28part._sec~3alists-cons%29) shows, it is also possible to
    mimic lists in BSL with suitable structure type and function definitions.
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â pairÂ [leftÂ right])
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â ConsOrEmpty is one of: |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ''() |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-pair  [Any](part_one.html#%28tech._any%29)  [ConsOrEmpty](part_two.html#%28tech._consorempty%29))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Any](part_one.html#%28tech._any%29)  [ConsOrEmpty](part_two.html#%28tech._consorempty%29)
    -> [ConsOrEmpty](part_two.html#%28tech._consorempty%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (our-consÂ a-valueÂ a-list)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â a-list)Â (make-pairÂ a-valueÂ a-list)]
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(pair?Â a-list)Â (make-pairÂ a-valueÂ a-list)] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â "our-cons:
    ...")])) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [ConsOrEmpty](part_two.html#%28tech._consorempty%29) -> [Any](part_one.html#%28tech._any%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â extracts the left part of the given pair |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (our-firstÂ mimicked-list)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([if](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._if%29%29)Â ([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â mimicked-list)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â "our-first:
    ...") |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â (pair-leftÂ mimicked-list))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 189: An implementation of lists in BSL'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 189](#%28counter._%28figure._fig~3acons-recall%29%29) recalls the basic
    idea. Stop! Can you define our-rest now?'
  prefs: []
  type: TYPE_NORMAL
- en: 'The key insight is that we can add a third field to the structure type definition
    of pair:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define-struct](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define-struct%29%29)Â cpairÂ [countÂ leftÂ right])
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â A [MyList X] is one of: |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  ''() |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â â€“  (make-cpair  (tech  "N")  X  [[MyList](#%28tech._mylist%29)  X]) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â accumulator the count field is the number of cpairs |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'As the accumulator statement says, the extra field is used to keep track of
    the number of cpair instances used to create the list. That is, it remembers a
    fact about the construction of the list. We call this kind of structure field
    a data accumulator.Adding a field to the major list constructor does not come
    for free. To begin with, it requires a change to the checked version of the constructor,
    the one that is actually available to programs:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â data definitions, via a constructor-function |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (our-consÂ fÂ r)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â r)Â (make-cpairÂ 1Â fÂ r)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(cpair?Â r)Â (make-cpairÂ ([+](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._%2B%29%29)Â (cpair-countÂ r)Â 1)Â fÂ r)]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â "our-cons:
    ...")])) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'If the extended list is ''(), count is populated with 1; otherwise, the function
    computes the length from the given cpair.Now the function definition for our-length
    is obvious:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Any](part_one.html#%28tech._any%29) -> [N](part_two.html#%28tech._n%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â how many items does l contain |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (our-lengthÂ l)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [([empty?](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._empty~3f%29%29)Â l)Â 0]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(cpair?Â l)Â (cpair-countÂ l)] |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)Â ([error](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._error%29%29)Â "my-length:
    ...")])) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The function consumes any kind of value. For '() and instances of cpair, it
    produces natural numbers; otherwise it signals an error.
  prefs: []
  type: TYPE_NORMAL
- en: The second problem with the addition of a count field concerns performance.
    Indeed, there are two concerns. On the one hand, every single list construction
    comes with an extra field now, meaning a 33% increase in memory consumption. On
    the other hand, the addition of the field decreases how fast our-cons constructs
    a list. In addition to the check that the extended list is either '() or an instance
    of a cpair, the constructor now computes the size of the list. Although this computation
    consumes a constant amount of time, it is imposed on every single use of our-consâ€”<wbr>and
    just think how many times this book uses [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)
    and does not ever compute how long the resulting list is!
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 518\. Argue that our-cons takes a constant amount of time to compute
    its result, regardless of the size of its input.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 519\. Is it acceptable to impose the extra cost on [cons](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cons%29%29)
    for all programs to turn length into a constant-time function?
  prefs: []
  type: TYPE_NORMAL
- en: While the addition of a count field to lists is questionable, sometimes data
    accumulators play a crucial role in finding a solution. The next example is about
    adding so-called artificial intelligence to a board-game-playing program, and
    its data accumulator is an absolute necessity.
  prefs: []
  type: TYPE_NORMAL
- en: 'As you play board games or solve puzzles, you tend to think about your possible
    moves at every stage. As you get better, you may even imagine the possibilities
    after this first step. The result is a so-called game tree, which is a (part of
    the) tree of all possible moves that the rules allow. Letâ€™s start with a problem:'
  prefs: []
  type: TYPE_NORMAL
- en: Sample Problem Your manager tells you the following story.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: â€œOnce upon a time, three cannibals were guiding three missionaries through a
    jungle. They were on their way to the nearest mission station. After some time,
    they arrived at a wide river, filled with deadly snakes and fish. There was no
    way to cross the river without a boat. Fortunately, they found a rowboat with
    two oars after a short search. Unfortunately, the boat was too small to carry
    all of them. It could barely carry two people at a time. Worse, because of the
    riverâ€™s width someone had to row the boat back.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: â€œSince the missionaries could not trust the cannibals, they had to figure out
    a plan to get all six of them safely across the river. The problem was that these
    cannibals would kill and eat missionaries as soon as there were more cannibals
    than missionaries in some place. Our missionaries had to devise a plan that guaranteed
    that there were never any missionaries in the minority on either side of the river.
    The cannibals, however, could be trusted to cooperate otherwise. Specifically,
    they would not abandon any potential food, just as the missionaries would not
    abandon any potential converts.â€
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: While your manager doesnâ€™t assign any specific design task, he wants to explore
    whether the company can design (and sell) programs that solve such puzzles.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'While puzzles arenâ€™t board games, the program illustrates the idea of game
    trees in the most straightforward manner possible.In principle, it is quite straightforward
    to solve such puzzles by hand. Here is the rough idea. Pick a graphical representation
    of the problem states. Ours consists of a three-part box: the left one represents
    the missionaries and the cannibals; the middle combines the river and the boat;
    and the third part is the right-hand side of the river. Take a look at the following
    representation of the initial state:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/36ce5d209c05eac77e06f51f401fecdd.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: 'Black circles denote missionaries, white circles cannibals. All of them are
    on the left-hand river bank. The boat is also on the left side. Nobody is on the
    right. Here are two more states:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/03b70e631ee82e436f80173725b7a93f.png) Â Â Â Â Â Â Â Â Â Â  ![image](../Images/b0adba1dc1cf2b520af8293777af0edc.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: The first one is the final state, where all people and the boat are on the right
    bank of the river. The second one depicts some intermediate state where two people
    are on the left with the boat and four people are on the right.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/cdee4c80a1a40a9a5efe5183701dac2a.png)'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 190: Creating a game tree'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Now that you have a way to write down the state of the puzzle, you can think
    about the possibilities at each stage. Doing so yields a tree of possible moves.
    [FigureÂ 190](#%28counter._%28figure._fig~3amc-transition%29%29) sketches the first
    two and a half layers in such a tree. The left-most state is the initial one.
    Because the boat can transport at most two people and must be rowed by at least
    one, you have five possibilities to explore: one cannibal rows across; two cannibals
    row across; one missionary and one cannibal go; one missionary crosses; or two
    missionaries do. These possibilities are represented with five arrows going from
    the initial state to five intermediate states.'
  prefs: []
  type: TYPE_NORMAL
- en: 'For each of these five intermediate states, you can play the same game again.
    In [figureÂ 190](#%28counter._%28figure._fig~3amc-transition%29%29) you see how
    the game continues for the middle (third) one of the new states. Because there
    are only two people on the right river bank, you see three possibilities: a cannibal
    goes back, a missionary goes back, or both do. Hence three arrows connect the
    middle state to the three states on the right side of the tree. If you keep drawing
    this tree of possibilities in a systematic manner, you eventually discover the
    final state.'
  prefs: []
  type: TYPE_NORMAL
- en: A second look at [figureÂ 190](#%28counter._%28figure._fig~3amc-transition%29%29)
    reveals two problems with this naive approach to generating the tree of possibilities.
    The first one is the dashed arrow that connects the middle state on the right
    to the initial state. It indicates that rowing back the two people from the right
    to the left gets the puzzle back to its initial state, meaning youâ€™re starting
    over, which is obviously undesirable. The second problem concerns those states
    with a star in the top-right corner. In both cases, there are more white-circle
    cannibals than black-circle missionaries on the left river bank, meaning the cannibals
    would eat the missionaries. Again, the goal is to avoid such states, making these
    moves undesirable.
  prefs: []
  type: TYPE_NORMAL
- en: 'One way to turn this puzzle into a program is to design a function that determines
    whether some final stateâ€”<wbr>here the final stateâ€”<wbr>is reachable from some
    given state. Here is an appropriate function definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [PuzzleState](#%28tech._puzzlestate%29) -> [PuzzleState](#%28tech._puzzlestate%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â is the final state reachable from state0 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â generative creates a tree of possible boat rides |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â termination ??? |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([check-expect](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._check-expect%29%29)Â (solveÂ initial-puzzle)Â final-puzzle)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (solveÂ state0)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)Â (;Â [[List-of](part_three.html#%28tech._sim-dd._list._of%29)  [PuzzleState](#%28tech._puzzlestate%29)]
    -> [PuzzleState](#%28tech._puzzlestate%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ;Â generative generates the successors of los |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (solve*Â los)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [([ormap](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._ormap%29%29)Â final?Â los)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ([first](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._first%29%29)Â ([filter](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._filter%29%29)Â final?Â los))]
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (solve*Â (create-next-statesÂ los))]))) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â (solve*Â ([list](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._list%29%29)Â state0))))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: The auxiliary function uses generative recursion, generating all new possibilities
    given a list of possibilities. If one of the given possibilities is a final state,
    the function returns it.
  prefs: []
  type: TYPE_NORMAL
- en: Clearly, solve is quite generic. As long as you define a collection of PuzzleStates,
    a function for recognizing final states, and a function for creating all â€œsuccessorâ€
    states, solve can work on your puzzle.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 520\. The solve* function generates all states reachable with n boat
    trips before it looks at states that require n + 1 boat trips, even if some of
    those boat trips return to previously encountered states. Because of this systematic
    way of traversing the tree, solve* cannot go into an infinite loop. Why? Terminology
    This way of searching a tree or a graph is dubbed breadth-first search.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 521\. Develop a representation for the states of the missionary-and-cannibal
    puzzle. Like the graphical representation, a data representation must record the
    number of missionaries and cannibals on each side of the river plus the location
    of the boat.
  prefs: []
  type: TYPE_NORMAL
- en: The description of [PuzzleState](#%28tech._puzzlestate%29) calls for a new structure
    type. Represent the above initial, intermediate, and final states in your representation.
  prefs: []
  type: TYPE_NORMAL
- en: Design the function final?, which detects whether in a given state all people
    are on the right river bank.
  prefs: []
  type: TYPE_NORMAL
- en: Design the function render-mc, which maps a state of the missionary-and-cannibal
    puzzle to an image.
  prefs: []
  type: TYPE_NORMAL
- en: The problem is that returning the final state says nothing about how the player
    can get from the initial state to the final one. In other words, create-next-states
    forgets how it gets to the returned states from the given ones. And this situation
    clearly calls for an accumulator, but at the same time, the accumulated knowledge
    is best associated with every individual [PuzzleState](#%28tech._puzzlestate%29),
    not solve* or any other function.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 522\. Modify the representation from [exerciseÂ 521](#%28counter._%28exercise._ex~3amc-state%29%29)
    so that a state records the sequence of states traversed to get there. Use a list
    of states.
  prefs: []
  type: TYPE_NORMAL
- en: Articulate and write down an accumulator statement with the data definition
    that explains the additional field.
  prefs: []
  type: TYPE_NORMAL
- en: Modify final? or render-mc for this representation as needed.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 523\. Design the create-next-states function. It consumes lists of
    missionary-and-cannibal states and generates the list of all those states that
    a boat ride can reach.
  prefs: []
  type: TYPE_NORMAL
- en: Ignore the accumulator in the first draft of create-next-states, but make sure
    that the function does not generate states where the cannibals can eat the missionaries.
  prefs: []
  type: TYPE_NORMAL
- en: For the second design, update the accumulator field in the state structures
    and use it to rule out states that have been encountered on the way to the current
    state.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 524\. Exploit the accumulator-oriented data representation to modify
    solve. The revised function produces the list of states that lead from the initial
    [PuzzleState](#%28tech._puzzlestate%29) to the final one.
  prefs: []
  type: TYPE_NORMAL
- en: Also consider creating a movie from this list, using render-mc to generate the
    images. Use [run-movie](http://docs.racket-lang.org/teachpack/2htdpuniverse.html#%28def._%28%28lib._2htdp%2Funiverse..rkt%29._run-movie%29%29)
    to display the movie.
  prefs: []
  type: TYPE_NORMAL
- en: 33.3Accumulators as Results[ğŸ”—](#(part._sec~3afractal-acc) "Link to here")
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Take another look at [figureÂ 156](part_five.html#%28counter._%28figure._fig~3asiepic%29%29).
    It displays a Sierpinski triangle and a suggestion how to create it. Specifically,
    the images on the right explain one version of the generative idea behind the
    process:'
  prefs: []
  type: TYPE_NORMAL
- en: The given problem is a triangle. When the triangle is too small to be subdivided
    any further, the algorithm does nothing; otherwise, it finds the midpoints of
    its three sides and deals with the three outer triangles recursively.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'In contrast, [Fractals, a First Taste](part_five.html#%28part._sec~3afractal%29)
    shows how to compose Sierpinski triangles algebraically, a process that does not
    correspond to this description.Most programmers expect â€œdrawâ€ to mean the action
    of adding a triangle to some canvas. The [scene+line](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._scene%2Bline%29%29)
    function from the 2htdp/image teachpack makes this idea concrete. The function
    consumes an image s and the coordinates of two points and adds a line through
    these two points to s. It is easy to generalize from [scene+line](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._scene%2Bline%29%29)
    to add-triangle and from there to add-sierpinski:'
  prefs: []
  type: TYPE_NORMAL
- en: Sample Problem Design the add-sierpinski function. It consumes an image and
    three [Posn](part_one.html#%28tech._posn%29)s describing a triangle. It uses the
    latter to add a Sierpinski triangle to this image.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Note how this problem implicitly refers to the above process description of
    how to draw a Sierpinski triangle. In other words, we are confronted with a classical
    generative-recursive problem, and we can start with the classic template of generative
    recursion and the four central design questions:'
  prefs: []
  type: TYPE_NORMAL
- en: The problem is trivial if the triangle is too small to be subdivided.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the trivial case, the function returns the given image.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Otherwise the midpoints of the sides of the given triangle are determined to
    add another triangle. Each â€œouterâ€ triangle is then processed recursively.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Each of these recursive steps produces an image. The remaining question is how
    to combine these images.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '| ;Â [Image](part_one.html#%28tech._image%29)  [Posn](part_one.html#%28tech._posn%29)  [Posn](part_one.html#%28tech._posn%29)  [Posn](part_one.html#%28tech._posn%29)
    -> [Image](part_one.html#%28tech._image%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â generative adds the triangle (a, b, c) to scene0, |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â subdivides it into three triangles by taking the |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â midpoints of its sides; stop if (a, b, c) is too small |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (add-sierpinskiÂ scene0Â aÂ bÂ c)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(too-small?Â aÂ bÂ c)Â scene0] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â scene1Â (add-triangleÂ scene0Â aÂ bÂ c))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â mid-a-bÂ (mid-pointÂ aÂ b))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â mid-b-cÂ (mid-pointÂ bÂ c))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â mid-c-aÂ (mid-pointÂ cÂ a))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â scene2
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â (add-sierpinskiÂ scene0Â aÂ mid-a-bÂ mid-c-a)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â scene3
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â (add-sierpinskiÂ scene0Â bÂ mid-b-cÂ mid-a-b)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â scene4
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â (add-sierpinskiÂ scene0Â cÂ mid-c-aÂ mid-b-c))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â ;Â â€”<wbr>INâ€”<wbr> |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â ([...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â scene1Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â scene2Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â scene3Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)Â scene4Â [...](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._......%29%29)))]))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 191: Accumulators as results of generative recursions, a skeleton'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 191](#%28counter._%28figure._fig~3aaccu-result-gen-temp%29%29) shows
    the result of translating these answers into a skeletal definition. Since each
    midpoint is used twice, the skeleton uses [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    to formulate the generative step in ISL+. The [local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    expression introduces the three new midpoints plus three recursive applications
    of add-sierpinski. The dots in its body suggest a combination of the scenes.'
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 525\. Tackle the wish list that the skeleton implies:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ;Â [Image](part_one.html#%28tech._image%29)  [Posn](part_one.html#%28tech._posn%29)  [Posn](part_one.html#%28tech._posn%29)  [Posn](part_one.html#%28tech._posn%29)
    -> [Image](part_one.html#%28tech._image%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â adds the black triangle a, b, c to scene |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (add-triangleÂ sceneÂ aÂ bÂ c)Â scene)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Posn](part_one.html#%28tech._posn%29)  [Posn](part_one.html#%28tech._posn%29)  [Posn](part_one.html#%28tech._posn%29)
    -> [Boolean](part_one.html#%28tech._boolean%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â is the triangle a, b, c too small to be divided |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (too-small?Â aÂ bÂ c)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â #false) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Posn](part_one.html#%28tech._posn%29)  [Posn](part_one.html#%28tech._posn%29)
    -> [Posn](part_one.html#%28tech._posn%29) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â determines the midpoint between a and b |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (mid-pointÂ aÂ b)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â a) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Design the three functions.Domain Knowledge (1) For the too-small? function
    it suffices to measure the distance between two points and to check whether it
    is below some chosen threshold, say, 10. The distance between (x0,y0) and (x1,y1)
    is
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/e473201e23ca706b362f0456082e7526.png)'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
- en: 'that is, the distance of (x0 - x1,y0 - y1) to the origin.The midpoint between
    points (x0,y0) and (x1,y1) has as coordinates the midpoints between the respective
    x and y coordinates:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/fbc2f920c401a734278b66b3cc046476.png)'
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
- en: Now that we have all the auxiliary functions, it is time to return to the problem
    of combining the three images that are created by the recursive calls. One obvious
    guess is to use the [overlay](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._overlay%29%29)
    or [underlay](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._underlay%29%29)
    function, but an evaluation in the interactions area of DrRacket shows that the
    functions hide the underlying triangles.
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifically, imagine that the three recursive calls produce the following
    empty scenes, enriched with a single triangle in appropriate locations:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > scene1 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ![image](../Images/87997ab0a2bc2ea2207b725605d91a55.png) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > scene2 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ![image](../Images/3890e223b247c3923e838413e9946216.png) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > scene3 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ![image](../Images/b7f6bcce10ac2315564326213b579f87.png) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'A combination should look like this figure:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/2a40a7e927ca2cf8eed7203859dca0dd.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: 'But, combining these shapes with [overlay](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._overlay%29%29)
    or [underlay](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._underlay%29%29)
    does not yield this desired shape:'
  prefs: []
  type: TYPE_NORMAL
- en: '| > ([overlay](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._overlay%29%29)Â scene1Â scene2Â scene3)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ![image](../Images/a8faf7e616cc6875b66ce4a83be10702.png) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| > ([underlay](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._underlay%29%29)Â scene1Â scene2Â scene3)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ![image](../Images/359554a49be6b3eee2e2218bcd20d7aa.png) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Indeed, the image teachpack of ISL+ does not support a function that combines
    these scenes in an appropriate manner.Letâ€™s take a second look at these interactions.
    If scene1 is the result of adding the upper triangle to the given scene and scene2
    is the result of adding a triangle on the lower left, perhaps the second recursive
    call should add triangles to the result of the first call. Doing so would yield
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/5e832ee0c3f0edbce2551442ff4e209b.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: 'and handing over this scene to the third recursive call produces exactly what
    is wanted:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/26e093371fb9d91e72553444ed02d45a.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: '| ;Â [Image](part_one.html#%28tech._image%29)  [Posn](part_one.html#%28tech._posn%29)  [Posn](part_one.html#%28tech._posn%29)  [Posn](part_one.html#%28tech._posn%29)
    -> [Image](part_one.html#%28tech._image%29) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â generative adds the triangle (a, b, c) to scene0, |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â subdivides it into three triangles by taking the |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â midpoints of its sides; stop if (a, b, c) is too small |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â accumulator the function accumulates the triangles of scene0 |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (add-sierpinskiÂ scene0Â aÂ bÂ c)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([cond](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cond%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [(too-small?Â aÂ bÂ c)Â scene0] |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â [[else](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._else%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â ([local](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._local%29%29)
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â (([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â scene1Â (add-triangleÂ scene0Â aÂ bÂ c))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â mid-a-bÂ (mid-pointÂ aÂ b))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â mid-b-cÂ (mid-pointÂ bÂ c))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â mid-c-aÂ (mid-pointÂ cÂ a))
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â scene2
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â (add-sierpinskiÂ scene1Â aÂ mid-a-bÂ mid-c-a)) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â scene3
    |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â Â Â Â (add-sierpinskiÂ scene2Â bÂ mid-b-cÂ mid-a-b))) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â ;Â â€”<wbr>INâ€”<wbr> |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â Â Â Â Â Â (add-sierpinskiÂ scene3Â cÂ mid-c-aÂ mid-b-c))])) |'
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_TB
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'FigureÂ 192: Accumulators as results of generative recursion, the function'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[FigureÂ 192](#%28counter._%28figure._fig~3aadd-sierpinski%29%29) shows the
    reformulation based on this insight. The three highlights pinpoint the key design
    idea. All concern the case when the triangle is sufficiently large and it is added
    to the given scene. Once its sides are subdivided, the first outer triangle is
    recursively processed using scene1, the result of adding the given triangle. Similarly,
    the result of this first recursion, dubbed scene2, is used for the second recursion,
    which is about processing the second triangle. Finally, scene3 flows into the
    third recursive call. In sum, the novelty is that the accumulator is simultaneously
    an argument, a tool for collecting knowledge, and the result of the function.'
  prefs: []
  type: TYPE_NORMAL
- en: 'To explore add-sierpinski it is best to start from an equilateral triangle
    and an image that leaves a sufficiently large border. Here are definitions that
    meet these two criteria:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â MTÂ ([empty-scene](http://docs.racket-lang.org/teachpack/2htdpimage.html#%28def._%28%28lib._2htdp%2Fimage..rkt%29._empty-scene%29%29)Â 400Â 400))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â AÂ ([make-posn](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._make-posn%29%29)Â 200Â Â 50))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â BÂ ([make-posn](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._make-posn%29%29)Â Â 27Â 350))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â CÂ ([make-posn](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._make-posn%29%29)Â 373Â 350))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| (add-sierpinskiÂ MTÂ AÂ BÂ C) |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: Check what kind of Sierpinski fractal this code fragment delivers. Experiment
    with the definitions from [exerciseÂ 525](#%28counter._%28exercise._ex~3asierpinski-aux%29%29)
    to create sparser and denser Sierpinski triangles than the first one.
  prefs: []
  type: TYPE_NORMAL
- en: ExerciseÂ 526\. To compute the endpoints of an equilateral Sierpinski triangle,
    draw a circle and pick three points on the circle that are 120 degrees apart,
    for example, 120, 240, and 360.
  prefs: []
  type: TYPE_NORMAL
- en: 'Design the function circle-pt:'
  prefs: []
  type: TYPE_NORMAL
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â CENTERÂ ([make-posn](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._make-posn%29%29)Â 200Â 200))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â RADIUSÂ 200)Â ;Â the
    radius in pixels |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â [Number](part_one.html#%28tech._number%29) -> [Posn](part_one.html#%28tech._posn%29)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â determines the point on the circle with CENTER |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â and RADIUS whose angle is |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â examples |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â what are the x and y coordinates of the desired |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ;Â point, when given: 120/360, 240/360, 360/360 |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â  |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| ([define](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28form._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._define%29%29)Â (circle-ptÂ factor)
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: '| Â Â ([make-posn](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._make-posn%29%29)Â 0Â 0))
    |'
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: 'Domain Knowledge This design problem calls on knowledge from mathematics. One
    way to view the problem is as a conversion of a complex number from the polar-coordinate
    representation to the [Posn](part_one.html#%28tech._posn%29) representation. Read
    up on [make-polar](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._make-polar%29%29),
    [real-part](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._real-part%29%29),
    and [imag-part](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._imag-part%29%29)
    in ISL+. Another way is to use trigonometry, [sin](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._sin%29%29)
    and [cos](http://docs.racket-lang.org/htdp-langs/intermediate-lam.html#%28def._htdp-intermediate-lambda._%28%28lib._lang%2Fhtdp-intermediate-lambda..rkt%29._cos%29%29),
    to determine the coordinates. If you choose this route, recall that these trigonometry
    functions compute the sine and cosine in terms of radians, not degrees. Also keep
    in mind that on-screen positions grow downward, not upward.ExerciseÂ 527\. Take
    a look at the following two images:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/06653346cf054b21dc3fe405ccd97794.png)Â Â Â Â Â Â Â Â Â Â ![image](../Images/e9ddac8b628a7fa6554a6dd069139e3f.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: They demonstrate how to generate a fractal Savannah tree in the same way that
    [figureÂ 156](part_five.html#%28counter._%28figure._fig~3asiepic%29%29) shows how
    to draw a Sierpinski triangle. The image on the left shows what a fractal Savannah
    tree looks like. The right one explains the generative construction step.
  prefs: []
  type: TYPE_NORMAL
- en: 'Design the function add-savannah. The function consumes an image and four numbers:
    (1) the x-coordinate of a lineâ€™s base point, (2) the y-coordinate of a lineâ€™s
    base point, (3) the length of the line, and (4) the angle of the line. It adds
    a fractal Savannah tree to the given image.'
  prefs: []
  type: TYPE_NORMAL
- en: Unless the line is too short, the function adds the specified line to the image.
    It then divides the line into three segments. It recursively uses the two intermediate
    points as the new starting points for two lines. The lengths and the angles of
    the two branches change in a fixed manner, but independently of each other. Use
    constants to define these changes and work with them until you like your tree
    well enough.
  prefs: []
  type: TYPE_NORMAL
- en: Hint Experiment with shortening each left branch by at least one third and rotating
    it left by at least 0.15 degrees. For each right branch, shorten it by at least
    20% and rotate it by 0.2 degrees in the opposite direction.
  prefs: []
  type: TYPE_NORMAL
- en: 'ExerciseÂ 528\. Graphics programmers often need to connect two points with a
    smooth curve where â€œsmoothâ€ is relative to some perspective.GÃ©raldine Morin suggested
    this exercise. Here are two sketches:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/03e0f9fe2c7f320b6d6f9887cd2a3247.png)Â Â Â Â Â Â Â Â Â Â ![image](../Images/f5f3344e6fdbd749f45017a3122cd0cb.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: 'The left one shows a smooth curve, connecting points A and C; the right one
    supplies the perspective point, B, and the angle of an observer.One method for
    drawing such curves is due to BÃ©zier. It is a prime example of generative recursion,
    and the following sequence explains the eureka! behind the algorithm:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../Images/3ea5ad1c68940e922a8a902a41871aea.png)Â Â ![image](../Images/7f5a5777c79d9992bcf9e8a458e8df9d.png)Â Â ![image](../Images/283c9ed97f1b9d4f0658106c069b2895.png)'
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: Consider the image on the left. It reminds you that the three given points determine
    a triangle and that the connection from A to C is the focal point of the algorithm.
    The goal is to pull the line from A to C toward B so that it turns into a smooth
    curve.
  prefs: []
  type: TYPE_NORMAL
- en: Now turn to the image in the middle. It explains the essential idea of the generative
    step. The algorithm determines the midpoint on the two observer lines, A-B and
    B-C, as well as their midpoint, A-B-C.
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, the right-most image shows how these three new points generate two
    distinct recursive calls: one deals with the new triangle on the left and the
    other one with the triangle on the right. More precisely, A-B and B-C become the
    new observer points and the lines from A to A-B-C and from C to A-B-C become the
    foci of the two recursive calls.'
  prefs: []
  type: TYPE_NORMAL
- en: When the triangle is small enough, we have a trivially solvable case. The algorithm
    just draws the triangle, and it appears as a point on the given image. As you
    implement this algorithm, you need to experiment with the notion of â€œsmall enoughâ€
    to make the curve look smooth.
  prefs: []
  type: TYPE_NORMAL
- en: 34Summary[ğŸ”—](#(part._ch~3asummary6) "Link to here")
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This last part is about designing with accumulators, a mechanism for collecting
    knowledge during a data structure traversal. Adding an accumulator can fix performance
    flaws and eliminate termination problems. Your takeaway from this part are two
    and a half design lessons:'
  prefs: []
  type: TYPE_NORMAL
- en: The first step is to recognize the need for introducing an accumulator. Traversals
    â€œforgetâ€ pieces of the argument when they step from one piece to the next. If
    you discover that such knowledge could simplify the functionâ€™s design, consider
    introducing an accumulator. The first step is to switch to the accumulator template.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The key step is to formulate an accumulator statement. The latter must express
    what knowledge the accumulator gathers as what kind of data. In most cases, the
    accumulator statement describes the difference between the original argument and
    the current one.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The third step, a minor one, is to deduce from the accumulator statement (a)
    what the initial accumulator value is, (b) how to maintain it during traversal
    steps, and (c) how to exploit its knowledge.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The idea of accumulating knowledge is ubiquitous, and it appears in many different
    forms and shapes. It is widely used in so-called functional languages like ISL+.
    Programmers using imperative languages encounter accumulators in a different way,
    mostly via assignment statements in primitive looping constructs because the latter
    cannot return values. Designing such imperative accumulator programs proceeds
    just like the design of accumulator functions here, but the details are beyond
    the scope of this first book on systematic program design.
  prefs: []
  type: TYPE_NORMAL
