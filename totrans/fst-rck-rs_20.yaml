- en: There Can Be Only One
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://freddiehaddad.github.io/fast-track-to-rust/there_can_be_only_one.html](https://freddiehaddad.github.io/fast-track-to-rust/there_can_be_only_one.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Currently, our entire rustle program is contained within the `main` function.
    This approach was chosen to address the challenges of teaching a course in a way
    that introduces important concepts logically and in an easily digestible manner.
    However, the time has come to refactor some of the code from the `main` function
    into separate functions.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s start by creating a function to handle the work of finding all the lines
    in the input that contain the specified pattern. Here is the function signature:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'This is the code that we''ll transfer into the new function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Here is the revised code with the changes implemented. Review it and run the
    code.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '[Uh-oh!](#uh-oh)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'A minor code change caused an issue with the program. Fortunately, the Rust
    compiler offers helpful information for diagnosing the problem. However, if you''re
    not familiar with Rust''s ownership rules, understanding this error can be challenging.
    Let''s break down the error and understand what went wrong. Here are the key details
    from the error message, cleaned up for readability:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '[Unpacking the Error](#unpacking-the-error)'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Copy trait, value moved, value borrowed. What the heck does all this mean?
  prefs: []
  type: TYPE_NORMAL
- en: '[Copy Trait](#copy-trait)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: We'll explore [traits](https://doc.rust-lang.org/book/ch10-02-traits.html) in
    more detail later in the course. For now, just know that when a type implements
    the [`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html) trait, its
    values are duplicated when assigned to a new variable. This means that after an
    assignment, both the original and the new variable can be used independently.
  prefs: []
  type: TYPE_NORMAL
- en: The `lines` vector we passed to the `find_matching_lines` function does *not*
    implement the [`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html) trait.
  prefs: []
  type: TYPE_NORMAL
- en: '[Value Moved](#value-moved)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: By default, variable bindings in Rust follow *move semantics*.^([1](#footnote-1))
    When a value is *moved*, its ownership is transferred to the new variable, rendering
    the original variable invalid and unusable.
  prefs: []
  type: TYPE_NORMAL
- en: Since the `lines` vector does not implement the [`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html)
    trait, its value was *moved*, rendering the original value in *main* invalid.
  prefs: []
  type: TYPE_NORMAL
- en: '[Value Borrowed](#value-borrowed)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Because the `lines` variable in `main` becomes invalid due to the *move*, any
    attempt to [*borrow*](https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html#references-and-borrowing)
    or reference its value is invalid. This is why the compiler generates the message
    "value borrowed here after move".
  prefs: []
  type: TYPE_NORMAL
- en: Move Semantics
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Rust's move semantics play an integral part in ensuring memory safety by detecting
    common memory-related errors, like null pointer dereferencing, buffer overflows,
    and use-after-free, during compile time, thereby preventing them from happening
    at runtime.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: There are some exceptions in Rust. For example, most primitive types implement
    the [`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html) trait. [↩](#fr-1-1)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
