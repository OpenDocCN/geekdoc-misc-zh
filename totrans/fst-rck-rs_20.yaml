- en: There Can Be Only One
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 只能有一个
- en: 原文：[https://freddiehaddad.github.io/fast-track-to-rust/there_can_be_only_one.html](https://freddiehaddad.github.io/fast-track-to-rust/there_can_be_only_one.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://freddiehaddad.github.io/fast-track-to-rust/there_can_be_only_one.html](https://freddiehaddad.github.io/fast-track-to-rust/there_can_be_only_one.html)
- en: Currently, our entire rustle program is contained within the `main` function.
    This approach was chosen to address the challenges of teaching a course in a way
    that introduces important concepts logically and in an easily digestible manner.
    However, the time has come to refactor some of the code from the `main` function
    into separate functions.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，我们的整个rustle程序都包含在`main`函数中。这种做法是为了以逻辑顺序和易于理解的方式介绍重要概念来应对课程教学中的挑战。然而，现在是时候将`main`函数中的某些代码重构为单独的函数了。
- en: 'Let''s start by creating a function to handle the work of finding all the lines
    in the input that contain the specified pattern. Here is the function signature:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们先创建一个函数来处理查找输入中包含指定模式的所有行的任务。以下是函数签名：
- en: '[PRE0]'
  id: totrans-4
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'This is the code that we''ll transfer into the new function:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们将转移到新函数中的代码：
- en: '[PRE1]'
  id: totrans-6
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Here is the revised code with the changes implemented. Review it and run the
    code.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 这是经过更改后实现的修订代码。请审查它并运行代码。
- en: '[PRE2]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '[Uh-oh!](#uh-oh)'
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[哎呀！](#uh-oh)'
- en: 'A minor code change caused an issue with the program. Fortunately, the Rust
    compiler offers helpful information for diagnosing the problem. However, if you''re
    not familiar with Rust''s ownership rules, understanding this error can be challenging.
    Let''s break down the error and understand what went wrong. Here are the key details
    from the error message, cleaned up for readability:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 一处微小的代码更改导致程序出现问题。幸运的是，Rust编译器提供了有用的信息来诊断问题。然而，如果你不熟悉Rust的所有权规则，理解这个错误可能会很具挑战性。让我们分解错误并了解出了什么问题。以下是错误消息中的关键细节，经过整理以提高可读性：
- en: '[PRE3]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[Unpacking the Error](#unpacking-the-error)'
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[错误解包](#unpacking-the-error)'
- en: Copy trait, value moved, value borrowed. What the heck does all this mean?
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 复制特质，值移动，值借用。这一切究竟是什么意思？
- en: '[Copy Trait](#copy-trait)'
  id: totrans-14
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[复制特质](#copy-trait)'
- en: We'll explore [traits](https://doc.rust-lang.org/book/ch10-02-traits.html) in
    more detail later in the course. For now, just know that when a type implements
    the [`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html) trait, its
    values are duplicated when assigned to a new variable. This means that after an
    assignment, both the original and the new variable can be used independently.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在课程的后半部分更详细地探讨[特质](https://doc.rust-lang.org/book/ch10-02-traits.html)。现在，只需知道当一个类型实现了`[`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html)`特质时，其值在赋值给新变量时会被复制。这意味着赋值之后，原始变量和新变量都可以独立使用。
- en: The `lines` vector we passed to the `find_matching_lines` function does *not*
    implement the [`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html) trait.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 我们传递给`find_matching_lines`函数的`lines`向量*没有*实现`[`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html)`特质。
- en: '[Value Moved](#value-moved)'
  id: totrans-17
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[值移动](#value-moved)'
- en: By default, variable bindings in Rust follow *move semantics*.^([1](#footnote-1))
    When a value is *moved*, its ownership is transferred to the new variable, rendering
    the original variable invalid and unusable.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Rust中的变量绑定遵循*移动语义*。[1](#footnote-1) 当一个值被*移动*时，其所有权转移到新变量，使原始变量无效且不可用。
- en: Since the `lines` vector does not implement the [`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html)
    trait, its value was *moved*, rendering the original value in *main* invalid.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 由于`lines`向量没有实现`[`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html)`特质，其值被*移动*，导致`main`中的原始值无效。
- en: '[Value Borrowed](#value-borrowed)'
  id: totrans-20
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[值借用](#value-borrowed)'
- en: Because the `lines` variable in `main` becomes invalid due to the *move*, any
    attempt to [*borrow*](https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html#references-and-borrowing)
    or reference its value is invalid. This is why the compiler generates the message
    "value borrowed here after move".
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 由于`main`中的`lines`变量因*移动*而变得无效，因此任何尝试[*借用*](https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html#references-and-borrowing)或引用其值的尝试都是无效的。这就是为什么编译器会生成“移动后在此处借用值”的消息。
- en: Move Semantics
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 移动语义
- en: ''
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Rust's move semantics play an integral part in ensuring memory safety by detecting
    common memory-related errors, like null pointer dereferencing, buffer overflows,
    and use-after-free, during compile time, thereby preventing them from happening
    at runtime.
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: Rust的移动语义在编译时检测常见的内存相关错误，如空指针解引用、缓冲区溢出和使用后释放，从而在确保内存安全方面发挥着重要作用。因此，它防止这些错误在运行时发生。
- en: '* * *'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: There are some exceptions in Rust. For example, most primitive types implement
    the [`Copy`](https://doc.rust-lang.org/std/marker/trait.Copy.html) trait. [↩](#fr-1-1)
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Rust 中有一些例外。例如，大多数原始类型实现了 `Copy` [↩](#fr-1-1) 特性。
