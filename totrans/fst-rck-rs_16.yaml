- en: Closures
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://freddiehaddad.github.io/fast-track-to-rust/closures.html](https://freddiehaddad.github.io/fast-track-to-rust/closures.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In Rust, [closures](https://doc.rust-lang.org/book/ch13-01-closures.html) are
    functions that can capture their surrounding environment, clearly express the
    programmer's intent, and achieve this with low-level performance. They are quite
    common in functional programming languages.
  prefs: []
  type: TYPE_NORMAL
- en: 'Closures in Rust have some distinct characteristics:'
  prefs: []
  type: TYPE_NORMAL
- en: Parameters are enclosed with `||` instead of `()`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Curly braces `{}` around the function body are optional for single-line expressions.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Returning to our Loop](#returning-to-our-loop)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: fn main() {
  prefs: []
  type: TYPE_NORMAL
- en: let pattern = "him";
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: let poem = "I have a little shadow that goes in and out with me,
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: And what can be the use of him is more than I can see.
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: He is very, very like me from the heels up to the head;
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: And I see him jump before me, when I jump into my bed.
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: The funniest thing about him is the way he likes to grow -
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: Not at all like proper children, which is always very slow;
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: For he sometimes shoots up taller like an india-rubber ball,
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: And he sometimes gets so little that there's none of him at all.";
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: for (line_no, line) in
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: poem.lines()
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: .enumerate()
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: .filter_map(|(i, line)| match line.contains(pattern) {
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: true => Some((i + 1, line)),
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: false => None,
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: '})'
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: '{'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'println!("{line_no}: {line}");'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: '}'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '}'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'In the code snippet, the closure is:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '[`filter_map`](#filter_map)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The [`filter_map`](https://doc.rust-lang.org/std/iter/struct.FilterMap.html)
    ^([1](#footnote-1)) function creates an iterator that both filters and maps. It
    calls a closure and filters out the results that are `None`, leaving us with an
    iterator of tuples containing the line number and line for all matches of our
    pattern. When the `for` loop consumes the iterator, we only need to print the
    results, as we are left with only the lines that contained the pattern!
  prefs: []
  type: TYPE_NORMAL
- en: Recall that `enumerate` returns an iterator of `tuple`s. `filter_map` receives
    the `tuple` as the argument to the closure.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Exercise](#exercise)'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Replace `filter_map` with `map` and `filter` to achieve the same output. Notice
    how `filter_map` results in more efficient and concise code.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: <details><summary>Solution</summary>
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: fn main() {
  prefs: []
  type: TYPE_NORMAL
- en: let pattern = "him";
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: let poem = "I have a little shadow that goes in and out with me,
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: And what can be the use of him is more than I can see.
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: He is very, very like me from the heels up to the head;
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: And I see him jump before me, when I jump into my bed.
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: The funniest thing about him is the way he likes to grow -
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: Not at all like proper children, which is always very slow;
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: For he sometimes shoots up taller like an india-rubber ball,
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: And he sometimes gets so little that there's none of him at all.";
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: for (line_no, line) in poem
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: .lines()
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: .enumerate()
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: .map(|(i, line)| (i + 1, line))
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: .filter(|(_line_no, line)| line.contains(pattern))
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: '{'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'println!("{line_no}: {line}");'
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
- en: '}'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '}'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: The underscore `_` prefix in `_line_no` is how we tell the Rust compiler that
    we are intentionally ignoring the first argument. Without it the compiler will
    complain.</details>
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Summary](#summary)'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this section we:'
  prefs: []
  type: TYPE_NORMAL
- en: introduced the `Option` `enum`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: learned about closures
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: worked with iterators
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: learned about the `mut` keyword
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Next](#next)'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Onward to collections!
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: Separate `filter` and `map` iterators also exist. [↩](#fr-1-1)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
