# 命令行基础知识

# 命令行基础知识

curl 最初是作为一个命令行工具启动的，多年来已经被成千上万的用户从 shell 提示符和脚本中调用。curl 已经确立了自己作为一种可靠工具的地位，它会在那里帮助你完成工作。

## 二进制文件和不同的平台

命令行工具 "curl" 是一个二进制可执行文件。curl 项目本身不会分发或提供二进制文件。二进制文件高度特定于系统，并且通常也与特定的系统版本绑定在一起。

要获得适用于你的平台和系统的 curl，你需要从某个地方获取一个 curl 可执行文件。许多人通过使用 curl 项目提供的源代码构建自己的版本，许多人使用操作系统的包工具安装它，还有一部分用户从他们信任的源下载二进制安装包。

无论你如何做，请确保从可信任的源获取你的版本，并验证数字签名或包的其他验证方式的真实性。

此外，请记住，curl 通常是构建为使用第三方库执行任务的，除非 curl 被构建为静态使用这些库，否则你必须也安装这些第三方库；精确的库集合将取决于你所获得的特定构建版本。

## 命令行、引号和别名

有许多不同的命令行、shell 和提示符可以使用 curl。它们都有自己的限制、规则和指南要遵循。curl 工具被设计为能够在任何情况下都能正常工作，但在某些情况下，你的特定命令行系统可能与其他人使用的或者其他文档记录的不匹配。

命令行系统之间的一个差异，例如，是如何在参数周围放置引号，以嵌入空格或特殊符号。在大多数类 Unix 的 shell 中，你可以使用双引号 (") 和单引号 (')，具体取决于你是否想在引号字符串中允许变量扩展，但在 Windows 上，没有对单引号版本的支持。

在一些环境中，比如在 Windows 上的 PowerShell 中，命令行系统的作者决定他们更清楚，并在用户输入 `curl` 时“帮助”用户使用另一个工具，提供一个在执行命令行时优先的别名。为了在 PowerShell 中正确使用 curl，你需要输入其完整的名称，包括扩展名：“curl.exe”。

不同的命令行环境也会有不同的最大命令行长度，并强制用户限制可以放入单行的数据量。curl 通过提供一种通过文件或从 stdin 提供命令行选项的方法来适应这一点，使用 -K 选项。

## 垃圾进，垃圾出

curl 几乎没有自己的意志。它试图在很大程度上满足您和您的愿望。这也意味着它会尝试使用您给定的内容。如果您拼写错误一个选项，它可能会执行意想不到的操作。如果您传入一个略微不合法的 URL，curl 仍然可能会处理它并继续进行。这意味着您可以在某些选项中传入疯狂的数据，而且您可以让 curl 在其传输操作中传递这些疯狂的数据。

这是一个设计选择，因为它允许您真正调整 curl 如何进行协议通信，您可以让 curl 以最有创意的方式对服务器实现进行处理。

# 命令行选项

## 命令行选项

当告诉 curl 要做某事时，您会在 URL 或一组 URL 之后调用 curl，并附带零个、一个或多个命令行选项，这些选项指定了您希望进行的传输。curl 支持超过两百种不同的选项。

### 短选项

命令行选项向 curl 传递有关您希望其行为的信息。比如，您可以使用 `-v` 选项要求 curl 启用详细模式：

```
curl -v http://example.com 
```

`-v` 在这里被用作“短选项”。你用减号符号和紧跟其后的一个单个字母编写这些选项。许多选项只是开关，用于开启某项功能或在两种已知状态之间切换。它们可以仅使用该选项名称。然后你也可以在减号后组合几个单个字母选项。要求同时启用详细模式和 curl 遵循 HTTP 重定向：

```
curl -vL http://example.com 
```

curl 中的命令行解析器始终解析整行，并且您可以在任何位置放置选项；它们也可以出现在 URL 之后：

```
curl http://example.com -Lv 
```

### 长选项

单个字母选项很方便，因为它们写起来快速且使用方便，但是由于字母表中只有有限的字母数，并且有许多要控制的东西，因此并非所有选项都像那样可用。因此，为这些选项提供了长选项名称。另外，为了方便起见并使脚本更易读，大多数短选项都有更长的名称别名。

长选项总是用 *两个* 减号（或 *破折号*，你喜欢怎么称呼它们）写的，然后是名称，您每个双减号只能写一个选项名称。使用长选项格式请求详细模式看起来像：

```
curl --verbose http://example.com 
```

并且使用长格式请求 HTTP 重定向看起来像：

```
curl --verbose --location http://example.com 
```

### 选项参数

并不是所有的选项都只是简单的布尔标志，用于启用或禁用功能。对于其中一些选项，您需要传递数据，例如用户名或文件路径。您可以通过先写选项然后写参数，用空格分隔开来来执行此操作。比如，如果您想要在 HTTP POST 请求中向服务器发送任意数据字符串：

```
curl -d arbitrary http://example.com 
```

即使您使用选项的长形式，它的工作方式也是相同的：

```
curl --data arbitrary http://example.com 
```

当您使用带有参数的短选项时，实际上您也可以不使用空格分隔符写入数据：

```
curl -darbitrary http://example.com 
```

### 带有空格的参数

有时您想要将参数传递给选项，而该参数包含一个或多个空格。例如，您想要将 curl 使用的用户代理字段设置为`I am your father`，包括这三个空格。那么当您将其传递给 curl 命令行时，您需要在字符串周围加上引号。要使用的确切引号取决于您的 shell/命令提示符，但通常在大多数地方使用双引号都可以：

```
curl -A "I am your father" http://example.com 
```

如果未使用引号，例如如果您将命令行编写为：

```
curl -A I am your father http://example.com 
```

…将使 curl 仅使用 'I' 作为用户代理字符串，而以下字符串，'am'、your 等，将被视为单独的 URLs，因为它们没有以 `-` 开头以指示它们是选项，并且 curl 只处理选项和 URLs。

要使字符串本身包含双引号，这在您例如想要将 JSON 字符串发送到服务器时很常见，您可能需要使用单引号（在 Windows 上除外，单引号的工作方式不同）。发送 JSON 字符串`{ "name": "Darth" }`：

```
curl -d '{ "name": "Darth" }' http://example.com 
```

或者，如果您想要避免单引号的问题，您可能更喜欢通过文件将数据发送到 curl，这样就不需要额外的引号了。假设我们将包含上述数据的文件称为'json'：

```
curl -d @json http://example.com 
```

### 负选项

对于开启某些功能的选项，还有一种关闭它的方法。然后您使用选项的长格式，在名称前加上 "no-" 前缀。例如，要关闭详细模式：

```
curl --no-verbose http://example.com 
```

# 选项取决于版本

## 选项取决于版本

`curl` 是在 1998 年这个辉煌的年份首次在命令行上键入的。当时它已经在指定的 URL 上工作，并且没有给它传递任何、一个或多个命令行选项。

从那时起，我们添加了更多选项。我们在进行操作时添加选项，并且几乎每个新版本的 curl 都有一个或几个新选项，允许用户修改其操作的某些方面。

由于 curl 项目的发布周期相当迅速，每八周发布一个新版本，几乎不可避免地您至少不总是使用最新发布的 curl 版本。有时甚至您可能使用几年前的 curl 版本。

本书描述的所有命令行选项当然都是在某个时间点添加到 curl 中的，只有很小一部分在 curl 首次发布时的 1998 年那个美好的春天是可用的。如果您想要将使用现代 curl 版本的 curl 命令行带回运行较旧的系统，这一点尤为重要，因为可能运行的是较旧的安装。

`curl` 的开发人员正在努力保持现有行为不变。编写于 1998 年、2003 年或 2010 年的使用 curl 的命令行应该都可以在今天运行而不需要修改。

# URLs

## URLs

curl 之所以被称为 curl，是因为其名称中包含 URL（统一资源定位符）的子字符串。它操作的是 URL。URL 是我们通常用于 Web 地址字符串的名称，比如我们通常看到的以 http://为前缀或以 www 开头的字符串。

严格来说，URL 是这些的旧名称。URI（统一资源标识符）是更现代和正确的名称。它们的语法在[RFC 3986](https://www.ietf.org/rfc/rfc3986.txt)中定义。

当 curl 接受“URL”作为输入时，实际上是一个“URI”。curl 理解的大多数协议也有相应的 URI 语法文档，描述了特定 URI 格式的工作原理。

curl 假设您提供了一个有效的 URL，并且仅对格式进行有限检查，以提取它认为执行操作所需的信息。例如，您很可能可以在 URL 中传递非法字符，而 curl 不会注意或在乎，它只会将它们传递下去。

### Scheme

URL 以“scheme”开头，这是“http://”部分的官方名称。这告诉 URL 使用哪种协议。该 scheme 必须是此版本的 curl 支持的已知 scheme，否则将显示错误消息并停止。此外，scheme 既不能以空格开头，也不能包含任何空格。

### scheme 分隔符

scheme 标识符与 URL 的其余部分之间由“://”序列分隔。这是一个冒号和两个正斜杠。存在只有一个斜杠的 URL 格式，但 curl 不支持任何这些格式。关于斜杠数量还有两点需要注意：

curl 允许一些非法语法并尝试在内部进行更正；因此，它也将理解和接受具有一个或三个斜杠的 URL，即使它们实际上不是正确形式的 URL。curl 之所以这样做，是因为浏览器开始了这种做法，因此偶尔会在实际应用中使用这样的 URL。

`file://` URL 写作`file://<hostname>/<path>`，但可以使用的唯一主机名是`localhost`、`127.0.0.1`或空白（什么都不写）：

```
file://localhost/path/to/file
file://127.0.0.1/path/to/file
file:///path/to/file 
```

在其中插入任何其他主机名将导致 curl 的最新版本返回错误。

特别注意上面的第三个示例（`file:///path/to/file`）。路径前有*三个*斜杠。这是一个常见错误的地方，浏览器允许用户使用错误的语法，因此作为特殊例外，Windows 上的 curl 也允许这种不正确的格式：

```
file://X:/path/to/file 
```

…其中 X 是 Windows 风格的驱动器号。

### 没有 scheme

作为一种便利，curl 也允许用户从 URL 中省略方案部分。然后，它根据主机名的第一部分猜测使用哪种协议。这种猜测非常基本，因为它只是检查主机名的第一部分是否与一组协议之一匹配，并假定您想使用该协议。这种启发式方法基于服务器传统上被命名为这种方式的事实。以这种方式检测到的协议有 FTP、DICT、LDAP、IMAP、SMTP 和 POP3。在没有方案的 URL 中的任何其他主机名将使 curl 默认为 HTTP。

您可以使用`--proto-default`选项修改默认协议为除 HTTP 外的其他协议。

### 名称和密码

在方案之后，可以嵌入可能的用户名和密码。这种语法的使用在今天通常是不受欢迎的，因为您很容易在脚本或其他情况下泄露这些信息。例如，使用给定的名称和密码列出 FTP 服务器的目录：

```
curl ftp://user:password@example.com/ 
```

URL 中的用户名和密码的存在完全是可选的。curl 也允许使用常规命令行选项提供这些信息，而不是在 URL 中。

### 主机名或地址

URL 的主机名部分，当然，只是一个可以解析为数值 IP 地址或数值地址本身的名字。在指定数值地址时，对于 IPv4 地址使用点分版本：

```
curl http://127.0.0.1/ 
```

…而对于 IPv6 地址，数值版本需要在方括号内：

```
curl http://[::1]/ 
```

当使用主机名时，将名称转换为 IP 地址通常使用系统的解析器功能。这通常允许系统管理员在 `/etc/hosts` 文件（或等效文件）中提供本地名称查找。

### 端口号

每个协议都有一个“默认端口”，curl 将在其中使用它，除非给定了一个指定的端口号。可选的端口号可以在 URL 的主机名部分之后作为十进制数的冒号和端口号提供。例如，在端口 8080 上请求 HTTP 文档：

```
curl http://example.com:8080/ 
```

使用指定为 IPv4 地址的名称：

```
curl http://127.0.0.1:8080/ 
```

以 IPv6 地址作为名称给出时：

```
curl http://[fdea::1]:8080/ 
```

### 路径

每个 URL 都包含一个路径。如果没有给出路径，则默认为“/”。该路径将发送到指定的服务器，以准确识别所请求的或将要提供的资源。

路径的确切使用取决于协议。例如，从默认匿名用户的 FTP 服务器获取文件 README：

```
curl ftp://ftp.example.com/README 
```

对于具有目录概念的协议，以斜杠结尾的 URL 表示这是一个目录而不是文件。因此，通过这样的斜杠请求从 FTP 服务器获取目录列表是隐含的：

```
curl ftp://ftp.example.com/tmp/ 
```

### FTP 类型

这不是一个广泛使用的功能。

识别 FTP 服务器上文件的 URL 具有一个特殊功能，允许您还告诉客户端（在本例中为 curl）资源的文件类型。这是因为 FTP 有点特殊，可以为传输更改模式，因此可以处理文件与使用其他模式时不同的方式。

您可以通过在 URL 后附加“;type=A”来告诉 curl FTP 资源是 ASCII 类型。然后，可以使用 ASCII 从 example.com 的根目录获取“foo”文件，如下所示：

```
curl "ftp://example.com/foo;type=A" 
```

虽然 curl 默认为 FTP 进行二进制传输，但 URL 格式允许您还可以使用 type=I 指定二进制类型：

```
curl "ftp://example.com/foo;type=I" 
```

最后，如果传递的类型是 D，则您可以告诉 curl 所识别的资源是一个目录：

```
curl "ftp://example.com/foo;type=D" 
```

…这样可以作为一种替代格式，而不是像上面提到的以斜杠结尾的路径。

### 片段

URLs 提供了“片段部分”。在浏览器中，通常以哈希符号（#）和网页中特定名称的名称表示。当 URL 传递给 curl 时，curl 会很好地支持片段，但片段部分实际上从未发送到网络，因此无论它是否存在，对于 curl 的操作都没有任何区别。

### 浏览器的“地址栏”

当你使用现代网络浏览器时，重要的是要意识到它们主窗口顶部通常显示的“地址栏”并非使用的是“URLs”甚至是“URIs”。实际上，它们大多数情况下使用的是 IRIs，这是 URI 的超集，允许国际化，如非拉丁符号等，但通常还会超越这一点，因为它们往往会，例如，处理空格，并以某种方式对百分比编码进行魔术操作，而这些提到的规范中都没有说明客户端应该这样做。

地址栏只是一个供人类输入和查看类似 URI 的字符串的界面。

有时，浏览器地址栏中看到的内容与您可以传递给 curl 的内容之间的差异是显著的。

## 许多选项和 URLs

如上所述，curl 支持数百个命令行选项，还支持无限数量的 URLs。如果您的 Shell 或命令行系统支持，那么您可以传递给 curl 的命令行长度实际上没有限制。

curl 将首先解析整个命令行，应用使用的命令行选项的愿望，然后逐个（从左到右）处理 URLs 以执行操作。

对于某些选项（例如告诉 curl 在哪里存储传输的`-o`或`-O`选项），您可能希望在命令行上的每个 URL 指定一个选项。

curl 将返回其对最后一个使用的 URL 的操作的退出代码。如果您希望 curl 在失败的第一个 URL 处出现错误而不是退出，请使用`--fail-early`选项。

## 每个 URL 分别设置选项

在前面的部分中，我们描述了 curl 始终解析整个命令行中的所有选项，并将其应用于它传输的所有 URLs。

这是一个简化：curl 还提供了一个选项（-;, --next），它在一组选项和 URL 之间插入一种边界，以便将其应用于这些选项。当命令行解析器找到一个--next 选项时，它会将后续选项应用于下一组 URLs。因此，--next 选项在一组选项和 URL 之间起到了一种*分隔符*的作用。您可以根据需要使用任意多个--next 选项。

举个例子，我们对一个 URL 进行 HTTP GET 请求并跟随重定向，然后我们对不同的 URL 进行第二个 HTTP POST 请求，最后我们用 HEAD 请求对第三个 URL 进行请求。所有这些在一个单独的命令行中完成：

```
curl --location http://example.com/1 --next
  --data sendthis http://example.com/2 --next
  --head http://example.com/3 
```

在命令行上尝试类似这样的操作*不*使用 --next 选项会生成一个非法的命令行，因为 curl 会尝试组合一个 POST 和一个 HEAD：

```
Warning: You can only select one HTTP request method! You asked for both POST
Warning: (-d, --data) and HEAD (-I, --head). 
```

## 连接重用

建立 TCP 连接，特别是 TLS 连接可能是一个缓慢的过程，即使在高带宽网络上也是如此。

记住 curl 具有内部连接池，它会保持之前使用的连接活动一段时间，以便在它们被使用后的一段时间内重新使用已经建立的连接。

当然，它们只能在 curl 工具运行的时间内保持活动，但这是一个很好的理由，尝试在同一个命令行中完成多个传输，而不是运行几个独立的 curl 命令行调用。

# URL globbing

## URL globbing

有时候你想要获取一系列基本相同的 URL，只有一小部分在请求之间发生变化。也许是一个数字范围，或者一组名称。curl 提供了 "globbing" 来轻松地指定这样多个 URL。

globbing 使用了保留的符号 [] 和 {}，这些符号通常不能成为合法 URL 的一部分（除了数字 IPv6 地址，但是 curl 无论如何都可以处理它们）。如果 globbing 影响了你的操作，请使用 `-g, --globoff` 禁用它。

虽然 curl 中大部分与传输相关的功能是由 libcurl 库提供的，但 URL globbing 功能不是！

### 数字范围

你可以使用 [N-M] 语法请求一个数字范围，其中 N 是起始索引，直到 M（包括 M）。例如，你可以一个接一个地请求命名为数字的 100 张图像：

```
curl -O http://example.com/[1-100].png 
```

它甚至可以对零前缀进行范围，比如数字始终是三位数的情况：

```
curl -O http://example.com/[001-100].png 
```

或者你只想要偶数编号的图片，所以你告诉 curl 也步进计数。这个例子的范围是从 0 到 100，步进为 2：

```
curl -O http://example.com/[0-100:2].png 
```

### 字母范围

curl 也可以做字母范围，比如当一个站点的部分命名为 a 到 z 时：

```
curl -O http://example.com/section[a-z].html 
```

### 一个列表

有时候部件不遵循这样简单的模式，这时你可以给出完整的列表，但是在花括号中而不是在用于范围的方括号中：

```
curl -O http://example.com/{one,two,three,alpha,beta}.html 
```

### 组合

你可以在同一个 URL 中使用多个 glob，这样 curl 也会迭代这些 glob。要下载 Ben、Alice 和 Frank 的图像，分辨率分别为 100x100 和 1000x1000，命令行可能如下所示：

```
curl -O http://example.com/{Ben,Alice,Frank}-{100x100,1000x1000}.jpg 
```

或者下载一个象棋棋盘的所有图像，由两个坐标索引，范围从 0 到 7：

```
curl -O http://example.com/chess-[0-7]x[0-7].jpg 
```

当然，你也可以混合范围和系列。获取一个星期的网站和邮件服务器的日志：

```
curl -O http://example.com/{web,mail}-log[0-6].txt 
```

### 用于 globbing 的输出变量

在本章中之前的所有通配符示例中，我们选择使用`-O / --remote-name`选项，这使得 curl 使用 URL 的文件名部分保存目标文件。

有时这还不够。你正在下载多个文件，也许你想将它们保存在不同的子目录中或以不同的方式创建保存的文件名。curl 当然也为这些情况提供了解决方案：输出文件名变量。

在 URL 中使用的每个“通配符”都会得到一个单独的变量。它们被引用为“#[num]” - 这意味着以单个字母“#”开头，后面跟着通配符号码，从第一个通配符开始为 1，直到最后一个通配符结束。

保存两个不同网站的主页：

```
curl http://{one,two}.example.com -o "file_#1.txt" 
```

用两个通配符在子目录中保存命令行的输出；

```
curl http://{site,host}.host[1-5].example.com -o "subdir/#1_#2" 
```

# 列出选项

## 列出所有命令行选项

curl 有超过两百个命令行选项，而且选项的数量随着时间的推移而不断增加。很可能在未来几年内，选项的数量将达到 250 个。

为了找出执行某个操作所需的选项，你当然可以列出所有选项，浏览列表并选择你正在寻找的选项。`curl --help`或简单地`curl -h`将为您提供所有现有选项的列表及简要说明。如果你不太清楚自己在寻找什么，你可能不会完全满意。

然后你可以选择使用`curl --manual`，它将输出 curl 的整个 man 页面以及最常见用例的附加教程。这是一个非常详尽和完整的文档，解释了每个选项的工作原理，总共有数千行文档。浏览这些内容也是一项繁琐的工作，我们鼓励使用搜索功能来浏览这些文本内容。有些人会欣赏 man 页面的[网页版本](https://curl.haxx.se/docs/manpage.html)。

# 配置文件

## 配置文件

你可能会发现 curl 命令行使用了大量的命令行选项，使得它们变得相当难以处理。有时，你要输入的命令行长度甚至达到了命令行系统允许的最大长度。微软 Windows 命令提示符就是一个具有相当小最大行长度的例子。

为了帮助这种情况，curl 提供了一个我们称之为“配置文件”的功能。基本上，它允许你将命令行选项写入一个文本文件中，然后告诉 curl 从该文件中读取选项，除了命令行之外。

你可以告诉 curl 从一个特定文件中读取更多的命令行选项，使用`-K / --config`选项，就像这样：

```
curl -K cmdline.txt http://example.com 
```

…并在`cmdline.txt`文件中（当然，可以使用任何你喜欢的文件名）每行输入一个命令行：

```
# this is a comment, we ask to follow redirects
--location
# ask to do a HEAD request
--head 
```

配置文件接受短选项和长选项，正如你在命令行上编写它们一样。作为一个特殊的额外功能，它还允许你写长格式的选项，而不需要前导的两个破折号，以使阅读更容易。使用这种风格，上面显示的配置文件也可以替代地写为：

```
# this is a comment, we ask to follow redirects
location
# ask to do a HEAD request
head 
```

带有参数的命令行选项必须在同一行上提供其参数。例如，可以通过以下方式更改 User-Agent HTTP 标头：

```
user-agent "Everything-is-an-agent" 
```

为了使配置文件看起来更像真正的配置文件，它还允许你在选项和其参数之间使用'='或':'。就像你上面看到的那样，这并不是必需的，但有些人喜欢它所提供的清晰度。再次设置用户代理选项：

```
user-agent = "Everything-is-an-agent" 
```

选项的参数可以指定为不带双引号，然后 curl 将把下一个空格或换行符视为参数的结束。所以如果你想提供一个包含嵌入空格的参数，你必须使用双引号。

我们上面使用的用户代理字符串示例没有空格，因此它也可以不用引号提供，就像：

```
user-agent = Everything-is-an-agent 
```

最后，如果你想在配置文件中提供一个 URL，你必须以`--url`的方式进行，或者只需使用`url`，而不像在命令行上那样，基本上所有不是选项的东西都被假定为是一个 URL。所以你提供一个 URL 给 curl 就像这样：

```
url = "http://example.com" 
```

### 默认配置文件

当调用 curl 时，它总是（除非使用了`-q`）检查默认配置文件并在找到时使用它。它检查的文件名是类 Unix 系统上的.curlrc 和 Windows 上的 _curlrc。

默认配置文件按以下顺序在以下位置检查：

1.  curl 尝试找到"主目录"：首先检查 CURL_HOME，然后检查 HOME 环境变量。如果失败，它会在类 Unix 系统上使用`getpwuid()`（它返回给定系统中当前用户的主目录）。在 Windows 上，它然后检查 APPDATA 变量，或者作为最后的手段检查'%USERPROFILE%\Application Data'。

1.  在 Windows 上，如果在主目录中没有 _curlrc 文件，则检查 curl 可执行文件所在的同一目录中是否存在一个文件。在类 Unix 系统上，它将简单地尝试从确定的主目录中加载.curlrc。

# 密码

## 密码和窥探

密码是棘手而敏感的。泄漏密码可以使其他人访问受保护的资源和数据，而不是你。

curl 提供了几种从用户那里接收密码然后随后传递它们或将它们用于其他用途的方法。

最基本的 curl 身份验证选项是`-u / --user`。它接受一个参数，即用户名和密码，用冒号分隔。就像当 alice 想请求一个需要 HTTP 身份验证的页面，并且她的密码是'12345'时：

$ curl -u alice:12345 [`example.com/`](http://example.com/)

### 命令行泄露

这里有几件可能不好的事情正在发生。首先，我们在命令行上输入密码，而命令行可能对同一系统上的其他用户可读（假设你有一个多用户系统）。curl 会尝试通过尽量在进程列表中隐藏密码来最小化这种风险。

避免在命令行上传递用户名和密码的一种方法是使用.netrc 文件或配置文件。你也可以使用`-u`选项而不指定密码，然后 curl 会在运行时提示用户输入密码。

### 网络泄漏

其次，此命令行将用户凭据发送到 HTTP 服务器，这是一种明文协议，容易受到中间人或其他窃听者的监听并查看发送的内容。在此命令行示例中，它使 curl 使用 HTTP 基本认证，这是完全不安全的。

有几种避免这种情况的方法，关键当然是避免在网络上传送明文凭据的协议或身份验证方案。最简单的方法可能是确保你使用协议的加密版本。使用 HTTPS 代替 HTTP，使用 FTPS 代替 FTP 等等。

如果你需要坚持使用纯文本和不安全的协议，那么请看看是否可以切换到使用避免明文发送凭据的身份验证方法。如果你需要 HTTP，这样的方法包括摘要(`--digest`)、协商(`--negotiate`)和 NTLM(`--ntlm`)。

# 进度条

## 进度条

curl 有一个内置的进度条。当 curl 被调用来传输数据（上传或下载）时，它可以在终端屏幕上显示进度条，显示传输进度，即当前传输速度，传输已经进行了多长时间，估计还需多长时间才能完成。

如果 curl 认为输出被发送到终端，则会抑制进度条，因为这样进度条就会干扰输出，并且只会搞乱显示的内容。用户也可以使用`-s / --silent`选项强制关闭进度条，告诉 curl 保持安静。

如果你调用 curl 却没有看到进度条，确保你的输出被重定向到终端之外的地方。

curl 还提供了一种替代和更简单的进度条，你可以用`-# / --progress-bar`启用它。正如其长名称所示，它会以进度条的形式显示传输进度。

在某些时候，当 curl 被要求传输数据时，它可能无法确定所请求操作的总大小，这就导致进度条包含较少的细节，例如不能对传输时间做出预测等。

### 单位

进度条显示字节和字节每秒。

它还会使用后缀来表示更大量级的字节，使用 1024 进制系统，因此 1024 字节是一千字节（1K），2048 字节是 2K，依此类推。curl 支持以下这些后缀：

| 后缀 | 量级 | 名称 |
| --- | --- | --- |
| K | 2¹⁰ | 千字节 |
| M | 2²⁰ | 兆字节 |
| G | 2³⁰ | 吉字节 |
| T | 2⁴⁰ | 太字节 |
| P | 2⁵⁰ | 佩比字节 |

时间以时:分:秒显示。

### 进度条图例

进度条存在的目的是向用户显示确实有事情正在发生。输出中的不同字段具有以下含义：

```
% Total    % Received % Xferd  Average Speed          Time             Curr.
                               Dload  Upload Total    Current  Left    Speed
0  151M    0 38608    0     0   9406      0  4:41:43  0:00:04  4:41:39  9287 
```

从左到右：

| Title | 含义 |
| --- | --- |
| % | 整个传输的完成百分比 |
| Total | 整个预期传输的总大小（如果已知） |
| % | 下载完成百分比 |
| Received | 目前已下载的字节数 |
| % | 上传完成百分比 |
| Xferd | 目前已上传的字节数 |
| Average Speed Dload | 到目前为止整个下载的平均传输速度，以每秒字节数表示 |
| Average Speed Upload | 到目前为止整个上传的平均传输速度，以每秒字节数表示 |
| Time Total | 完成操作的预期时间，以时:分:秒表示 |
| Time Current | 传输开始后经过的时间，以时:分:秒表示 |
| Time Left | 预计剩余完成时间，以时:分:秒表示 |
| Curr.Speed | 过去 5 秒的平均传输速度（传输的前 5 秒当然基于较短的时间）以每秒字节数表示 |
