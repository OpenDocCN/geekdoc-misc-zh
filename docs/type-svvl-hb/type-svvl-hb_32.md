# 泛型 (generics)

> 原文：[`typescriptbook.jp/reference/generics`](https://typescriptbook.jp/reference/generics)

要同时实现类型的安全性和代码的通用化是困难的。当尝试在所有类型上使用相同的代码时，类型的安全性会受到损害。相反，如果重视类型的安全性，就需要大量重复类似的代码，从而难以实现代码的通用化。为解决这些问题，引入了泛型这一语言特性。使用泛型，可以**同时实现类型的安全性和代码的通用化**。

## 解决的问题​

让我们具体看看泛型是如何解决问题的。这里有一个名为`chooseRandomlyString()`的普通函数。该函数接受两个字符串作为参数，并以五五开的概率返回第一个参数或第二个参数的值。

```
ts`function  <data-lsp lsp="function chooseRandomlyString(v1: string, v2: string): string">chooseRandomlyString</data-lsp>(<data-lsp lsp="(parameter) v1: string">v1</data-lsp>:  string, <data-lsp lsp="(parameter) v2: string">v2</data-lsp>:  string):  string {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: string">v1</data-lsp> : <data-lsp lsp="(parameter) v2: string">v2</data-lsp>;}`
```

```
ts`function <data-lsp lsp="function chooseRandomlyString(v1: string, v2: string): string">chooseRandomlyString</data-lsp>(<data-lsp lsp="(parameter) v1: string">v1</data-lsp>:  string, <data-lsp lsp="(parameter) v2: string">v2</data-lsp>:  string):  string {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: string">v1</data-lsp> : <data-lsp lsp="(parameter) v2: string">v2</data-lsp>;}`
```

`chooseRandomlyString`仅限于字符串的抽选时，可以重复使用这个函数。

```
ts`const  <data-lsp lsp="const winOrLose: string">winOrLose</data-lsp>  =  <data-lsp lsp="function chooseRandomlyString(v1: string, v2: string): string">chooseRandomlyString</data-lsp>("勝ち",  "負け");`
```

```
ts`const  <data-lsp lsp="const winOrLose: string">winOrLose</data-lsp>  = <data-lsp lsp="function chooseRandomlyString(v1: string, v2: string): string">chooseRandomlyString</data-lsp>("勝ち",  "負け");`
```

接下来，让我们考虑一下不仅仅是字符串，还需要进行数字抽选的情况。由于`chooseRandomlyString()`仅支持字符串，因此需要新增一个专门用于数字的函数。

```
ts`// 数値用の抽選関数 function  <data-lsp lsp="function chooseRandomlyNumber(v1: number, v2: number): number">chooseRandomlyNumber</data-lsp>(<data-lsp lsp="(parameter) v1: number">v1</data-lsp>:  number, <data-lsp lsp="(parameter) v2: number">v2</data-lsp>:  number):  number {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: number">v1</data-lsp> : <data-lsp lsp="(parameter) v2: number">v2</data-lsp>;}const  <data-lsp lsp="const num: number">num</data-lsp>:  number  =  <data-lsp lsp="function chooseRandomlyNumber(v1: number, v2: number): number">chooseRandomlyNumber</data-lsp>(1,  2);`
```

```
ts`// 数値用の抽選関数 function <data-lsp lsp="function chooseRandomlyNumber(v1: number, v2: number): number">chooseRandomlyNumber</data-lsp>(<data-lsp lsp="(parameter) v1: number">v1</data-lsp>:  number, <data-lsp lsp="(parameter) v2: number">v2</data-lsp>:  number):  number {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: number">v1</data-lsp> : <data-lsp lsp="(parameter) v2: number">v2</data-lsp>;}const  <data-lsp lsp="const num: number">num</data-lsp>:  number  = <data-lsp lsp="function chooseRandomlyNumber(v1: number, v2: number): number">chooseRandomlyNumber</data-lsp>(1,  2);`
```

此外，五五开的抽选逻辑是通用的，所以我们还需要为`URL`对象创建一个实现以进行广告 A/B 测试。

```
ts`// URLオブジェクト向けの抽選関数 function  <data-lsp lsp="function chooseRandomlyURL(v1: URL, v2: URL): URL">chooseRandomlyURL</data-lsp>(<data-lsp lsp="(parameter) v1: URL">v1</data-lsp>:  <data-lsp lsp="interface URL">URL</data-lsp>, <data-lsp lsp="(parameter) v2: URL">v2</data-lsp>:  <data-lsp lsp="interface URL">URL</data-lsp>):  <data-lsp lsp="interface URL">URL</data-lsp> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: URL">v1</data-lsp> : <data-lsp lsp="(parameter) v2: URL">v2</data-lsp>;}const  <data-lsp lsp="const url: URL">url</data-lsp>:  <data-lsp lsp="interface URL">URL</data-lsp>  =  <data-lsp lsp="function chooseRandomlyURL(v1: URL, v2: URL): URL">chooseRandomlyURL</data-lsp>(<data-lsp lsp="const urlA: URL">urlA</data-lsp>, <data-lsp lsp="const urlB: URL">urlB</data-lsp>);`
```

```
ts`// URLオブジェクト向けの抽選関数 function <data-lsp lsp="function chooseRandomlyURL(v1: URL, v2: URL): URL">chooseRandomlyURL</data-lsp>(<data-lsp lsp="(parameter) v1: URL">v1</data-lsp>: <data-lsp lsp="interface URL">URL</data-lsp>, <data-lsp lsp="(parameter) v2: URL">v2</data-lsp>: <data-lsp lsp="interface URL">URL</data-lsp>): <data-lsp lsp="interface URL">URL</data-lsp> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: URL">v1</data-lsp> : <data-lsp lsp="(parameter) v2: URL">v2</data-lsp>;}const  <data-lsp lsp="const url: URL">url</data-lsp>: <data-lsp lsp="interface URL">URL</data-lsp> = <data-lsp lsp="function chooseRandomlyURL(v1: URL, v2: URL): URL">chooseRandomlyURL</data-lsp>(<data-lsp lsp="const urlA: URL">urlA</data-lsp>, <data-lsp lsp="const urlB: URL">urlB</data-lsp>);`
```

到目前为止，我们已经复制了`chooseRandomly()`函数两次，并创建了三个类型不同的相同函数。

```
ts`// 重複した3つの関数 function  <data-lsp lsp="function chooseRandomlyString(v1: string, v2: string): string">chooseRandomlyString</data-lsp>(<data-lsp lsp="(parameter) v1: string">v1</data-lsp>:  string, <data-lsp lsp="(parameter) v2: string">v2</data-lsp>:  string):  string {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: string">v1</data-lsp> : <data-lsp lsp="(parameter) v2: string">v2</data-lsp>;}function  <data-lsp lsp="function chooseRandomlyNumber(v1: number, v2: number): number">chooseRandomlyNumber</data-lsp>(<data-lsp lsp="(parameter) v1: number">v1</data-lsp>:  number, <data-lsp lsp="(parameter) v2: number">v2</data-lsp>:  number):  number {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: number">v1</data-lsp> : <data-lsp lsp="(parameter) v2: number">v2</data-lsp>;}function  <data-lsp lsp="function chooseRandomlyURL(v1: URL, v2: URL): URL">chooseRandomlyURL</data-lsp>(<data-lsp lsp="(parameter) v1: URL">v1</data-lsp>:  <data-lsp lsp="interface URL">URL</data-lsp>, <data-lsp lsp="(parameter) v2: URL">v2</data-lsp>:  <data-lsp lsp="interface URL">URL</data-lsp>):  <data-lsp lsp="interface URL">URL</data-lsp> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: URL">v1</data-lsp> : <data-lsp lsp="(parameter) v2: URL">v2</data-lsp>;}`
```

```
ts`// 重複した3つの関数 function <data-lsp lsp="function chooseRandomlyString(v1: string, v2: string): string">chooseRandomlyString</data-lsp>(<data-lsp lsp="(parameter) v1: string">v1</data-lsp>:  string, <data-lsp lsp="(parameter) v2: string">v2</data-lsp>:  string):  string {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: string">v1</data-lsp> : <data-lsp lsp="(parameter) v2: string">v2</data-lsp>;}function <data-lsp lsp="function chooseRandomlyNumber(v1: number, v2: number): number">chooseRandomlyNumber</data-lsp>(<data-lsp lsp="(parameter) v1: number">v1</data-lsp>:  number, <data-lsp lsp="(parameter) v2: number">v2</data-lsp>:  number):  number {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: number">v1</data-lsp> : <data-lsp lsp="(parameter) v2: number">v2</data-lsp>;}function <data-lsp lsp="function chooseRandomlyURL(v1: URL, v2: URL): URL">chooseRandomlyURL</data-lsp>(<data-lsp lsp="(parameter) v1: URL">v1</data-lsp>: <data-lsp lsp="interface URL">URL</data-lsp>, <data-lsp lsp="(parameter) v2: URL">v2</data-lsp>: <data-lsp lsp="interface URL">URL</data-lsp>): <data-lsp lsp="interface URL">URL</data-lsp> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: URL">v1</data-lsp> : <data-lsp lsp="(parameter) v2: URL">v2</data-lsp>;}`
```

那么，要想实现代码的通用化，应该怎么做呢？首先可以考虑的方法是将类型设为`any`。这种方法的问题在于，返回值的类型也会变为`any`，因此编译器不再进行检查，容易产生错误。换句话说，就是牺牲了类型的安全性。

在下面的示例代码中，我们将`number`类型传递给了`chooseRandomly()`，但实际上我们打算将返回值视为`string`类型处理。尽管这段代码不会导致编译错误，但在运行编译后的代码时，会在第 5 行报错：“TypeError: str.toLowerCase is not a function”。

```
ts`function  <data-lsp lsp="function chooseRandomly(v1: any, v2: any): any">chooseRandomly</data-lsp>(<data-lsp lsp="(parameter) v1: any">v1</data-lsp>:  any, <data-lsp lsp="(parameter) v2: any">v2</data-lsp>:  any):  any {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: any">v1</data-lsp> : <data-lsp lsp="(parameter) v2: any">v2</data-lsp>;}let <data-lsp lsp="let str: any">str</data-lsp> =  <data-lsp lsp="function chooseRandomly(v1: any, v2: any): any">chooseRandomly</data-lsp>(0,  1);<data-lsp lsp="let str: any">str</data-lsp> =  <data-lsp lsp="let str: any">str</data-lsp>.<data-lsp lsp="any">toLowerCase</data-lsp>();`
```

```
ts`function <data-lsp lsp="function chooseRandomly(v1: any, v2: any): any">chooseRandomly</data-lsp>(<data-lsp lsp="(parameter) v1: any">v1</data-lsp>:  any, <data-lsp lsp="(parameter) v2: any">v2</data-lsp>:  any):  any {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: any">v1</data-lsp> : <data-lsp lsp="(parameter) v2: any">v2</data-lsp>;}let <data-lsp lsp="let str: any">str</data-lsp> = <data-lsp lsp="function chooseRandomly(v1: any, v2: any): any">chooseRandomly</data-lsp>(0,  1);<data-lsp lsp="let str: any">str</data-lsp> =  <data-lsp lsp="let str: any">str</data-lsp>.<data-lsp lsp="any">toLowerCase</data-lsp>();`
```

要同时实现代码的通用化和类型的安全性，应该怎么做呢？这时就要依赖泛型了。其实，泛型的概念非常简单，即“将类型视为变量”。这是什么意思呢？让我们以“这三个重复的函数有何不同？”的角度来看待先前提到的问题。你可能会想到，除了用`<>`突出显示的部分不同外，其他部分都是相同的代码。

```
ts`function  <data-lsp lsp="function chooseRandomly<String>(v1: <string>() => any, v2: <string>() => any): <string>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) String in chooseRandomly<String>(v1: <string>() => any, v2: <string>() => any): <string>() => {}">String</data-lsp>>(<data-lsp lsp="(parameter) v1: <string>() => any">v1</data-lsp>: <<data-lsp lsp="(type parameter) string in <string>(): any">string</data-lsp>>,  <data-lsp lsp="(parameter) v2: <string>() => any">v2</data-lsp>: <<data-lsp lsp="(type parameter) string in <string>(): any">string</data-lsp>>): <<data-lsp lsp="(type parameter) string in <string>(): {}">string</data-lsp>> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="any">v1</data-lsp> : <data-lsp lsp="any">v2</data-lsp>;}function  <data-lsp lsp="function chooseRandomly<Number>(v1: <number>() => any, v2: <number>() => any): <number>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) Number in chooseRandomly<Number>(v1: <number>() => any, v2: <number>() => any): <number>() => {}">Number</data-lsp>>(<data-lsp lsp="(parameter) v1: <number>() => any">v1</data-lsp>: <<data-lsp lsp="(type parameter) number in <number>(): any">number</data-lsp>>,  <data-lsp lsp="(parameter) v2: <number>() => any">v2</data-lsp>: <<data-lsp lsp="(type parameter) number in <number>(): any">number</data-lsp>>): <<data-lsp lsp="(type parameter) number in <number>(): {}">number</data-lsp>> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="any">v1</data-lsp> : <data-lsp lsp="any">v2</data-lsp>;}function  <data-lsp lsp="function chooseRandomly<URL>(v1: <URL>() => any, v2: <URL>() => any): <URL>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) URL in chooseRandomly<URL>(v1: <URL>() => any, v2: <URL>() => any): <URL>() => {}">URL</data-lsp>>(<data-lsp lsp="(parameter) v1: <URL>() => any">v1</data-lsp>: <<data-lsp lsp="(type parameter) URL in <URL>(): any">URL</data-lsp>>,  <data-lsp lsp="(parameter) v2: <URL>() => any">v2</data-lsp>: <<data-lsp lsp="(type parameter) URL in <URL>(): any">URL</data-lsp>>): <<data-lsp lsp="(type parameter) URL in <URL>(): {}">URL</data-lsp>> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="any">v1</data-lsp> : <data-lsp lsp="any">v2</data-lsp>;}<data-lsp lsp="function chooseRandomly<String>(v1: <string>() => any, v2: <string>() => any): <string>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="interface String">String</data-lsp>>("勝ち",  "負け");<data-lsp lsp="function chooseRandomly<Number>(v1: <string>() => any, v2: <string>() => any): <string>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="interface Number">Number</data-lsp>>(1,  2);<data-lsp lsp="function chooseRandomly<URL>(v1: <string>() => any, v2: <string>() => any): <string>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="interface URL">URL</data-lsp>>(<data-lsp lsp="any">urlA</data-lsp>, <data-lsp lsp="any">urlB</data-lsp>);`
```

```
ts`function <data-lsp lsp="function chooseRandomly<String>(v1: <string>() => any, v2: <string>() => any): <string>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) String in chooseRandomly<String>(v1: <string>() => any, v2: <string>() => any): <string>() => {}">String</data-lsp>>(<data-lsp lsp="(parameter) v1: <string>() => any">v1</data-lsp>: <<data-lsp lsp="(type parameter) string in <string>(): any">string</data-lsp>>, <data-lsp lsp="(parameter) v2: <string>() => any">v2</data-lsp>: <<data-lsp lsp="(type parameter) string in <string>(): any">string</data-lsp>>): <<data-lsp lsp="(type parameter) string in <string>(): {}">string</data-lsp>> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="any">v1</data-lsp> : <data-lsp lsp="any">v2</data-lsp>;}function <data-lsp lsp="function chooseRandomly<Number>(v1: <number>() => any, v2: <number>() => any): <number>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) Number in chooseRandomly<Number>(v1: <number>() => any, v2: <number>() => any): <number>() => {}">Number</data-lsp>>(<data-lsp lsp="(parameter) v1: <number>() => any">v1</data-lsp>: <<data-lsp lsp="(type parameter) number in <number>(): any">number</data-lsp>>, <data-lsp lsp="(parameter) v2: <number>() => any">v2</data-lsp>: <<data-lsp lsp="(type parameter) number in <number>(): any">number</data-lsp>>): <<data-lsp lsp="(type parameter) number in <number>(): {}">number</data-lsp>> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="any">v1</data-lsp> : <data-lsp lsp="any">v2</data-lsp>;}function <data-lsp lsp="function chooseRandomly<URL>(v1: <URL>() => any, v2: <URL>() => any): <URL>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) URL in chooseRandomly<URL>(v1: <URL>() => any, v2: <URL>() => any): <URL>() => {}">URL</data-lsp>>(<data-lsp lsp="(parameter) v1: <URL>() => any">v1</data-lsp>: <<data-lsp lsp="(type parameter) URL in <URL>(): any">URL</data-lsp>>, <data-lsp lsp="(parameter) v2: <URL>() => any">v2</data-lsp>: <<data-lsp lsp="(type parameter) URL in <URL>(): any">URL</data-lsp>>): <<data-lsp lsp="(type parameter) URL in <URL>(): {}">URL</data-lsp>> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="any">v1</data-lsp> : <data-lsp lsp="any">v2</data-lsp>;}<data-lsp lsp="function chooseRandomly<String>(v1: <string>() => any, v2: <string>() => any): <string>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="interface String">String</data-lsp>>("勝ち",  "負け");<data-lsp lsp="function chooseRandomly<Number>(v1: <string>() => any, v2: <string>() => any): <string>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="interface Number">Number</data-lsp>>(1,  2);<data-lsp lsp="function chooseRandomly<URL>(v1: <string>() => any, v2: <string>() => any): <string>() => {} (+2 overloads)">chooseRandomly</data-lsp><<data-lsp lsp="interface URL">URL</data-lsp>>(<data-lsp lsp="any">urlA</data-lsp>, <data-lsp lsp="any">urlB</data-lsp>);`
```

这些不同的部分都涉及到类型。如果想要将这些部分视为变量，那么即使不了解泛型的语法，作为程序员也应该能够想象出以下代码吧？

```
ts`// 注意: これは架空の文法ですfunction  <data-lsp lsp="function chooseRandomly<type>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) type in chooseRandomly<type>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">type</data-lsp>>(<data-lsp lsp="(parameter) v1: <type>() => any">v1</data-lsp>: <<data-lsp lsp="(type parameter) type in <type>(): any">type</data-lsp>>,  <data-lsp lsp="(parameter) v2: <type>() => any">v2</data-lsp>: <<data-lsp lsp="(type parameter) type in <type>(): any">type</data-lsp>>): <<data-lsp lsp="(type parameter) type in <type>(): {}">type</data-lsp>> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="any">v1</data-lsp> : <data-lsp lsp="any">v2</data-lsp>;}<data-lsp lsp="function chooseRandomly<string>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">chooseRandomly</data-lsp><string>("勝ち",  "負け");<data-lsp lsp="function chooseRandomly<number>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">chooseRandomly</data-lsp><number>(1,  2);<data-lsp lsp="function chooseRandomly<URL>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">chooseRandomly</data-lsp><<data-lsp lsp="interface URL">URL</data-lsp>>(<data-lsp lsp="any">urlA</data-lsp>, <data-lsp lsp="any">urlB</data-lsp>);`
```

```
ts`// 注意: これは架空の文法ですfunction <data-lsp lsp="function chooseRandomly<type>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) type in chooseRandomly<type>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">type</data-lsp>>(<data-lsp lsp="(parameter) v1: <type>() => any">v1</data-lsp>: <<data-lsp lsp="(type parameter) type in <type>(): any">type</data-lsp>>, <data-lsp lsp="(parameter) v2: <type>() => any">v2</data-lsp>: <<data-lsp lsp="(type parameter) type in <type>(): any">type</data-lsp>>): <<data-lsp lsp="(type parameter) type in <type>(): {}">type</data-lsp>> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="any">v1</data-lsp> : <data-lsp lsp="any">v2</data-lsp>;}<data-lsp lsp="function chooseRandomly<string>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">chooseRandomly</data-lsp><string>("勝ち",  "負け");<data-lsp lsp="function chooseRandomly<number>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">chooseRandomly</data-lsp><number>(1,  2);<data-lsp lsp="function chooseRandomly<URL>(v1: <type>() => any, v2: <type>() => any): <type>() => {}">chooseRandomly</data-lsp><<data-lsp lsp="interface URL">URL</data-lsp>>(<data-lsp lsp="any">urlA</data-lsp>, <data-lsp lsp="any">urlB</data-lsp>);`
```

`<type>`被替换成了表示“类型参数”的部分。与值参数一样，在这个例子中，将类型作为参数传递给函数时，应该像`chooseRandomly<string>`一样传递类型。通过将类型视为参数，就产生了如下代码。解释过“泛型是将类型视为变量”的意思后，您现在应该明白了吧。

上面的代码只是为了理解泛型的概念而虚构的代码。现在，我们将其改写为 TypeScript 泛型的语法。这些代码并非纯属虚构。可以这样写：

```
ts`function  <data-lsp lsp="function chooseRandomly<T>(v1: T, v2: T): T">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>>(<data-lsp lsp="(parameter) v1: T">v1</data-lsp>:  <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>, <data-lsp lsp="(parameter) v2: T">v2</data-lsp>:  <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>):  <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: T">v1</data-lsp> : <data-lsp lsp="(parameter) v2: T">v2</data-lsp>;}<data-lsp lsp="function chooseRandomly<string>(v1: string, v2: string): string">chooseRandomly</data-lsp><string>("勝ち",  "負け");<data-lsp lsp="function chooseRandomly<number>(v1: number, v2: number): number">chooseRandomly</data-lsp><number>(1,  2);<data-lsp lsp="function chooseRandomly<URL>(v1: URL, v2: URL): URL">chooseRandomly</data-lsp><<data-lsp lsp="interface URL">URL</data-lsp>>(<data-lsp lsp="const urlA: URL">urlA</data-lsp>, <data-lsp lsp="const urlB: URL">urlB</data-lsp>);`
```

```
ts`function <data-lsp lsp="function chooseRandomly<T>(v1: T, v2: T): T">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>>(<data-lsp lsp="(parameter) v1: T">v1</data-lsp>: <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>, <data-lsp lsp="(parameter) v2: T">v2</data-lsp>: <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>): <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: T">v1</data-lsp> : <data-lsp lsp="(parameter) v2: T">v2</data-lsp>;}<data-lsp lsp="function chooseRandomly<string>(v1: string, v2: string): string">chooseRandomly</data-lsp><string>("勝ち",  "負け");<data-lsp lsp="function chooseRandomly<number>(v1: number, v2: number): number">chooseRandomly</data-lsp><number>(1,  2);<data-lsp lsp="function chooseRandomly<URL>(v1: URL, v2: URL): URL">chooseRandomly</data-lsp><<data-lsp lsp="interface URL">URL</data-lsp>>(<data-lsp lsp="const urlA: URL">urlA</data-lsp>, <data-lsp lsp="const urlB: URL">urlB</data-lsp>);`
```

`<T>`在`chooseRandomly`中是类型变量的定义。通常情况下，`T`被广泛使用，但也可以使用`A`或`Type`等。在函数的参数类型和返回值类型中写的`T`是引用类型变量。

现在，让我们尝试使用泛型化的`chooseRandomly`来重新编写之前在编译时无法察觉的错误代码。这样做后，会出现编译错误：“Argument of type '0' is not assignable to parameter of type 'string'.”，这样就能发现错误地将`0`赋给了应该接受`string`类型的地方。

```
ts`function  <data-lsp lsp="function chooseRandomly<T>(v1: T, v2: T): T">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>>(<data-lsp lsp="(parameter) v1: T">v1</data-lsp>:  <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>, <data-lsp lsp="(parameter) v2: T">v2</data-lsp>:  <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>):  <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: T">v1</data-lsp> : <data-lsp lsp="(parameter) v2: T">v2</data-lsp>;}let <data-lsp lsp="let str: string">str</data-lsp> =  <data-lsp lsp="function chooseRandomly<string>(v1: string, v2: string): string">chooseRandomly</data-lsp><string>(<data-err>0</data-err>,  1);Argument of type 'number' is not assignable to parameter of type 'string'.2345Argument of type 'number' is not assignable to parameter of type 'string'.<data-lsp lsp="let str: string">str</data-lsp> =  <data-lsp lsp="let str: string">str</data-lsp>.<data-lsp lsp="(method) String.toLowerCase(): string">toLowerCase</data-lsp>();`
```

```
ts`function <data-lsp lsp="function chooseRandomly<T>(v1: T, v2: T): T">chooseRandomly</data-lsp><<data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>>(<data-lsp lsp="(parameter) v1: T">v1</data-lsp>: <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>, <data-lsp lsp="(parameter) v2: T">v2</data-lsp>: <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp>): <data-lsp lsp="(type parameter) T in chooseRandomly<T>(v1: T, v2: T): T">T</data-lsp> {  return  <data-lsp lsp="var Math: Math">Math</data-lsp>.<data-lsp lsp="(method) Math.random(): number">random</data-lsp>() <=  0.5  ? <data-lsp lsp="(parameter) v1: T">v1</data-lsp> : <data-lsp lsp="(parameter) v2: T">v2</data-lsp>;}let <data-lsp lsp="let str: string">str</data-lsp> = <data-lsp lsp="function chooseRandomly<string>(v1: string, v2: string): string">chooseRandomly</data-lsp><string>(<data-err>0</data-err>,  1);Argument of type 'number' is not assignable to parameter of type 'string'.2345Argument of type 'number' is not assignable to parameter of type 'string'.<data-lsp lsp="let str: string">str</data-lsp> =  <data-lsp lsp="let str: string">str</data-lsp>.<data-lsp lsp="(method) String.toLowerCase(): string">toLowerCase</data-lsp>();`
```

通过上述的例子，我们已经了解了在将非泛型函数通用化的同时，如何确保类型的安全性。泛型是一种能够同时实现代码的通用化和类型的安全性的语言特性。在希望能够在多种类型上使用通用代码时，可以考虑使用泛型。

## 总结​

+   如果通用化代码，类型的安全性就会降低。

+   型的安全性提高了，代码的通用化就变得困难。

+   泛型既能实现代码的通用化，又能保证类型的安全性。

+   泛型的概念是将类型也视为参数。
