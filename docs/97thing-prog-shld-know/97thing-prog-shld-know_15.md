# 以理性编码

# 以理性编码

试图手工推理软件正确性会导致一个比代码更长的形式证明，并且更有可能包含错误。自动化工具更可取，但并非总是可行。接下来描述了一种中间路径：对正确性进行半形式推理。

底层方法是将考虑中的所有代码划分为短部分 —— 从单行，例如函数调用，到少于十行的块 —— 并对其正确性进行论证。这些论点只需要足够强大，以说服您的恶魔倡导者同行程序员。

应选择一个部分，以便在每个端点处，程序的*状态*（即，程序计数器和所有“活动”对象的值）满足一个易于描述的属性，并且该部分的功能（状态转换）易于描述为单个任务 — 这将使推理更简单。这样的端点属性推广了函数的*前置条件*和*后置条件*以及循环和类（关于它们的实例）的*不变条件*等概念。努力使各个部分尽可能独立于彼此将简化推理，并且在修改这些部分时是不可或缺的。

许多众所周知的编码实践（尽管可能不那么遵循）并被认为是“好”的使推理变得更容易。因此，只要打算推理您的代码，您就已经开始朝着更好的风格和结构思考。毫不奇怪，大多数这些实践都可以通过静态代码分析器进行检查：

1.  避免使用 goto 语句，因为它们会使远程部分高度相互依赖。

1.  避免使用可修改的全局变量，因为它们使使用它们的所有部分都依赖于它们。

1.  每个变量的作用域应尽可能小。例如，可以在其第一次使用之前直接声明局部对象。

1.  只要相关，就使对象*不可变*。

1.  通过使用水平和垂直间距使代码可读。例如，对齐相关结构并使用空行来分隔两个部分。

1.  通过选择描述性（但相对较短）的名称来使代码自我说明，用于对象、类型、函数等。

1.  如果需要嵌套部分，请将其设为函数。

1.  使您的函数简短且专注于单个任务。旧的*24 行限制*仍然适用。尽管屏幕大小和分辨率已经改变，但人类认知自 1960 年代以来并没有改变。

1.  函数应具有较少的参数（四个是良好的上限）。这不限制向函数传递的数据：将相关参数分组到单个对象中有利于*对象不变式*，并节省了推理，如它们的一致性和一致性。

1.  更一般地说，从一个代码块到一个库，每个单元都应该有一个*窄接口*。减少通信可以减少所需的推理。这意味着返回内部状态的*获取器*是一种负担 — 不要向对象请求要处理的信息。相反，要求对象使用它已经拥有的信息来完成工作。换句话说，*封装* 就是一切 — 也只是关于*窄接口*。

1.  为了保持类的*不变性*，应该避免使用*设置器*，因为*设置器*往往会允许破坏对象状态的不变性。

除了对其正确性进行推理，对代码进行讨论也可以让你理解它。分享你获得的见解，让每个人受益。

作者：[Yechiel Kimchi](http://programmer.97things.oreilly.com/wiki/index.php/Yechiel_Kimchi)
