# 不要将程序钉在竖直位置

# 不要将程序钉在竖直位置

我曾经写过一个讽刺性的 C++ 测验，其中我讽刺性地建议了以下异常处理策略：

> 通过我们代码库中丰富的`try...catch`结构，我们有时能够阻止应用程序中止。我们将结果状态视为“将尸体钉在竖直位置”。

尽管我言谈轻松，但我实际上总结了我从苦涩经验女士那里得到的一课。

这是我们自己制作的 C++ 库中的一个基础应用程序类。多年来，它遭受了许多程序员的指指点点：没有人的手是干净的。它包含了处理来自其他所有地方的所有逃逸异常的代码。我们效仿《第二十二条军规》中的约瑟里安，我们决定，或者说（*决定*意味着比构建这个怪物所需的思考更多）感觉到这个类的实例应该永生或者在尝试中死去。

为此，我们交织了多个异常处理程序。我们混合了 Windows 的结构化异常处理和本地类型（还记得 C++ 中的`__try...__except`吗？我也不记得了）。当事情出乎意料地抛出时，我们尝试再次调用它们，更加努力地传递参数。回顾过去，我喜欢想象，在另一个`try...catch`处理程序内部写入另一个的 catch 子句时，某种意识悄然而至，我可能无意中从良好实践的高速公路上转入了芬芳但不健康的疯狂小巷。然而，这可能是事后的智慧。

不用说，每当基于这个类的应用程序出现问题时，它们就像码头边的黑手党受害者一样消失了，留下没有用的气泡痕迹来指示到底发生了什么，尽管据说调用了用于记录灾难的转储例程。最终——一个漫长的最终——我们审视了我们所做的事情，并感到羞愧。我们用一个简洁而强大的报告机制替换了整个混乱。但这是在许多次崩溃之后。

我不会为此烦扰你——因为毫无疑问，没有人会像我们那样愚蠢——但最近我与一个学术头衔声称他应该知道得更好的家伙在网上发生了争论。我们讨论了远程事务中的 Java 代码。如果代码失败，他认为应该在原地捕获和阻止异常。 （“然后用它做*什么*？”我问。“煮晚餐吗？”）

他引用了 UI 设计师的规则：永远不要让用户看到异常报告，仿佛这就解决了问题，因为这是大写的。我想知道他是否负责那些装饰着较弱博客的蓝屏 ATM 机中的代码，并且永久受到创伤。无论如何，如果你遇到他，点头微笑，不要理会，悄悄朝门口走去。

由[Verity Stob](http://programmer.97things.oreilly.com/wiki/index.php/Verity_Stob)撰写。
