- en: From and Into
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: From 和 Into
- en: 原文：[https://rust-exercises.com/100-exercises/04_traits/09_from.html](https://rust-exercises.com/100-exercises/04_traits/09_from.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://rust-exercises.com/100-exercises/04_traits/09_from.html](https://rust-exercises.com/100-exercises/04_traits/09_from.html)
- en: 'Let''s go back to where our string journey started:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回到我们的字符串之旅开始的地方：
- en: '[PRE0]'
  id: totrans-3
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: We now know enough to start unpacking what `.into()` is doing here.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经足够了解，可以开始解析 `.into()` 在这里做了什么。
- en: '[The problem](#the-problem)'
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[问题](#the-problem)'
- en: 'This is the signature of the `new` method:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是 `new` 方法的签名：
- en: '[PRE1]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: We've also seen that string literals (such as `"A title"`) are of type `&str`.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还看到字符串字面量（如 `"A title"`) 的类型是 `&str`。
- en: 'We have a type mismatch here: a `String` is expected, but we have a `&str`.
    No magical coercion will come to save us this time; we need **to perform a conversion**.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里有一个类型不匹配：期望 `String`，但我们有 `&str`。这次不会有魔法转换来救我们；我们需要 **执行转换**。
- en: '[`From` and `Into`](#from-and-into-1)'
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[`From` 和 `Into`](#from-and-into-1)'
- en: 'The Rust standard library defines two traits for **infallible conversions**:
    `From` and `Into`, in the `std::convert` module.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: Rust 标准库在 `std::convert` 模块中定义了两个用于 **不可失败转换** 的 trait：`From` 和 `Into`。
- en: '[PRE2]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'These trait definitions showcase a few concepts that we haven''t seen before:
    **supertraits** and **implicit trait bounds**. Let''s unpack those first.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 这些 trait 定义展示了我们之前没有见过的几个概念：**超 trait** 和 **隐式 trait 约束**。让我们首先解析这些概念。
- en: '[Supertrait / Subtrait](#supertrait--subtrait)'
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[超 trait / 子 trait](#supertrait--subtrait)'
- en: 'The `From: Sized` syntax implies that `From` is a **subtrait** of `Sized`:
    any type that implements `From` must also implement `Sized`. Alternatively, you
    could say that `Sized` is a **supertrait** of `From`.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '`From: Sized` 语法意味着 `From` 是 `Sized` 的 **子 trait**：任何实现了 `From` 的类型也必须实现 `Sized`。或者，你也可以说
    `Sized` 是 `From` 的 **超 trait**。'
- en: '[Implicit trait bounds](#implicit-trait-bounds)'
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[隐式 trait 约束](#implicit-trait-bounds)'
- en: Every time you have a generic type parameter, the compiler implicitly assumes
    that it's `Sized`.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 每次你有泛型类型参数时，编译器都会隐式地假设它是 `Sized`。
- en: 'For example:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE3]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'is actually equivalent to:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上等价于：
- en: '[PRE4]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'In the case of `From<T>`, the trait definition is equivalent to:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `From<T>` 的情况下，trait 定义等价于：
- en: '[PRE5]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: In other words, *both* `T` and the type implementing `From<T>` must be `Sized`,
    even though the former bound is implicit.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 换句话说，**T** 和实现 `From<T>` 的类型都必须是 `Sized`，尽管前者约束是隐式的。
- en: '[Negative trait bounds](#negative-trait-bounds)'
  id: totrans-25
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[负 trait 约束](#negative-trait-bounds)'
- en: 'You can opt out of the implicit `Sized` bound with a **negative trait bound**:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过 **负 trait 约束** 来放弃隐式的 `Sized` 约束：
- en: '[PRE6]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'This syntax reads as "`T` may or may not be `Sized`", and it allows you to
    bind `T` to a DST (e.g. `Foo<str>`). It is a special case, though: negative trait
    bounds are exclusive to `Sized`, you can''t use them with other traits.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 这个语法读作 "`T` 可能或可能不是 `Sized`"，它允许你将 `T` 绑定到一个 DST（例如 `Foo<str>`）。这是一个特殊情况：负 trait
    约束仅限于 `Sized`，你不能与其他 trait 一起使用它们。
- en: '[`&str` to `String`](#str-to-string)'
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[从 `&str` 到 `String`](#str-to-string)'
- en: In [`std`'s documentation](https://doc.rust-lang.org/std/convert/trait.From.html#implementors)
    you can see which `std` types implement the `From` trait.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [std 的文档](https://doc.rust-lang.org/std/convert/trait.From.html#implementors)
    中，你可以看到哪些 `std` 类型实现了 `From` trait。
- en: 'You''ll find that `String` implements `From<&str> for String`. Thus, we can
    write:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 你会发现 `String` 实现了 `From<&str> for String`。因此，我们可以写出：
- en: '[PRE7]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: We've been primarily using `.into()`, though.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，我们主要使用的是 `.into()`。
- en: If you check out the [implementors of `Into`](https://doc.rust-lang.org/std/convert/trait.Into.html#implementors)
    you won't find `Into<String> for &str`. What's going on?
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你查看 `Into` 的实现者 [implementors of `Into`](https://doc.rust-lang.org/std/convert/trait.Into.html#implementors)，你不会找到
    `Into<String> for &str`。这是怎么回事？
- en: '`From` and `Into` are **dual traits**.'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '`From` 和 `Into` 是 **对偶 trait**。'
- en: 'In particular, `Into` is implemented for any type that implements `From` using
    a **blanket implementation**:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 特别是，`Into` 为任何实现了 `From` 的类型使用 **泛型实现**：
- en: '[PRE8]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: If a type `U` implements `From<T>`, then `Into<U> for T` is automatically implemented.
    That's why we can write `let title = "A title".into();`.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 如果类型 `U` 实现了 `From<T>`，则自动实现了 `Into<U> for T`。这就是为什么我们可以写出 `let title = "A title".into();`。
- en: '[`.into()`](#into)'
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[`.into()`](#into)'
- en: Every time you see `.into()`, you're witnessing a conversion between types.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 每次你看到 `.into()`，你都在见证类型之间的转换。
- en: What's the target type, though?
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 那么目标类型是什么呢？
- en: 'In most cases, the target type is either:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数情况下，目标类型是以下之一：
- en: Specified by the signature of a function/method (e.g. `Ticket::new` in our example
    above)
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由函数/方法的签名指定（例如，我们上面的例子中的 `Ticket::new`）
- en: 'Specified in the variable declaration with a type annotation (e.g. `let title:
    String = "A title".into();`)'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '在变量声明中指定类型注解（例如 `let title: String = "A title".into();`）'
- en: '`.into()` will work out of the box as long as the compiler can infer the target
    type from the context without ambiguity.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '`.into()` 将会自动工作，只要编译器可以从上下文中无歧义地推断出目标类型。'
- en: '[Exercise](#exercise)'
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[练习](#exercise)'
- en: The exercise for this section is located in [`04_traits/09_from`](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/04_traits/09_from)
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 本节的练习位于 [04_traits/09_from](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/04_traits/09_from)
